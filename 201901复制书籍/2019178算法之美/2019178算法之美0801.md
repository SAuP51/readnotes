# 
> 2018000模板


08 松弛 顺其自然


2010年，梅根·贝洛斯正在普林斯顿大学攻读化学工程博士学位，她的研究围绕着如何将氨基酸放入蛋白质链中，以产生具有特殊特征的分子。（“如果你能最大限度地发挥两种蛋白质的结合能，就能成功地设计出一种生物功能的多肽抑制剂，这样你就能真正抑制疾病的进展。”）当时她也在为自己的婚礼做准备。在婚礼前，她为安排座位而苦恼。

现在已经有9个大学朋友坐在一起，贝洛斯正在发愁再让谁加入才能让这样一个小小的团体凑够10个人一桌。更糟糕的是，她数了数发现自己有11位亲戚。将谁从尊敬的父母席上分出去呢，她又该怎么向他们解释呢？还有像她的童年邻居和保姆，或者她父母的同事，他们在婚礼上根本不认识什么人怎么办？

这个问题似乎和她在实验室里研究的蛋白质问题一样困难，她被问题打败了。一天晚上，当她盯着座位图时，“我意识到我博士论文中的氨基酸和蛋白质跟我的婚礼上人们的座位之间确实存在着一对一的关系。”贝洛斯向她的未婚夫喊了一声，便开始写方程式。氨基酸变成了客人，结合能变成了相互关系，而分子之间所谓的“紧邻相互作用”就是邻近的相互作用。她可以利用自己研究中的算法来安排自己的婚礼。

贝洛斯想出一个用数字来定义所有宾客之间关系的方法。如果某个人不认识另一个人，他们会得到0分，如果他们认识，会得到1分，如果他们是夫妻，会得到50分。（新娘的妹妹给所有想坐在一起的人打10分，作为一种特殊的特权。）然后，贝洛斯指定了一些约束条件：例如最大桌容量和每桌的最低分值，这样就不会有一桌变成“混杂”组，坐的都是陌生人。她还整理了这个项目的目标：最大限度地提高每桌客人之间关系的得分。

婚礼上有107人，11张桌子，每张可容纳10人。这意味着大约有11107种可能的座位安排：这是一个112位的数字，是一个大于2000亿的天文数字，这个数字在可观测的宇宙中可使原子（仅仅80位数）数目相形见绌。在周六晚上，贝洛斯把这份工作提交到她的实验室电脑里进行处理。当她周一早上来上班的时候，它还在分析。她把迄今为止找到的最好的结果提取出来，然后把它放回到蛋白质设计上。

即使有一个高性能的实验室计算机集群和整整36小时的处理时间，这个程序也无法评估潜在座位安排的极小部分。可能性是真正能获得最高分的最佳解决方案，从来没有出现在它的排列中。不过，贝洛斯对计算机的分析结果感到满意。“它识别出我们已经遗忘的关系。”她说。计算机提供了令人愉快的、非传统的可能性，人类计划者甚至从来没有考虑过。例如，它提议将她的父母从家庭餐桌上“删除”，以他们多年未见的老朋友代之。计算机的最终建议是一项各方都同意的安排，尽管新娘的母亲忍不住做了一些人为调整。

就连普林斯顿实验室的总计算能力都无法找到完美的座位分配计划，这一点似乎令人十分惊讶。在我们讨论过的大多数领域中，直接的算法可以保证最佳的解决方案。但是，正如计算机科学家在过去几十年里所发现的那样，无论我们的计算机处理速度有多快，我们如何巧妙地对它们进行编程，一个问题的完美解决方案都是不存在的。事实上，没有人能像计算机科学家那样理解，在面对看似无法控制的挑战时，你既不应该永远辛苦工作，也不应该放弃，但我们将会看到第三种尝试。





最优化的难度


美国内战之前，亚伯拉罕·林肯在起草《解放奴隶宣言》或发表葛底斯堡演说之前，在伊利诺伊州的斯普林菲尔德当过一段时间的“草原律师”，他每年都要去第八巡回审判庭两次，这样坚持了16年。作为一名巡回律师，这意味着要在14个不同郡县的城镇里进行巡回审理，在数周内要骑行数百英里。规划这些线路带来了一个自然的挑战：如何在尽可能少的英里数内到达所有要去的城镇，而不重复经过任何一个城镇。

这是一个数学家和计算机科学家所熟知的“约束优化”问题：如何找到一组变量的最佳排列，并给出特定的规则和记分法。事实上，这是最著名的优化问题。如果它在19世纪被研究过，它可能会被称为“草原律师问题”，如果它在20世纪初出现的话，它可能会被戏称为“投递无人机问题”。但就像秘书问题一样，它出现在20世纪中期，一个明确的名称是“旅行推销员问题”。

路线规划问题直到20世纪30年代才得到数学界的关注，但后来发展迅猛。数学家卡尔·门格尔在1930年谈到了“邮政信使问题”，他指出，没有比直接简单地尝试每一种可能性更容易的解决办法了。哈斯勒·惠特尼在1934年的普林斯顿大学演讲中提出了这个问题，当时数学家梅里尔·弗勒德（你可能记得第1章中所提到的，他也被认为是第一个提出解决秘书问题方法的人）已经开始思考这个问题了。20世纪40年代，当弗勒德搬到加州时，他把它介绍给兰德研究所的同事，这个问题的标志性名字最早出现在数学家茱莉亚·鲁宾逊1949年发表的论文中。当这个问题席卷数学圈时，它似乎并不容易普及。虽然许多当时最伟大的人都痴迷于它，但似乎没有人能够真正在这方面取得进展。

在旅行推销员这一例子中，问题不在于电脑（或数学家）是否能找到最短的路径：理论上，一个人可以简单地列出并测量所有的可能性。更确切地说，问题在于随着城镇数量的增加，连接它们的可能路线也会越来越多。路线仅仅是城镇的一个命令，所以用蛮力去一一尝试是可怕的“阶乘时间”——在计算上相当于把一副牌扔在空中从而进行分类，直到它们按顺序落到地上。

问题是：是否有希望做得更好？

几十年的研究几乎都没能很好地解决旅行推销员问题。例如，弗勒德在第一次遇到此问题后的20多年（也就是1956年）写道：“在处理这个问题时，很有可能需要采取一种完全不同的方法。事实上，可能不存在解决这个问题的通用方法，而且那些看似不可能的结果也是有价值的。”10年之后，这种情况更加糟糕。“我猜想，”杰克·埃德蒙兹写道，“对于旅行推销员问题，没有好的算法。”这些话是有预见性的。





定义的难度


20世纪60年代中期，国家标准与技术研究所的埃德蒙兹和IBM（国际商业机器公司）的艾伦·科巴姆一起定义了一个可行的解决方案。他们断言，所谓的科巴姆——埃德蒙兹论断表明：如果一种算法运行在所谓的“多项式时间”，即O（n2）、O（n3），或者n的任意次方，那么该算法应该被认为是“有效的”。如果我们知道如何使用一种有效的算法来解决问题，那么该问题就会被认为是“可处理的”。相反，我们不知道如何解决的问题，被认为是“不可处理的”。“除了最小的尺度以外，最棘手的问题是电脑无法处理的问题，无论电脑多么强大。

这相当于计算机科学的核心洞察力。量化一个问题的难度是可能实现的。但有些问题就是……很难。

旅行推销员的问题在哪里？奇怪的是，我们还不太确定。1972年，在伯克利的理查德·卡普证明了旅行推销员问题与一个有争议的边缘性问题有关联，而这个问题还没有被明确证明是可解决的（或者是不可解决的）。但到目前为止，还没有找到解决这些问题的有效方法，大多数计算机科学家认为其中没有什么可找的。因此，在20世纪50年代所设想的旅行推销员问题的“不可能解决的结果”很可能就是它最终的命运。更重要的是，许多其他的寻找最优化问题，从政治战略到公共卫生到火灾安全等，都是同样棘手的问题。

但是对于那些与此类问题搏斗的计算机科学家来说，这个结论并不是故事的结局。相反，它更像是对武器的召唤。认定一个问题是不可解决的，你不能只是举手投降。正如日程安排专家简·卡雷尔·伦斯特拉告诉我们的：“当问题很困难时，并不意味着你就可以忘记它，这意味着它只是处于不同的状态。即使这是一个很厉害的敌人，你还是要打这场仗。”这就是这个领域所发现的无价之宝，我们也可以从中学到：如何最好地解决那些最佳答案似乎遥不可及的问题，如何学会放松。





放松吧


伏尔泰

完美就是遇到优秀的敌人。

当别人告诉你要放松的时候，可能是因为你紧张，对要做的事情过于在意。当计算机科学家们面对一项艰巨的挑战时，他们的头脑也想放松，他们会传阅《放松方法或分散放松技巧介绍》（An Introduction to Relaxation Methods or Discrete Relaxation Techniques）一书。但是他们不会放松自己，他们只能会放松问题本身。

在计算机科学中最简单的放松形式之一就是约束松弛。在这项技术中，研究人员消除了一些问题的约束，并着手解决他们希望得到解决的问题。然后，在他们取得一定的进展之后，他们试图再将约束添加进去。也就是说，在把问题带回现实之前，他们会让问题暂时更容易处理。

例如，你可以让销售人员多次访问同一个城市，让他自由地来回，从而松弛旅行推销员问题。在这些宽松的规则下找到最短路径会产生所谓的“最小生成树”。（如果你喜欢的话，你也可以把最小生成树看成是连接每个城镇到至少另一个城镇所需的最少里程。以下是最短的旅行路线和最小生成树路线。）事实证明，解决这个更宽松的问题对于计算机来说基本上不需要时间。虽然最小生成树不一定能直接解决真正的概率问题，但它还是相当有用的。首先，生成树可以自由回溯，它制定的路线将永远不会比真正的解决方案路线要长，因为它必须遵循所有的规则。因此，我们可以使用轻松的问题——幻想，作为对真实的更低的约束。如果我们计算出某一组特定城镇的最小生成树距离为100英里，那我们便可以确定，旅行推销员所走的距离一定不会小于这个数。如果我们找到一条110英里长的路线，那我们可以确定它比最好的解决方案最多长10%。这样我们就能明白，我们离真正的答案有多近（即使不知道它到底是什么）。

更好的是，在旅行推销员的问题上，最小生成树实际上是开始寻找真正解决方案的最佳起点之一。类似这样的方法甚至可以让解决旅行推销员最大的问题成为可能——找到最短的路线，让地球上的每一个城镇都能在不到0.05%的（未知的）最佳解决方案中得到解决。

虽然我们大多数人都没有遇到过正式的约束松弛的算法版本，但它的基本内容对几乎所有在人生中遇到过重大问题的人来说都是很熟悉的。如果你不害怕，你会怎么做？这可能是你在指导顾问办公室或激励性研讨会上听到的话。如果你不能失败，你会怎么做？同样，在考虑工作或职业问题时，我们会问你，如果你中了彩票，你会怎么做？或者，换个策略，如果所有工作收入都一样，你会做什么？这种思想练习背后的想法正是约束松弛的过程：为了使棘手问题具有可伸缩性，为了在理想的世界中取得进展，这都可以被移植到真正的世界中。如果你不能解决你面前的问题，就去解决一个简单点儿的问题，然后看看这个解决方案是否能让你在一个成熟的问题中找到一个起点，或者一盏指路明灯。也许它可以。




林肯1855年司法巡回最短旅行路线（上）和最小生成树路线（下）


松弛不能为你提供完美答案的捷径。但是计算机科学也可以量化松弛在时间和解决方案质量之间产生的比例权重。在很多情况下，这个比例是戏剧性的、没有头脑的，例如，一个答案跟一个1×10-15的完美答案相比，至少有一半好。这个道理简单而深刻：如果我们愿意接受足够接近的解决方案，那么即使是一些最严重的问题也可以用正确的技术来解决。

临时移除约束，如最小生成树和“如果你中了彩票会怎么办？”等例子，是最直接的算法松弛形式。但还有另外两种更微妙的松弛形式在最优化研究中反复出现，它们被证实在解决这一领域最重要、最棘手的问题时具有重要作用，例如从城市规划和疾病控制到体育竞争的培养，都有直接的现实意义。





无数灰色地带：持续的松弛


旅行推销员问题，就像梅根·贝洛斯寻找最佳座位安排的问题一样，是一种特殊的最优化问题，称为“离散优化”，即在解决方案中没有平滑的连续统一体。推销员要么到这个镇子，要么到那个镇，你要么在5号桌，要么在6号桌。两者之间没有灰色地带。

这样的离散优化问题就在我们身边。例如，在城市里，规划者试图把消防车放置在一个能在同样固定时间内（比如5分钟），到达区内不同住宅的地方。从数学上讲，每辆消防车都能在5分钟内从所处位置到达任何可以到达的区内住宅。挑战在于找到最小的地点集合，这样所有的房子都能被覆盖。威斯康星大学麦迪逊分校的劳拉·艾伯特·麦克莱说：“整个火灾和紧急情况领域都采用了这种覆盖模型，而且效果很好。”“这是一个很好的、很清晰的模型。”但由于一辆消防车要么存在于某个地点，要么不在这个地方，因此计算最小集就涉及离散优化。正如麦克莱所指出的，“这就是很多问题在计算上变得困难的地方，因为你不能这样做一半，那样做一半”。

离散优化的挑战也出现在社会环境中。想象一下，你想为你所有的朋友和熟人举办聚会，却不想花邀请信所需要的信封和邮票的钱。因此，你可以决定向几位关系好的朋友发出邀请，告诉他们“把我们认识的人都带过来”。你最理想的发现是，你的最小朋友圈认识你社交圈子里的所有人，这可以让你“舔”最少的信封，还能让每一个人都能参加。当然，这听起来似乎是为了省买邮票的几块钱，但这恰恰是政治竞选活动经理和企业营销人员想要解决的问题，即最有效地传播他们的信息。这也是流行病学家研究的问题，例如，给人口中最低数量的人接种疫苗，以保护整个社会免受传染病的威胁。

正如我们所指出的，离散优化对整数的要求（例如一个消防部门只可以有一辆、两辆、或三辆车在车库里，而不是两辆半或π辆消防车）使离散优化问题难以解决。事实上，消防车问题和派对邀请问题都是难以解决的：没有普遍有效的解决方案。但是，事实证明，确实存在许多有效的策略来解决这些问题的连续版本，其中任何分数或小数都是可能的解决方案。研究人员面对一个离散优化问题，可能会很羡慕地盯着这些策略，但他们可以做的还很多。他们可以试着把离散问题放宽到一个连续问题，然后看看会发生什么。

在邀请问题上，将其从离散优化松弛到连续优化，意味着一个解决方案可能会告诉我们向某一人发送一个1/4的邀请，问另外一个人发2/3。这到底是什么意思？很明显，这不是最初问题的答案，但是，就像最小生成树一样，它确实给了我们一个起点。有了轻松的解决方案，我们可以决定如何将这些分数转换回现实。例如，我们可以选择在必要的时候简单地把它们围起来，向每个收到“半个邀请”或以上的人发出邀请。我们也可以把这些分数当作概率来解释，例如在松弛的解决方案告诉我们要放半辆消防车的地方分别扔硬币，然后实际上，只在最后扔出硬币头像一面的地方放置消防车。在这两个例子中，随着这些分数转化为整数，在原始的离散问题中，我们便会有一个有意义的解决方案。

最后一步，和任何松弛方式一样，那就是问自己，与我们可能想出的最好的解决方案相比，这个解决方案有多好，我们可能会用详尽的方法检查每一个可能的答案。事实证明，对于邀请函问题，连续松弛与凑整将给我们一个容易计算的不错的解决方案：数学保证你能邀请到所有你想要邀请的人，而最多发出计算机通过直接计算所给出的最佳解决方案两倍的邀请。同样，在消防车问题上，连续松弛问题很可能很快地让我们在一个舒适的范围内得到最佳答案。

持续松弛并不是一颗神奇的子弹：它仍然没有给我们提供有效的方法以得到真正的最佳答案，只能得出它们的近似值。但是，提供最佳邮寄或接种方案的两倍选择仍远比未优化的选择要好。





只是一张超速罚单：拉格朗日松弛算法


《公主新娘》

维齐尼：不可思议！

伊尼戈·蒙托亚：你一直用这个词。我认为这个词的真正意思可能和你想表达的不太一样。

有一天，当布莱恩还是个孩子的时候，他向他母亲抱怨他必须做的事情：他的家庭作业、他的家务……“从技术上讲，你做任何事情都不是必需的，”他的母亲回答道，“你不必按照老师说的去做。你不必按我说的去做。你甚至不必遵守法律。所有事情都会产生后果，你要想好你是否愿意承担这些后果。”

布莱恩的童心被打击了。这是一种强有力的信息，是一种意识、责任、道德判断的觉醒。这也是另一种东西：一种强大的计算技术，被称为拉格朗日松弛算法。拉格朗日松弛算法背后的理念很简单。优化问题有两个部分：规则和计分。在拉格朗日松弛法中，我们采用一些问题的约束并将它们放入计分系统中。也就是说，我们采用那些看似不可能的方法，然后将其降级为高昂代价。（例如，在婚礼座位最优化问题中，我们可能会放松对每桌最多10人的限制，这样可以让桌子上的人坐得满满的，但也会有一些空间上的弊端）当一个优化问题的约束说：“做这个，或者其他！”拉格朗日松弛会回答：“如果不做又会怎样呢？”一旦我们可以越界，哪怕只是一点点，甚至付出高昂的代价，那么原先无法处理的问题就会变得可以处理了。

拉格朗日松弛算法是关于旅行销售员问题和计算机科学中的其他难题的理论文献的重要组成部分。它们也是许多实际应用程序的关键工具。举个例子，想想卡内基-梅隆大学的迈克尔·特里克（我们在第3章中提到过他），他负责美国职业棒球大联盟和美国大学生篮球联赛的很多日程安排。我们没有提到过他是如何做事的。每年的时间表的组成都是一个巨大的离散优化问题，因为过于复杂，任何计算机都无法直接解决。所以每年特里克和他在体育日程安排组的其他同事们都用拉格朗日松弛算法来完成任务。每次你打开电视或在体育场坐下时，你都知道当晚的球场上有哪些球队要打比赛。这并不一定是最优匹配，但已经非常接近最优了。为此，我们不仅要感谢迈克尔·特里克，更要感谢18世纪法国数学家约瑟夫·路易斯·拉格朗日。

在安排一个体育赛季的赛事时，特里克发现我们之前所讨论的连续松弛并不一定会让他的生活变得更轻松。“如果游戏玩了一半就结束，你便没有得到任何有用的东西。”最终得到多少派对邀请或消防车的分配结果是一回事，如果有必要的话，这些数字都可以被四舍五入。但是在体育运动中，整数限制——有多少个队打一场比赛，总共有多少场比赛是在进行中，以及每支球队会和其他队交手多少次，在这些情况下都太强大了。“所以我们不能在这个方向上松弛，我们必须保持模型的基本（离散）部分。”

尽管如此，我们必须做一些事情来处理这个问题的复杂性。因此，“我们必须与联盟合作，松弛他们可能想拥有的一些约束”，特里克解释说。在一个体育赛季中，这种约束的数量是巨大的，它不仅包括来自联盟基本结构的要求，还包括各种各样的特殊要求和道德准则。联赛乐于接受赛季后半段与前半段是完全一致的，只是主场和客场的比赛是相反的。某些联赛不想要这样的结构，但仍然要求在第一轮对阵完所有其他球队之前不要跟一个队交手第二次。一些联赛坚持让最著名的球队在决赛阶段才出场，一些球队不能在特定的时间进行主场比赛，因为他们的球场上还有其他比赛有冲突。在美国大学生篮球联赛的例子中，特里克还必须考虑来自转播比赛的电视网络的限制。电视频道早就提前决定好一年里转播什么样的节目，并将之定义为“A类比赛”和“B类比赛”（也就是能吸引最多观众的比赛）。例如，杜克大学对阵北卡罗来纳大学的比赛一直是A类比赛。各频道随之安排每周有一场A类比赛和一场B类比赛，但这两场比赛也不能同时进行，以免分散收视率。

不出意料，考虑到所有这些要求，特里克便发现，只要通过软化这些严格的约束条件就能使计算体育赛程成为可能。

一般来说，当人们第一次拿一份体育活动安排给我们时，他们会说：“我们从不做x，也从不做y。”然后我们看了他们的日程安排，我们说：“嗯，去年你做过两次x，做过三次y。”然后对方会说：“哦，是啊，好吧。除此之外，我们从来没有这样做过。”然后我们再看回前年……我们通常会意识到有些事情是他们认为永远不会做的。棒球界的人认为，扬基队和大都会队从来都不同时进行主场比赛。但这并不是真的，从不是真的。他们也许在一年的同一天里会有3场，或许是6场比赛同时进行。但是对于整个赛季，每个球队都有81场主场比赛，这又是相当罕见的，人们可能就会忘了这回事。

有时，需要一些外交手腕，但拉格朗日松弛算法通过让一些不可能的事情被降级为惩罚，将匪夷所思的变成不可取的，使我们取得进步。正如特里克所说，与其花费时间去寻找一个无法达到的完美答案，使用拉格朗日松弛法可以让他问一些问题，比如“你的答案能怎样的接近”。事实证明，如果已经足够接近了，就足以让每个人都快乐，比如联盟、学校、网络，以及点燃每年3月疯狂的炙热火焰（即美国大学篮球繁忙冠军赛季）。





学会松弛


在计算问题展现给我们的各种方式中，优化问题（一部分是目标，一部分是规则）仍可以说是最常见的。而离散优化问题，我们的选择是二选一，没有中间地带，这是最典型的选择。在这里，计算机科学做出了一个令人沮丧的结论。许多离散优化问题确实很难。该领域最杰出的人物都想不出一个得到完美答案的方法，而他们实际上是更致力于证明不存在这样的方法，而不是寻找方法。

如果没有其他的事情，这应该会让我们感到些许安慰。如果我们面对的问题看起来粗糙、棘手、无法处理——好吧，那我们可能是对的。拥有一台电脑也未必能帮上忙。

至少，除非我们能学会松弛才能有所进展。

有很多方法可以对一个问题进行松弛，我们已经看到了三个最重要的问题。首先，约束松弛，简单地消除一些约束，在回到现实之前，先在更宽松的问题上取得进展。第二，持续松弛，将离散的或二进制的选择变成连续体：当决定是选冰红茶还是柠檬水时，先想象一个50：50的“阿诺德·帕尔默”混合，然后再向上或向下延展。第三，拉格朗日松弛，把不可能的变成仅仅是惩罚，要学会扭曲规则的艺术（或打破规则，并接受后果）。例如，摇滚乐队在决定将哪些歌曲放入一个有限的专辑中时，就要面对计算机科学家称之为的“背包问题”——将一组不同大小和重要性的项目装进一个有限的集合中的难题。在严格的公式中，背包问题是众所周知的棘手问题，但这并不妨碍我们松弛的摇滚明星们做决定。正如几个著名的例子所证明的那样，有时候稍微超过城市的宵禁，并付出相应的惩罚，好过把节目限制在适当的时间内。事实上，即使你没有违规，你也可以想象它具有启发性。

保守的英国专栏作家克里斯托弗·布克说，“当我们无意识地受到想法的驱动开始行动时，一段时间里似乎一切顺利”，但因为“这虚幻永远不可能成为现实”，它将不可避免地导致一个多阶段崩溃：“梦”“挫折”“梦魇”“爆炸”。“计算机科学描绘了一个戏剧性的乐观看法。再说一遍，作为一种最优化技巧，松弛就是被个人想法所驱使。也许这是造成这种差异的部分原因。

松弛给我们带来了许多好处。首先，它保证了真正解决方案的质量。如果我们在制定日程，想象我们可以神奇地在镇上随意穿梭，这将会让我们瞬间明白，每天只能安排8个时长为一小时的会议。这样一个固定的设置预期可能在我们面对完整的问题时十分有用。第二，松弛方式的设计是为了与现实相匹配，这给了我们从另一个方向解决问题提供了范围。当连续松弛告诉我们给某些人打半支疫苗时，我们可以给那些人直接注射一支或多支疫苗，最终获得一个容易计算的解决方案——最多需要接种两次疫苗。也许我们可以接受这一点。

每当我们遇到一个故障时（除非我们愿意花无数时间去追求完美），难题就会要求我们不许躲避，想象更简单的版本，并首先解决这些问题。当应用正确时，这不仅是一种个人想法，也不是幻想或白日梦。这是我们取得进步的最好方法之一。





