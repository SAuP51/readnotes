第二部分 思想

## 0801. 抽象

若想捉大鱼，就得潜入深渊。深渊里的鱼更有力，也更纯净。硕大而抽象，且非常美丽。

—— 大卫·林奇

### 本章小结

「抽象」作为名词，代表着一种思维方式，它的伟大之处在于可以让我们撇开细枝末节，去把握事物更本质、更一般的特性，从而更有效地对问题域进行分析设计。「抽象」作为动词，代表着一种能力，它是我们理解概念、理清概念之间逻辑关系的基础，也是我们面向对象分析设计所要求的底层能力。

归纳总结，合并同类项是进行抽象活动时最有效的方法。同时，我们也要注意到抽象是有层次性的。当一个概念无法涵盖其外延的时候，我们有必要提升一个抽象层次来减少它的内涵，让其有更大的外延。

建议读者一定要多多培养自己的抽象思维。阅读、写文章，以及逻辑思维训练都是提升抽象思维能力非常好的方式。只要坚持学习和锻炼，你慢慢就能体会到一种不一样的美 —— 抽象之美。

### 8.0

软件行业有一个概念，对其了解越深入，我就越会感叹之前的理解是多么肤浅。在很长一段时间里，对这个概念的一知半解阻碍了我对面向对象技术，甚至是软件架构的深层次理解。

实际上，对这个概念的认知偏差，我并非个例，我接触的工程师中能深入理解这个概念的并不多。能把这个概念和建模、面向对象和软件架构进行融会贯通，并进行问题分析、化繁为简的人就更是凤毛麟角了。

因此，我认为很有必要用一章的篇幅深入介绍这个重要的概念 —— 抽象。

### 8.1　伟大的抽象

没有抽象思维，就没有人类今天灿烂的文明。原始人看到一片满是松树的树林，不会给它们一个名字，而是给每一棵树取一个独特的名字，可能叫「silisiba」。原始人只知道某棵具体的树。

随着意识水平的发展，人类开始将具有相同特征的事物归并到一起，从「silisiba」到「松树」—— 到「树木」—— 到「植物」—— 到「物质」，从具象思维到抽象思维，这个过程人类花了几万年的漫长时间。

赫拉利在《人类简史》中说，「人类之所以成为人类，是因为人类能够想象」。这里的想象，我认为很大程度上是指抽象能力。正是抽象思维帮助人类从具体事物中抽象出各种概念，再用这些概念去构筑种种虚构的故事。这些概念包括经济（例如货币、证券）、文学、艺术和科学等，都是建立在抽象的基础之上的。

### 8.2 到底什么是抽象

抽象和具象是相对应的概念，「抽」就是抽离，「象」就是具象。从字面上理解抽象，就是从具体中抽离出来。英文的抽象 abstract 来自拉丁文 abstractio，它的原意是排除、抽出。

按照维基百科上的解释，抽象是指为了某种目的，对一个概念或一种现象包含的信息进行过滤，移除不相关的信息，只保留与某种最终目的相关的信息。例如，一个「皮质的足球」，我们可以过滤它的质料等信息，得到更一般性的概念，也就是「球」。从另一个角度看，抽象就是简化事物，抓住事物本质的过程。

按照这个定义，「苹果」就是一个抽象，是对「苹果」这个概念的统称，它抹去了单个苹果对象的特征，不管是大的小的、甜的不甜的、红的不红的，都叫作「苹果」。

在绘画流派中，有一种流派叫抽象主义，最著名的抽象派大师就是毕加索，图 8-1 所示是毕加索画的牛。

图 8-1　实物牛和抽象牛的对比

毕加索的画中只有几根线条，却是做了高度抽象之后的线条，过滤了绝大部分水牛的细节，只保留了牛的最主要的一些特征。正因为其抽象层次更高，因此其泛化能力更强，「抽象牛」不仅可以表示水牛，也可以表示黄牛、奶牛、野牦牛…… 只要是牛都逃不过这几根线。可以说，抽象更接近问题的本质。

### 8.3 抽象是 OO 的基础

面向对象（Object Oriented，OO）的思考方式，就是万物皆对象。抽象帮助我们将现实世界的对象抽象成类，完成从现实世界的概念到计算机世界的模型的映射。例如，有一堆苹果，如果对其进行抽象，我们可以得到 Apple 这个类，通过这个类，我们可以实例化一个红色的苹果：new Apple ("red")。此时，如果我们需要把香蕉、橘子等水果也纳入考虑范围，那么 Apple 的抽象层次就不够了，我们需要 Fruit 这个更高层次的抽象来表达「水果」的概念。

面向对象的思想主要包括 3 个方面：面向对象的分析（Object Oriented Analysis，OOA）、面向对象的设计（Object Oriented Design，OOD），以及我们经常提到的面向对象的编程（Object Oriented Programming，OOP）。

OOA 是根据抽象关键问题域来分解系统。OOD 是一种提供符号设计系统的面向对象的实现过程，它用非常接近实际领域术语的方法把系统构造成「现实世界」的 抽象。OOP 可以看作一种在程序中包含各种独立而又互相调用的对象的思想，这与传统的思想刚好相反，传统的程序设计主张将程序看作一系列函数的集合，或者更直接些，就是一系列对计算机下达的指令。

可以看到，抽象贯穿于 OO 的始终，是 OO 的前提和底层能力，抽象能力差的人是很难做好 OO 的。

### 8.4 抽象的层次性

对同一个对象的抽象是有不同层次的。层次越往上，抽象程度越高，它所包含的东西就越多，其含义越宽泛，忽略的细节也越多；层次越往下，抽象程度越低，它所包含的东西越少，细节越多。也就是我们常说的，内涵越小，外延越大；内涵越大，外延越小。不同层次的抽象有不同的用途。

有一次在家，女儿问我：「爸爸你会不会画猫？」我说，「会呀」。然后她又问：「那你会画房子吗？」我说，「也会呀」。她有点失落，然后看看外面问：「那你会不会画城市？」。为了让女儿开心，我跟她说：「城市那么大，爸爸不会画。」她还太小，以为画城市就要把城市的每个细节都画出来，不知道抽象是有层次的。

这种抽象的层次性基本可以体现在任何事物上，以下是对一份报纸在多个层次上的抽象。

第一层：一个出版物。

第二层：一份报纸。

第三层：《旧金山纪事报》。

第四层：5 月 18 日出版的《旧金山纪事报》。

第五层：我拥有的 5 月 18 日出版的《旧金山纪事报》。

如果我要统计美国有多少家出版单位，那么就要用到第一层「出版单位」的抽象。如果我要查询旧金山 5 月 18 日当天的新闻，那么就要用到第五层的抽象。

分层抽象在软件的世界里随处可见，是软件架构的核心，也是我们构建当今信息帝国的基石。有一句名言，「软件领域的任何问题，都可以通过增加一个间接的中间层来解决。」

这种分层在某种意义上也是抽象的分层，每一层的抽象只关注本层相关的信息，对上层屏蔽复杂性，从而简化整个系统的设计。

例如，我们的系统就是分层的。最早的程序直接运行在硬件上，开发成本非常高。然后慢慢开始有了操作系统，操作系统提供了资源管理、进程调度、输入输出等所有程序都需要的基础功能，开发程序时调用操作系统的接口就可以了。再后来发现操作系统也不够用，于是又有了各种运行环境（如 JVM）。

编程语言也是一种分层的抽象。机器理解的其实是机器语言，即各种二进制的指令。但是使用二进制编程效率极低，所以我们用汇编语言抽象了二进制指令，用 C 语言抽象了汇编语言，而高级语言 Java 抽象了低级语言。

很难想象，如果没有抽象分层，人类该如何应对软件世界这么高的复杂度。阿里巴巴的软件系统的复杂度绝对不亚于一个城市，若是没有抽象分层，就像要在一张画布上画出整个城市的细节，从摩天大厦到门把手，从公园到街道上的猫，其画面难以想象……

### 8.5 如何进行抽象

#### 8.5.1 寻找共性

简单来说，抽象的过程就是合并同类项、归并分类和寻找共性的过程。也就是将有内在逻辑关系的事物放在一起，然后给这个分类进行命名，这个名字就代表了这组分类的抽象。

我们的生活中无时无刻不在进行着这样的抽象，语言本身就是对现实世界的抽象符号表达。比如当你说「花」的时候，就使用了抽象概念，它包含了各种各样、万紫千红的花的本性。

在我们写代码的过程中，如果遇到大量重复或者部分重复的代码，往往意味着抽象的缺失，可以通过合并归类来进行优化。

例如，我们在一个应用中大量使用搜索的功能，因为搜索的条件比较复杂，所以系统中充斥着大量的如下所示的代码：

```java
// 取默认搜索条件

List<String> defaultConditions = searchConditionCacheTunnel. getJsonQueryByLabelKey(labelKey);

for

(String jsonQuery : defaultConditions){

jsonQuery = jsonQuery.replaceAll(SearchConstants.SEARCH_ DEFAULT_PUBLICSEA_ENABLE_TIME, String.valueOf(System.currentTimeMillis() / 1000));

jsonQueryList.add(jsonQuery);

}

// 取主搜索框的搜索条件

if

(StringUtils.isNotEmpty(cmd.getContent())){

List<String> jsonValues = searchConditionCacheTunnel. getJsonQueryByLabelKey(SearchConstants.ICBU_SALES_MAIN_SEARCH);

for

(String value : jsonValues) {

String content = StringUtil.transferQuotation(cmd. getContent());

value = StringUtil.replaceAll(value, SearchConstants. SEARCH_DEFAULT_MAIN, content);

jsonQueryList.add(value);

}

}
```

这样的代码不是出现在一个地方，而是散落在需要搜索查询的地方，总共几十处。随着时间的推移，这样的重复代码可能还会继续增加，如图 8-2 所示。

图 8-2　散落在各处的搜索代码

问题就在于抽象的缺失。首先，对于搜索条件，我们可以用 SearchCondition 这个类进行抽象和封装；其次，对于组装搜索条件的过程，我们可以用 SearchConditionAssembler 类进行抽象。添加这两个抽象之后，我们再对原来的代码进行重构，消除重复后的代码如下所示：

```java
public class

SearchConditionAssembler {

public

static SearchCondition assemble(String labelKey){

String jsonSearchCondition = getJsonSearchConditionFromCache (labelKey);

SearchCondition sc=assembleSearchCondition(jsonSearchCondition);

return

sc;

}

}
```

因此，合并同类项，找到共性，再给这个共性命名的过程就是一个简单的抽象过程。

然而有些时候，发现共性的过程并不像重复代码这么简单直观，需要对问题域有深入理解。例如，如果你不了解 CRM 领域，就很难做出「公海」和「私海」的抽象。有时，可能还需要动用非凡的想象力。

#### 8.5.2 提升抽象层次

当我们发现有些东西无法归到一个类别中时，该怎么办呢？此时，我们可以通过上升一个抽象层次的方式，让它们在更高的抽象层次上产生逻辑关系。

例如，你可以合乎逻辑地将苹果和梨归类为水果，也可以将桌子和椅子归类为家具。但是怎样才能将苹果和椅子放在同一组中呢？仅仅提高一个抽象层次是不够的，因为上一个抽象层次是水果和家具的范畴。因此，你必须提高到更高的抽象层次，比如将其概括为「商品」。

如果我们想把大肠杆菌也纳入其中，该怎么办呢？此时，「商品」这个抽象也不够用了，需要再提高一个抽象层次，比如叫「物质」（见图 8-3）。但是这样的抽象太过于宽泛，难以说明思想之间的逻辑关系。类似于我们在 Java 中的顶层父类对象（Object），万物皆对象。

图 8-3　抽象的层次性示例

在开发工作中，很多时候就需要通过抽象层次的提升来提高代码的可读性和通用性。

举个例子，现在有 Apple 和 Watermelon 两个类，都继承自 Fruit。对于苹果来说，我们认为甜度大于 60 就是好的；对于西瓜，我们认为水分大于 60 就是好的。两个类的代码如下所示。

（1）Apple 类：

```java
public class

Apple

extends

Fruit{

private

int sweetDegree;

public

boolean isSweet(){

return

sweetDegree > 60;

}

}

（2）Watermelon 类：

public class

Watermelon

extends

Fruit{

private

int waterDegree;

public

boolean isJuicy(){

return

waterDegree > 60;

}

}
```

此时，我们需要把好的水果挑出来，不难写出一个 FruitPicker（挑选水果的类），其代码如下：

```java
public class

FruitPicker {

public

List<Fruit> pickGood(List<Fruit> fruits){

return

fruits.stream().filter(e -> check(e)).

collect(Collectors.toList());

}

private

boolean check(Fruit e) {

if

(e

instanceof

Apple){

if(((Apple) e).isSweet()){

return true

;

}

}

if

(e

instanceof

Watermelon){

if

(((Watermelon) e).isJuicy()){

return true

;

}

}

return false;

}

}
```

这里的代码有个问题，就是 instanceof 的使用。为了判断苹果和西瓜是否好，我们需要借用 instanceof 获得具体的对象才能完成。

面对这种情况，可以考虑是否要做抽象层次的提升。进一步考查，我们会发现，不管是 Apple 的 isSweet ()，还是 Watermelon 的 isJuicy ()，本质上都是在判断水果是否可口。因此，我们完全可以在 Fruit 上定义一个 isTasty ()，如图 8-4 所示。

图 8-4　提升抽象层次示例

通过提升抽象层次，我们有了新的 Fruit 类：

```java
public abstract class

Fruit {

// 提升抽象层次，需要一个新方法来表达这个抽象

public abstract

boolean isTasty();

}

再回头看一下 FruitPicker，已经不再需要 instanceof 来做辅助判断了：

public class

FruitPicker {

public

List<Fruit> pickGood(List<Fruit> fruits){

return

fruits.stream().filter(e -> check(e)).

collect(Collectors.toList());

}

// 不再需要 instanceof

private

boolean check(Fruit e) {

return

e.isTasty();

}

}
```

通过上面的示例可以看到，提升了抽象层次的代码的通用性也随之提升，程序更好地满足了 LSP（里式替换原则）。因此，每当我们有强制类型转换，或者使用 instanceof 时，都值得停下来思考一下，是否需要做抽象层次的提升。

#### 8.5.3 构筑金字塔

《金字塔原理》是一本教人如何进行结构化思考和表达的书，核心思想是通过归类分组搭建金字塔结构，这是一种非常有用的思维框架，让我们更加全面地思考，在表达观点时更加清晰。

书中提到，要自下而上地思考，总结概括；自上而下地表达，结论先行。其中，自下而上总结概括的过程就是抽象的过程，构建金字塔的过程就是寻找逻辑关系、抽象概括的过程。经常锻炼用结构化的方式去处理问题，搭建自己的金字塔，可以帮助我们理清问题的脉络，提升抽象能力。

金字塔结构让我们通过抽象概括将混乱无序的信息形成不同的抽象层次，从而便于理解和记忆，这是一个非常实用的方法论。

举个例子，你要出门买报纸，你妻子让你带点东西回来并列了一个清单，里面有葡萄、橘子、咸鸭蛋、土豆、鸡蛋、牛奶和胡萝卜。当你准备出门时，你妻子说，「顺便再带点苹果和酸奶吧」。

如果不用纸笔写下来，你还能记住妻子让你买的 9 样东西吗？大部分人应该都不能，因为我们的大脑短期记忆无法一次容纳 7 个以上的记忆项目并超过 5 个小时，我们就会开始将其归类到不同的逻辑范畴，以便记忆。

对于葡萄、橘子、牛奶、咸鸭蛋、土豆、鸡蛋、胡萝卜、苹果和酸奶，我们可以按照逻辑关系进行分类，搭建一个金字塔结构，如图 8-5 所示。

图 8-5 金字塔结构示例

分类的作用不只是将一组中的 9 个概念分成每组各有 4 个、3 个和 2 个概念的 3 组概念，因为这样还是 9 个概念。你所要做的是提高一个抽象层次，将大脑需要处理的 9 个概念变成 3 个概念。

这样，你无须再记忆 9 个概念中的每一个概念，仅需记忆 9 个概念所属的 3 个组。思维的抽象程度提高了一层，由于处于较高层次的思想总是能够提示其下面一个层次的思想，因而更容易理解和记忆。

### 8.6 如何提升抽象思维

讲了这么多关于抽象的概念，抽象思维又是如此重要。那有没有办法来锻炼和提升我们的抽象思维呢？

当然有，抽象思维也是可以习得的。婴幼儿没有抽象思维，你和他玩躲猫猫游戏，把他的眼睛蒙上，他就以为你消失了，再放开，他看到你就会很高兴。因为他只能意识到你这个具象的人，意识还到不了抽象的程度。理解具象的内容要更加简单容易，而理解抽象内容则要困难和复杂很多。

#### 8.6.1 多阅读

为什么阅读书籍比看电视更好呢？因为图像比文字更加具象，阅读的过程可以锻炼我们的抽象能力、想象能力，而看画面时你的大脑会被铺满，较少需要抽象和想象。

这也是我们不提倡小孩子过多地看电视或玩手机的原因，因为不利于锻炼其抽象思维。

抽象思维的差别使孩子们的学习成绩从初中开始分化，许多不能适应这种抽象层面训练的孩子可能选择去读职业技校，因为这里比大学更加具象 —— 车铣刨磨、零件部件等都是能够看得到、摸得到的。

#### 8.6.2 多总结

小时候，我们可能不理解语文老师为什么总是要求我们总结段落大意、中心思想。现在回想起来，这种思维训练在基础教育中是非常必要的，其实质就是帮助学生提升抽象思维的能力。

做总结最好的方式就是写文章，小到博文，大到一本书，都是锻炼自己抽象思维和结构化思维的机会。记录也是很好的总结习惯。以读书笔记来说，最好不要原文摘录书中的内容，而是要用自己的话总结归纳，这样不仅可以加深理解，还可以提升自己的抽象思维能力。

现实世界纷繁复杂，只有具备较强的抽象思维能力的人，才能够具备抓住事物本质的能力。

#### 8.6.3 领域建模训练

对于技术人员来说，还有一个非常好的提升抽象能力的手段 —— 领域建模。当我们对问题域进行分析、整理和抽象时，或对领域进行划分和建模时，实际上都是在锻炼我们的抽象能力。

关于这一点，我深有感触。当开始使用第 6 章中介绍的建模方法论进行建模时，我会觉得无从下手，建出来的模型也很别扭。然而，经过几次锻炼之后，我很明显地感觉到自己的建模能力和抽象能力有所提升，不但分析问题的速度更快了，而且建出来的模型也更优雅了。
