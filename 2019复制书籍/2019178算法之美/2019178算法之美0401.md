# 
> 2018000模板



04 缓存 忘了它吧


威廉·詹姆斯

忘了它吧。在将我们的智力应用于实践时，忘记是与记忆同样重要的一个功能。

你遇到了一个问题——壁橱里塞满了鞋子、衬衫和内衣。于是，你想：“该整理整理了。”这下，你面前就有两个问题。

具体来说，你首先需要决定哪些东西需要保留，其次是这些东西如何摆放。幸运的是，社会上有这样一个规模不大的行业，从业人员通过考虑这两个孪生问题养家糊口，因此他们很乐意提供建议。

针对保留哪些东西这个问题，玛莎·斯图尔特说，你可以问自己几个问题，诸如“这件东西已经保留多久了？还能用吗？与我保留的其他东西是不是一模一样？我最后一次穿它或者使用它是什么时候的事情？”在如何摆放这些东西的问题上，她建议“分类摆放”，这条建议得到了她同事的赞同。弗朗辛·杰伊在《简单的快乐》中要求：“把短裙、裤子、连衣裙和外套分开挂。”安德鲁·梅伦自我标榜是“全美最有条理的人”，他说：“物品应该按类型分开放，休闲裤放在这里，衬衫放到那里，外套等其他衣物也要单独放。在每一个类型里面，再按颜色、风格（长袖、短袖等）和领口进一步细分。”除了可能导致排序问题以外，这条建议看起来很有道理。大家似乎都不会有任何异议。

不过，社会上还有一个规模更大的行业，业内人士同样痴迷于存储问题，但是他们有不同的想法。

衣橱整理与计算机存储器管理所面临的问题非常相似：空间有限，而目标是节省金钱和时间。自计算机问世以来，计算机科学家就开始苦苦思索哪些东西需要保存以及如何保存这两个孪生问题。通过这几十年的努力，人们发现，玛莎·斯图尔特关于哪些东西应该抛弃的4句话建议，其实是几个彼此不同的、不完全兼容的推荐意见，其中一个意见尤为重要。

研究存储器管理的计算机科学同样可以告诉我们应该如何安排壁橱（以及办公室）的空间。乍一看，计算机似乎遵循了玛莎·斯图尔特的格言——“物以类聚”。操作系统鼓励我们把文件根据类别放到一级一级的文件夹里，随着文件夹体系越分越细，其中的内容也越来越具体。但是，就像学者思想上的混乱被书桌表面的整洁性所掩盖一样，在计算机嵌套文件夹的遮掩下，数据分类方法高度工程化的混乱特点也因为计算机文件系统表面上的整洁性而变得模糊起来。

计算机依赖的其实是缓存技术。

缓存在内存架构中起着至关重要的作用，从毫米级处理器芯片布局到互联网的全球配置，都必须建立在缓存的基础之上。缓存为人类生活中各种存储系统和“内存条”提供了一个新的思路。不仅计算机离不开缓存，我们的壁橱、办公室、图书馆，甚至我们的思想，都可以从中受益。





分级存储器体系


莉迪娅·戴维斯

有一位女性，她的感觉十分敏锐，但是记忆力极差……她忘不了工作，而且工作起来特别勤奋。

大约从2008年开始，我们在市场上为新购置的电脑选择存储器时，都会面临一个非常棘手的问题——必须在大小和速度之间做出权衡。计算机行业目前正处于从硬盘驱动器向固态硬盘过渡的阶段。同样的价位，硬盘的容量要比固态硬盘大得多，但是固态硬盘的性能则远胜对手。对于这点，大多数消费者现在已有体会，或者在换用固态硬盘后很快就会有所体会。

漫不经心的消费者可能不知道，计算机内部经常需要做出这种权衡，而且因为这种权衡太频繁了，以至于人们认为这是计算的基本原理之一。

1946年，亚瑟·伯克斯、赫尔曼·戈德斯坦和约翰·冯·诺依曼在普林斯顿高级研究所展开合作，为他们所谓的“电子记忆器官”起草了一个设计方案。他们写道，在一个理想的世界里，机器当然可以有无限量的快速储存能力，但在实践中这是不可能的。（现在仍然不可能。）于是，这三个人退而求其次，提出了“分级存储器体系，每一级的存储能力都超过以前，但是读取速度有所减慢”。事实上，通过各种各样的存储器，有的体积小、速度快，还有的体积大、速度慢，或许我们可以制造出兼具这两个优点的存储器。

任何曾经使用过图书馆的人都可以清楚地了解分级存储器体系背后的基本思想。例如，如果你正在为写论文收集资料，就有可能需要多次参考一些图书。你不可能每次都跑到图书馆，而是把相关书籍借回家，放到你的书桌上。这样，查询起来就方便得多。

在1962年超级计算机阿特拉斯在英国曼彻斯特问世以前，计算领域的这种“分级存储”概念一直停留在理论层面。从外形看，阿特拉斯的主存储器并不像蜡筒留声机，而像一个很大的鼓，它通过旋转来读写信息。但是，阿特拉斯还有一个用极化磁体制成的体积较小、速度更快的“工作”存储器。数据可以从鼓中读取到磁体上，然后在那里轻松地加以处理，最后处理结果将被写回到主存储器的大鼓上。

阿特拉斯问世之后不久，剑桥大学数学家莫里斯·威尔克斯意识到，这种体积较小、速度较快的存储器不仅可以为我们处理数据、将处理好的数据存回主存储器提供了一个非常方便的场所，还可以用来有意地保留稍后可能需要使用的信息片段，为后期类似的需要做好准备，从而极大地加速机器的操作。如果所需要的数据仍然保留在工作存储器中，就不必再到主存储器中装载这些数据了。威尔克斯认为，这种体积较小的存储器“可以自动收集并保存来自速度较慢的主内存的数据，为后期使用做好准备，从而免除了再次访问主存储器带来的麻烦”。

当然，关键是要管理好那个体积小、速度快、价值大的存储器，以保证我们可以在里面找到需要的数据。我们继续以图书馆来打比方。如果你去一次图书馆就可以找到所有需要的图书，然后在家里埋头钻研，其效果可以与你把图书馆中所有的图书都搬到案头的做法相媲美。去图书馆的次数越多，效率就越低下，而办公桌的实际利用价值就越小。

20世纪60年代末，威尔克斯的提议在IBM 360/85超级计算机中得以实现，人们称之为“缓存”。从那以后，计算机科学中到处都有了缓存的身影。将频繁调用的信息片段保存以备后用的效果非常好，因此这个做法在计算的各个方面都得到了应用。处理器有缓存，硬盘有缓存，操作系统有缓存，Web浏览器有缓存，连向这些浏览器提供内容的服务器也有缓存，因此我们可以立刻看到数百万人观看的猫骑真空吸尘器的视频……但是，我们的步子迈得有点儿超前了。

根据人们的描述，计算机在过去50多年里逐年呈指数增长，这为“摩尔定律”精准的预测了下一个注脚。1975年，英特尔的戈登·摩尔提出“摩尔定律”，称中央处理器的晶体管数量每两年翻一番。但是，存储器的性能没有按这个速度提升，这意味着访问存储器时的时间成本也在呈指数增长。例如，你写论文的速度越快，每次去图书馆带给效率的负面影响就越大。同样，如果工厂每年将制造速度提升一倍，但是零部件从海外运送到工厂的速度仍然那么慢，总数也没变，这只能意味着该工厂停工的时间将增加一倍。在一段时间内，摩尔定律似乎没有任何实际意义，它只不过预测出处理器的速度将越来越快，闲置的时间会越来越多。在20世纪90年代，人们开始把这种现象称作“内存墙”。

为了避免一头撞上这堵墙，计算机科学至今为止采取的最有效措施就是缓存、缓存的缓存以及缓存的缓存的缓存，如此而已。现代消费者购买的笔记本电脑、平板电脑和智能手机都有一个6层的分级存储器体系。今天，存储器的智能管理对计算机科学的重要性已经达到了史无前例的高度。

一提到缓存（或者具有类似功能的壁橱），我们大脑中闪现的第一个问题就是：如果它们装满了东西，我们该怎么办？下面，我们就从这个问题开始谈起。





缓存清理与未卜先知


夏洛克·福尔摩斯

相信我，总有一天，当你增加新知识的时候，就会把以前熟知的东西忘了。所以最要紧的是，不要让一些无用的知识把有用的挤出去。

缓存满了后，如果你想继续在缓存中存储其他东西，就必然需要腾出一些空间。在计算机科学中，在缓存中腾出空间的过程被称为“缓存替换”或“缓存清理”。威尔克斯指出：“由于缓存的容量比主存小好几倍，不能无限度地把数据保存在其中，因此我们必须在系统中植入一个算法，逐步覆盖缓存中的数据。”这些算法被称为“替换策略”或“清理策略”，或者简单地称为缓存算法。

我们知道，IBM在20世纪60年代率先推动缓存系统的部署应用。不出意料，它也是早期缓存算法开创性研究的发源地，也许他们取得的任何一项成果都没有拉斯洛·贝莱迪的算法重要。1928年，贝莱迪出生于匈牙利，大学期间学的是机械工程专业。在1956年匈牙利革命期间，身无分文的他逃到了德国，随身携带的书包里只装有“一件内衣和毕业论文”。后来，他又离开德国，来到法国，并于1961年移民到美国。这一次，他带着妻子，“襁褓中的孩子，口袋里装着1000美元。除此以外，就别无他物了”。似乎在他进入IBM研究缓存清理之前，他就已经深谙此道，知道哪些东西该留下来，哪些东西可以抛弃。

贝莱迪于1966年发表的那篇缓存算法论文是随后15年里被引用最多的计算机科学研究成果。这篇论文解释道，缓存管理的目标是尽可能减少“页面错误”或“缓存缺失”。所谓缓存缺失，是指无法在缓存中找到所需数据，因此只能到较慢的主存中查找的现象。贝莱迪在文中写道，从本质上讲，最优缓存清理策略就是在缓存已满时，将未来最长时间内不会再次使用的数据从缓存中清理出去。

当然，要确切地知道什么时候会再次需要某些数据，并不像说起来那么容易。

今天，为了表示敬意，人们把那个无所不知、有先见之明，而且可以在分析未来情况基础上执行最优缓存策略的那个假想算法称作贝莱迪算法。该算法是被计算机科学家称为“千里眼”算法的一个实例，一个可以从未来数据中获取信息的算法。这个概念其实并不像听起来那么疯狂（在某些情况下，系统可能会对未来产生一种期望），但是一般来说，未卜先知是很难实现的，因此软件工程师在实践中试图使用贝莱迪算法时，就会开玩笑说他们遭遇了“实施难题”。因此，我们面临的挑战是找到一种接近于未卜先知的算法，当我们被当前现状遮住双眼的时候，可以借助这种算法看清楚未来的情况。

我们可以尝试随机清理算法，将新数据添加到缓存中，并随机覆盖旧数据。随机清理是早期高速缓存理论得出的一个令人吃惊的结果，虽然远非完美，但是效果也还不错。这也可能是一种巧合，因为只要有一个缓存，无论你如何维护，都可以提升系统的效率。不管怎么说，你经常使用的内容通常还会很快回到缓存中。另一种简单的策略叫作先进先出（FIFO）。这种算法总是清理或覆盖在缓存中保存时间最久的内容（与玛莎·斯图尔特问的“我已拥有它多长时间了”这个问题有异曲同工之妙）。第三种方法是最近最少使用（LRU），即将闲置不用时间最长的内容清理掉（与之相对应的斯图尔特的问题是“上次穿它或使用它是什么时候的事”）。

事实证明，斯图尔特强调的这两点暗示了两种截然不同的策略，而且她的一条建议显然比另一条更有效果。贝莱迪在若干情形下对随机清理、先进先出和最近最少使用的几个变体进行了比较，结果发现最近最少使用法始终表现出最接近未卜先知的效果。最近最少使用法的高效性得益于计算机科学家所谓的“时间局部性”：如果一个程序曾经调用过某个信息，那么在不久的将来它可能会再次调用这个信息。计算机解决问题的方式（例如，执行一个循环，使一系列相关的读和写可以快速完成）是造成时间局部性的一个原因，而人解决问题的方式是另外一个原因。在使用电脑时，你可能会在电子邮件、网页浏览器和文字处理器之间来回切换。你最近访问过这些程序的这个事实就是一个线索，表明你可能会再次访问该程序。在同等条件下，如果某个程序处于闲置状态的时间较长，就表明你在未来一段时间内应该也不会调用该程序。

事实上，这一原则甚至隐含于计算机向用户展示的界面中。电脑屏幕上的窗口有所谓的“Z轴顺序”，即决定程序相互叠加次序的模拟深度。最近最少使用的程序处于底部。前火狐浏览器的创意主管阿扎·拉斯金说：“使用现代浏览器（电脑）在很多时候就相当于从事数字版的文书工作。”与“文书工作”的相似性淋漓尽致地体现在微软系统Windows和苹果系统Mac OS任务切换界面中：当你按下Alt+Tab或Command+Tab组合键时，就会看到，你最近使用过的程序按你使用的时间先后逆向排列。

研究缓存清理策略的相关文献已经达到了令人难以想象的深度，各种算法应有尽有，不一而足，有的可以计算使用频率和最后一次使用时间，有的可以追踪倒数第二次访问的时间，而不关心最后一次访问的情况。不过，尽管创新性高速缓存方案品种繁多，其中一些在适当的条件下甚至可以击败最近最少使用法，但是最近最少使用法（以及在该策略基础上做出的一些细微调整）仍然深受计算机科学家们的喜爱，并且在开发各种应用程序时得到不同程度的应用。最近最少使用法告诉我们，我们需要的下一个程序可能就是之前我们需要的最后一个程序，接下来我们可能还需要之前需要的倒数第二个程序。我们最不需要的可能就是我们弃用时间最长的那个程序。

除非有充分的反对理由，否则我们可以认为对未来最有借鉴意义的就是历史的镜像。最接近于未卜先知的做法就是假定历史会重演，不过是按照相反的顺序重新上演。





重整图书馆藏书


加州大学伯克利分校的地下加德纳书库是加州大学图书馆系统的一大亮点。书库在一扇锁着的门后，门上写着“闲人止步”几个显眼的大字，把想要借阅图书的人堵在门外。这里收藏着科马克·麦卡锡、托马斯·品钦、伊丽莎白·毕肖普、J.D.塞林格、阿娜伊斯·宁、苏珊·桑塔格、朱诺·迪亚斯、迈克尔、查邦、安妮·普劳克丝、马克·斯特兰德、菲利普·K·迪克、威廉·卡洛斯·威廉姆斯、恰克·帕拉尼克、托妮·莫里森、丹尼斯·约翰逊、朱莉安娜·斯帕尔、乔丽·格雷厄姆、戴维·赛达瑞斯、西尔维亚·普拉斯、戴维·马梅特、戴维·福斯特·华莱士和尼尔·盖曼等人的作品。但是，这些不是图书馆的珍本藏书，而是它的“缓存”。

前文讨论过，图书馆与我们自己的桌面空间相互配合，就可以恰如其分地表现出分级存储器体系的特点。实际上，图书馆由不同分区和存储设施构成，本身就是多层次分级存储器体系的一个具体实例，因此图书馆面临各种各样的缓存问题。图书馆工作人员必须决定把哪些书放在图书馆最前面的有限展示空间里，哪些书放到书架上，哪些书放到其他地方储存起来。各图书馆判断哪些书应该异地收藏的策略都不相同，但是几乎所有图书馆都会使用某种版本的最近最少使用策略。加州大学伯克利分校图书馆负责监督这个过程的贝丝·杜普斯说：“举例来说，如果一本图书12年里没有人借阅，我们就会把它撤出主馆。”

图书馆“粗略分类”区的情况与12年没有人借阅的图书正好处于两个极端。我们在前一章讨论过这些图书：它们刚刚被读者归还到图书馆，还没有被完全排序并重新放到书架上。具有讽刺意味的是，在某种意义上看，那些辛勤的图书馆助理在把这些图书放回书架上的时候，可能会让次序变得更乱。

原因很简单。如果时间局部性有效，那么粗略排序书架上摆放的就是整幢楼里最重要的图书。这些都是最近被人借阅过的书，所以学生们寻找的可能就是它们。可以说，图书馆的这种做法就相当于把几英里长的书架中最有吸引力、最值得浏览的那些书架藏起来，不向学生开放，而是让态度认真、埋头工作的图书馆员工不断地破坏它们，这似乎是一种非常愚蠢的决定。

与此同时，墨菲特本科生图书馆的大厅在最显眼、最容易进入的位置摆放一些书架，用来展示图书馆最近添加的图书。这种安排是先进先出缓存的一个具体体现：享受特殊待遇的是图书馆最后添加的图书，而不是刚刚被人借阅过的图书。

鉴于最近最少使用算法在计算机科学家的大多数测试中占尽优势，我们不妨向图书馆提出一个简单的建议：把图书馆的藏书来个乾坤大挪移。把图书馆刚刚添加的图书放到里面的书架，让需要的人去那里寻找；把最近归还的图书放在大厅里，以方便学生自由浏览。

人是一种社会生物，也许大学生希望可以培养自己的阅读习惯。大学经常会指定“普通图书”，目的是促进学生建立共同的学术参照点，而学生自行培养阅读习惯的做法将把校园推向一个更有机、更自由的学术参照点。这样，校园里正在阅读的图书，无论是什么内容，都可能成为其他学生偶然发现的好书，这就相当于实施了一种来自草根阶层、自下而上的普通图书计划。

这样的系统不仅有积极的社会意义，而且可以提高效率，因为最近归还的图书可能很快就会被人再次借阅。也许学生们可能会感到困惑，不知为何受欢迎的图书有时摆放在书架上，有时可以在大厅里找到。因为，曾经的情况是刚刚归还、等候上架的图书既不会出现在书架上，也无法在大厅里找到。在这个短暂的过渡时期，这些图书暂时无法借阅。所以，把刚刚归还的图书摆在大厅里，学生们可以彻底避免受到图书上架的短暂影响，有机会及时借阅这些图书。图书馆员工无须把图书一本本放到书架上，学生们也不必去书库把这些图书拿出来。确切地说，缓存就应该发挥这样的效果。





本地需求


刘易斯·卡罗尔

“实际上我们绘制了这个国家的地图，采用的是1：1的比例尺！”

“你们经常使用这幅地图吗？”我问道。

“这幅地图从来没有被打开过，”米恩·赫尔说，“因为农民不同意。他们说它可以覆盖整个国家，会把阳光遮挡住！所以我们现在就把这个国家本身当作地图使用，我向你保证效果差不多。”

我们通常认为互联网是一个独立的、连接比较松散的平面网络。事实上，根本不是这么回事。目前，1/4的互联网流量是由一家位于马萨诸塞州的公司处理的，但是这家公司总是想方设法，不让自己出现在头条新闻中。它就是从事缓存业务的阿卡迈公司。

我们还认为互联网是抽象的、非物质的，属于后地理时代。我们被告知我们的数据“在云里”，意思是指一个遥远而且不确定的地点。同样，这些也都不是真的。真实情况是，互联网完全是由一捆捆电线和一个个金属架组成的，它与地理的联系比你想象的要紧密得多。

工程师在设计电脑硬件时，考虑的是一个微小尺度上的地理位置：速度更快的内存通常更靠近处理器，这将最大限度地减少信息传输的线路长度。今天的处理器周期是以千兆赫来衡量的，也就是说，它们执行运算所需的时间不到1纳秒。这相当于光传播几英寸[1]的时间——因此计算机内部的物理布局是人们高度关注的焦点。而且，在一个更大的规模上应用同样的原理，实际的地理位置对网络的运行至关重要，因为网络长度不是以英寸为单位的，而是动辄长达数千英里。

如果你能创建一个网页内容缓存，其实际地理位置更接近那些有需要的人，你就可以更快地为他们提供页面服务。互联网上的大部分流量现在都是由“内容分配网络”来处理的，这些网络利用遍布世界各地的电脑维护流行网站的拷贝。因此，在用户请求使用这些页面时，他们可以从附近的一台计算机获取数据，而不必跨越千山万水，连接到原始服务器上。

最大的内容分配网络是阿卡迈公司管理的。内容提供商为了接受阿卡迈的服务，提升网站的性能，就需要向它们付费。例如，一个从BBC（英国广播公司）收看视频的澳大利亚人很可能会向位于悉尼的阿卡迈本地服务器提出请求。这个请求根本不会到达伦敦，也没有这个必要。阿卡迈的首席架构师史蒂芬·卢丁说：“我们始终认为距离很重要，我们也是在这个信念的指引下创建我们公司的。”

在之前的讨论中，我们注意到某些类型的计算机存储器具有更快的性能，但是每个存储单元的成本更大，因此我们希望建成两全其美的“分级存储器体系”。但是我们其实不需要因为缓存的原因而采用不同材料制造存储器。在距离不远时，缓存是个有用的资源，但是性能不同，性能是稀缺资源。

热门文件应该储存在使用环境附近的位置，这个基本见解也可以应用到实实在在的物理环境中。例如，亚马逊巨大的订单履行中心通常不会使用人类可以理解的任何组织类型，不会采用在图书馆或百货商店里可以看到的那种组织结构。他们告诉员工，可以将进库物品放在仓库里的任何地方（电池可以放到卷笔刀、尿布旁边，烧烤架和感声吉他教学光盘也可以成为“邻居”），然后通过条形码在中央数据库中标记每件物品的位置。但是，这种看似故意为之的无序存储系统仍然有一个明显的例外情况：高需求物品被放置在一个更容易进入的区域。这个区域就是亚马逊的“高速缓存”。

最近，亚马逊获得了一项创新的专利，使它奉行的这条原则得到了进一步发展。在媒体看来，这项“可预期包裹配送”专利似乎可以帮助亚马逊在你下单之前就把商品送到你的手上。亚马逊和任何一家科技公司一样，都希望拥有贝莱迪式的未卜先知能力，而它们追求的第二目标就是高速缓存。亚马逊的这项专利实际上是最近非常流行的，将商品运送至一个地区的临时仓库，从而为自己的实体商品开辟一个专用的内容分发网络。有人下订单时，商品就已经在他附近的大街上了。预测个人购买行为是有挑战性的，但是当预测数千人的购买行为时，大数定律就会生效。比如某一天，伯克利的一个人想订购再生纸质卫生纸。就在他下单的时候，这些卫生纸已经完成大部分配送环节，很快就会送到。

当在一个地区深受欢迎的商品也来自该地区时，就会出现“云”这个更有趣的地理位置概念。2011年，影评家米卡尔·莫特思利用网飞公司为美国各州准备的“本地热门”制作了一张美国地图，标注出在这些州特别受欢迎的电影。结果令人大为震惊：绝大多数人都喜欢观看以他们居住地为背景的电影。华盛顿州的人喜欢以西雅图为故事背景的《单身贵族》，路易斯安那州的人喜欢以新奥尔良为背景的《大出意外》，洛杉矶人不出意外地喜欢《L.A.故事》，阿拉斯加人喜欢《挑战阿拉斯加》，而蒙大拿人则喜欢《蒙大拿天空》。[2]因为完整长度的高清视频等文件非常大，所以建立本地“高速缓存”具有极其重要的意义。显然，网飞公司在洛杉矶储存《L.A.故事》的高清视频，是因为电影中的人物就生活在洛杉矶。更重要的是，这部电影的影迷也住在洛杉矶。

[1]1英寸≈0.025米。——编者注



[2]缅因州的居民最喜欢《不羁的天空》，但是原因不明。





家庭生活中的“高速缓存”


虽然缓存首先是计算机内部组织数字信息的一种方案，但是很明显，它同样适用于在人类环境中组织物理对象。当我们与斯坦福大学校长约翰·亨尼西交谈时，这位参与过现代缓存系统开发工作的计算机架构先驱立即看到了两者之间的联系：

缓存其实是一个平淡无奇的概念，因为我们一直在使用它。我的意思是，我掌握的那些信息……有的是我现在就需要留意的，还有一大批放在案头，其余的都被存档，最后锁进大学档案系统，等到需要时，我可能要用一整天的时间才能再找出来。但是，我们一直在用这种技术来组织我们的生活。

这些问题之间的高度相似性意味着我们可以有意识地将计算机科学的解决方案应用到家庭生活中。

首先，当你决定物品该扔还是该留时，最近最少使用原则可能是一个有效的指导原则，其效果比先进先出原则好得多。如果你现在还不时穿一穿上大学穿的T恤，那就没有必要把它扔掉。但是，你好久没穿过的那条格子裤该如何处理？还是把它送到旧货店吧。

其次，合理利用地理位置。尽可能把物品的“缓存”建立在它们通常使用的位置附近。在大多数家居指南中，这并不是一个具体的建议，但是根据人们的亲身体会，这个策略的效果非常好。比如，在朱莉·摩根斯特恩的《组织管理探秘》一书中，有人说道：“我把跑步和锻炼用的服装放在前衣帽间里的一个柳条箱里，这里距离前门比较近。”

威廉·琼斯在《让物品各得其所》这本书中介绍了一个稍显极端的例子：

一位医生向我介绍了她保管物品的一些心得。她说：“孩子们认为我很古怪，因为我总是把物品放在我认为以后还要用到它的地方，即使有的时候这样做似乎意义并不大。”随后，她举了一个例子，她把吸尘器的备用吸尘袋放在客厅沙发的后面。在客厅沙发的后面？这有什么意义吗？原来，她使用真空吸尘器的目的通常是清扫客厅的地毯……吸尘袋装满了，就需要换新的。更换吸尘袋通常是在客厅里完成的，因此她把备用吸尘袋放在那里。

最后一个深刻认识是关于多层次分级存储器体系的。目前，人们还没有把它变成壁橱管理的指导意见。拥有缓存可以取得一定的效果，但是建立多个缓存级别，包括从体积最小、速度最快的到体积最大、速度最慢的各种缓存，可能会有更好的效果。从你的所属物品这个角度看，你的衣柜是一级缓冲，地下室是另一级，而自助存储柜是第三个。（当然，存储速度依次降低，因此你应该根据最近最少使用原则，决定把哪些物品清理到下一级。）但是，你也可以再添加一级缓存以加快存储速度：一个比壁橱体积更小、速度更快、距离更近的缓存。

汤姆的妻子在其他方面都非常宽容，但是她坚决反对把衣服堆在床边的做法，尽管汤姆坚持认为这实际上是一种高效的缓存方案。幸运的是，我们与计算机科学家的对话也帮助他找到了这个问题的解决方法。加州大学圣迭戈分校的瑞克·贝纳斯的研究方向是从认知角度研究搜索引擎，他建议在床边放一个衣物架。虽然衣物架现在已经不多见了，但是它在本质上就是一个一件套壁橱，可以挂夹克、领带和裤子的复合衣架，是你的家庭缓存必备的完美物件。这个例子表明，计算机科学家不仅可以节省你的时间，还可以挽救你的婚姻。





归档与堆存


在决定好哪些东西应该保留以及该储存到哪里之后，最后一个问题就是了解如何对其加以管理。我们已经讨论过哪些东西应该装进壁橱以及壁橱应该放在什么地方这两个问题，但是壁橱里面的物品应该怎么安排呢？

迄今为止，我们见过的所有家居管理建议中，必不可少的一个“常客”就是“物以类聚”这个存放概念。也许没有人会像野口由纪夫那样直言不讳地反对这条建议。他说：“我必须强调，在我的方法中，一个基本原则就是不能把文件根据内容分组。”野口是东京大学的一名经济学家，他通过一系列著作介绍了可以把你的办公室和你的生活变得井井有条的“超级”技巧。这些书的标题可以大致翻译为“超级说服方法”，“超级工作方法”，“超级学习方法”以及与本书最贴近的“超级组织管理方法”。

在他作为一名经济学家的早期职业生涯中，野口发现自己经常被包括通信、数据、手稿在内的各种信息淹没，他每天都需要花费大量时间来管理这些东西。因此，他决定换一种管理方法。他首先为每个文件准备一个文件夹，然后在文件夹封面上标注文件名称和日期，再将装好文件的文件夹全部放到一个大盒子里。这个做法不仅可以节省时间（因为他不必考虑每个文件应该放到哪个位置的问题），而且不需要建立任何组织形式。后来，在20世纪90年代初，他又取得了一个突破：把那些文件夹一个一个地插在盒子的左侧位置。“超级”文件归档系统就这样诞生了。

野口明确指出，无论旧文件还是新文件，都必须遵循左侧插入规则。每次取出一个文件，在使用后放回时都必须把它插到盒子里最左边的那个位置。寻找文件时，也总是要从最左侧开始查找。因此，最近使用过的文件很快就能找到。

野口解释道，因为把每一个用过的文件放到左边，比在原来的地方重新插入文件要简单得多，所以久而久之，就形成了这种习惯。后来他才逐渐意识到这个方法不仅简单，而且效率惊人。

将使用过的文件夹放回去时，采用野口的文件归档系统显然可以节省时间。然而，我仍然需要先回答这样一个问题：这种方法是否方便你找到所需要的文件夹？毕竟，这个方法明显是与其他效率大师唱反调，因为那些大师告诉我们，应该把类似的事情放在一起。事实上，即使从词源学这个角度看，“有组织”（organized）这个词也会让人联想到身体是由一个个器官（organ）组成的。如果细胞没有“物以类聚”，也就是说形状和功能相似的细胞没有组合在一起，器官就不复存在。

但是，计算机科学可以保证它的方法有效，而这是大多数效率专家做不到的。

野口当时并不知道，他的这个文件归档系统其实是最近最少使用原则的一种延伸。最近最少使用法告诉我们，当我们在缓存中添加一些内容时，我们应该丢弃保存时间最久的内容，但是它没有告诉我们应该把新的内容放在哪里。这个问题的答案来自20世纪七八十年代计算机科学家进行的一系列研究。不过，计算机科学家研究的是一个名称为“自组织列表”的不同版本，但是它的设定与野口的文件管理困境几乎一模一样。假设一组物品按序排列，你需要定期从中搜索一个物品，而且必须采用线性搜索方法，也就是说，你必须从头开始，逐项搜索。但是，一旦你找到了所搜索的物品，就可以把它放回序列中的任何位置。要使搜索的效率最高，将物品放回时该如何选择位置？

1985年，丹尼尔·斯雷特和罗伯特·陶尔扬发表了一篇关于自组织列表的权威论文。他们按照计算机科学的经典方式，对所有不同请求顺序下各种列表组织方式的最坏表现进行了研究。根据直觉，由于搜索是从前面开始的，所以你在排列顺序时肯定希望把最可能被搜索的项排在前面。但是，到底是哪些项呢？这个问题再次唤起了我们对未卜先知能力的憧憬。在普林斯顿和硅谷都有职务的陶尔扬说：“如果你提前知道各种请求的先后顺序，就可以有针对性地制定数据结构，把完成整个序列的总时间降到最低。这就是最优离线算法。你也可以称之为上帝的算法，或者天上的算法。当然，没有人知道未来，所以问题是，如果你不知道未来，你能企及这个超凡脱俗的最优算法吗？”斯雷特和陶尔扬的研究结果表明，一些“非常简单的自我调整计划竟然全部遵循千里眼算法的一个常数因子”。也就是说，如果你遵循最近最少使用法，即在把某项放回列表中时，总是把它放到列表的最前面，那么你花在搜索上的时间就不会超过你在预知未来的情况下所需时间的两倍。任何其他算法都无法保证取得同样效果。

一旦认识到野口文件归档系统是最近最少使用原则的一个实例，我们就知道它不仅是一种有效策略，实际上还是最优策略。

斯雷特和陶尔扬的研究结果告诉我们，如果将野口文件归档系统翻转90度，就可以实现一个新的变化。很简单，一盒文件夹就成了一堆文件夹。如果你搜索的是成堆的文件夹，那么搜索顺序自然是从上至下，而且每次你把一个文件放回去的时候，你都不会把它放回到原来的位置，而是放到最上面。[1]

简而言之，自组织列表的数学计算会为我们提供一些激进的建议：你根本没有必要因为案头文件成堆而自责，因为这不是杂乱无序的标志，而是最精心设计和最有效的组织形式之一。在别人看来，这是一种没有组织的混乱局面，但是实际上，它是一个自组织混乱。把东西扔回成堆物品的顶部，是你在无法预测未来时可以采取的最有效的做法。在前一章中，我们发现，在某些情况下，花时间排序之后，效率不升反降。这里，我们同样建议，在某些情况下不需要考虑如何管理的问题，不过理由有所不同：因为你其实已经组织得很好了。

[1]你也可以让电脑把电子文件以文件堆的形式显示在你的眼前。在计算机默认的文件浏览界面，你可以按字母顺序点击文件夹。但是，强大的最近最少使用法建议你放弃这个方案，在显示文件堆时用“最后打开”取代“名称”。这样，你正要寻找的文件基本上一定是在顶部或靠近顶部的位置。





遗忘曲线


当然，在讨论存储器时如果不提及与家庭最密切的“记忆器官”——人类大脑，那么整个讨论就会显得不够完整。在过去的几十年里，由于受到计算机科学的影响，心理学家对记忆的认识发生了翻天覆地的变化。

据说，人类记忆研究始于1879年。当时，柏林大学一位名叫赫尔曼·埃宾豪斯的年轻心理学家希望弄清人类记忆的作用原理，并向人们证明，利用自然科学在数学方面的严谨要求来研究大脑是可行的。于是他开始在自己身上做实验。

每天，埃宾豪斯都会坐下来，背诵一大堆无意义的音节。然后，他会利用前几天列出的列表测试自己的记忆效果。在一年的时间里，他始终坚持这个行为，并证实了人类记忆研究过程中得出的许多最基本的结论。例如，他证实，在背诵音节列表时，增加联系的次数会使记忆持续更久，而随着时间的推移，一个人能够准确回忆的内容会减少。他的研究结果可以绘制成记忆随时间流逝的关系图，心理学家今天称之为“遗忘曲线”。

埃宾豪斯的研究结果证实了人类记忆定量研究的可信度，但他留下了一些未解之谜。为什么记忆效果会形成这种曲线？从这个曲线能看出人的记忆力是好还是不好？曲线背后隐藏了什么信息？100多年来，这些问题让心理学家百思不得其解，并激励他们继续深入研究。

1987年，卡内基-梅隆大学的心理学家、计算机科学家约翰·安德森为了解大学图书馆的信息检索系统，查阅了大量资料。他的目标，或者说他自认为的目标，是弄清楚信息检索系统的设计是否可以从人类记忆研究那里获取灵感。结果，他发现现实正好相反：信息科学有可能为人类大脑研究填补某些空白。

安德森说：“很长一段时间以来我都觉得，现有的人类记忆理论，包括我自己提出的记忆理论，都缺少某些东西。基本上，所有这些理论都认为记忆具有随意性，而且没有优化配制……我一直觉得基本记忆过程具有很强的适应能力，甚至可以取得最佳效果。但是，我从来没有找到合适的框架来说明这一点。在计算机科学领域关于信息检索的研究中，我看到了梦寐以求的那个框架。”

我们往往很自然地认为，遗忘是大脑存储空间被全部占用造成的结果。在安德森对人类记忆的新描述中，其核心思想是，需要解决的可能不是存储问题，而是如何组织的问题。他认为，大脑的记忆能力基本上是无限的，但我们在大脑中搜索的时间是有限的。安德森把大脑比喻成图书馆，不过这个图书馆只有一个无限长的书架，也就是说，是一个美国国会图书馆级别的野口文件归档系统。你可以在那个书架上放无数本书，但是，书的位置越靠近前面，就越容易被找到。

关乎人类记忆好坏的关键因素就和决定计算机高速缓存效果的关键因素一样，都是看我们能否预测未来我们最有可能需要什么。

如果不能未卜先知，在人类世界里做出这种预测的最好方法是理解世界本身。安德森与合作伙伴莱尔·斯科纳一起，开始着手实施一项埃宾豪斯式的研究，不过研究对象不是人类大脑，而是人类社会。问题很简单：世界本身的“遗忘”方式（随着时间的推移，事件逐渐被人们淡忘，再也无人提及）有什么特点？安德森和斯科纳分析了三种人类环境，即《纽约时报》的头条新闻，父母与孩子的谈话录音，以及安德森自己的电子邮件收件箱。在所有的领域中，他们都发现，一个词在刚刚被使用后最有可能再次出现，随着时间的推移，它再次出现的可能性也会逐渐降低。

换句话说，现实本身有一个与埃宾豪斯曲线相似的统计结构。

这个现象给人一种异乎寻常的暗示。如果事物淡出我们记忆的模式与它被我们逐渐弃用的模式完全相同，那么埃宾豪斯的遗忘曲线就很好解释了——大脑为适应世界而完成的精确调整，目的恰恰是为最可能需要的事物腾出空间。




人类记忆与人类环境关系图


注：左图表示埃宾豪斯背诵无意义音节表的正确率与首次背诵后间隔小时数之间的关系。右图表示某个单词在某一天出现在《纽约时报》头条新闻中的可能性与上次出现在出版物后间隔时间之间的关系。

缓存突出强调时间的重要性，从而说明存储器必须做出取舍，需要处理好零和关系。你不能把图书馆的所有图书都搬到你的案头，商场不可能把所有商品都陈列在前台，报纸不可能把所有新闻标题都放在头版，我们也不可能把所有的文件都放在文件堆的最上面。同样，你也不能把所有事实、面孔或者姓名都存储在大脑的“前台”。

安德森和斯科纳指出：“很多人对人类记忆心存偏见，认为人类的记忆力没有积极意义。他们说，他们经常因为记忆失败而心情沮丧。然而，人们在提出这类批评意见时，并没有真正理解人类记忆所面临的任务是要管理数量极其庞大的记忆内容。在任何负责管理庞大数据库的系统中，都必然会遇到检索失败的情况。维护数量庞大的搜索项并保证可以正常接入，花费是非常高的。”

明白了这一点，又可以让我们了解人类记忆的第二个特点。如果这些取舍真的不可避免，而且大脑适应周围世界的能力又非常强，那么我们所说的随着年龄增长而不可避免的“认知能力衰退”可能另有隐情。





经验暴政


卡利马科斯

一本大部头的书就是一个大麻烦。

史蒂夫·赖特

为什么不用造黑匣子的材料制造整架飞机呢？

我们之所以需要以缓存级联这种形式实现计算机分级存储器体系，很大程度上是由于我们在制造存储器时不能全部采用最昂贵的硬件。例如，目前计算机上最快的缓存是用SRAM制造的，它的成本大约是固态硬盘闪存的1000倍。但是我们使用缓存的真正目的并不是单纯地追求速度这么简单。事实上，即使我们可以定制一台全部采用最快存储器的机器，我们仍然需要高速缓存。

约翰·亨尼西说得好，单凭大小这一个参数就足以限制存储器的速度：

如果你把某个东西变大，它的速度必然就会减慢，对不对？如果你让一个城市变大，从A点到B点就要花更长的时间；如果你把图书馆的规模扩大，找到一本书所需要的时间就会更长；如果案头上的文件堆变大了，找文件就需要更多时间，对吧？缓存实际上是解决这个问题的方法……例如，如果你现在去购买一个处理器，你就会发现芯片上有一个一级缓存和一个二级缓存。仅仅在芯片上就有两个缓存！这样做的目的是要跟上处理器的周期速率，而第一级缓存的大小是有限的。

存储器越大，在其中搜索并提取信息就不可避免地需要越多时间。

本书作者在30多岁的时候，就已经发现自己在与人说话时停顿的频率有所增加，有时候某个人的名字“就在嘴边”，但怎么也想不起来。原因还是一样。10岁的布莱恩有20多个同学；20年后，他的电话里有几百个联系人，脸书上则有几千个联系人；他先后在4个城市居住过，每个城市都有朋友、熟人和同事。汤姆此时已经开始了自己的学术生涯，与数百名合作者开展过合作，还教过几千名学生。（事实上，在创作本书的过程中，我们就与大约100人见过面，还引用过大约1000人的谈话。）当然，影响记忆的因素绝不仅限于社会关系。两岁孩子通常大约认识200个单词，成年人通常认识3万个单词。至于情景记忆，每人每年都有33万分钟的清醒时间，因此总的生活体验在不断增加。

考虑到这一点，我们（或者任何人）的大脑还能正常工作，不能不说是一个奇迹。令人惊讶的不是记忆衰退，而是大脑在海量数据不断积累的情况下，仍然能够保持清醒并且做出正常反应的事实。

如果记忆面临的基本问题真的是一个组织管理的问题，而不是存储问题，那么我们在衰老影响心智能力这个问题上的看法就应该改变。最近，图宾根大学的迈克尔·瑞姆斯卡率领一组心理学家和语言学家完成了一项研究，结果发现，所谓的“认知能力衰退”（滞后和检索错误）可能并不表明搜索过程变慢或者搜索能力退化，而是我们所面对的信息量不断变大所带来的一个不可避免的后果（至少是原因之一）。不管衰老还会带来什么样的难题，年长的大脑必须管理数量更多的记忆存储，因此，它其实每天都在解决更复杂的计算问题。面对反应速度更快的年轻人，老年人可以不屑一顾地说：“这是因为你什么都不知道！”

瑞姆斯卡的小组仔细研究了人们使用的语言，以证明额外信息对人类记忆的影响。通过一系列的模拟实验，研究人员发现，知道的单词、姓名或者字母越多，正确识别它们的难度就越大。不管你的组织计划有多好，如果需要在更多的东西中进行搜索，就将不可避免地需要更长的时间。这不是因为我们变得健忘，而是因为我们在回忆。我们正在蜕变成档案。

瑞姆斯卡说，理解记忆不可避免的计算需求，应该可以帮助人们容忍衰老对认知的影响。他说：“我认为，老年人的当务之急是要知道他们的头脑就是一个天然的信息处理设备。随着我们变老，有些事情，例如记住人的姓名，可能会让我们感到沮丧。其实，这与我们需要筛选的东西的数量有关……不一定就表明我们的大脑在衰退。”正如他所说的，“现在被称为衰退的很多过程其实就是学习过程”。

缓存为我们提供了理解当前状况所需的语汇。例如，我们可以用“大脑短路”来表示“缓存错误”。在信息检索中偶尔出现的不协调的滞后，是在提醒我们，把我们需要的内容放在大脑的“前台”，会让我们在剩下来的时间里受益良多。

因此，如果随着年龄增长，你开始经历这种延迟现象，你也不必沮丧。延迟的长度可以表明你的阅历是否丰富，信息检索耗费的精力则可以检验你的知识是否渊博，从延迟发生的频率则可以看出你的组织管理是否合理，有没有将最重要的东西储存在最近的位置。




