# 
> 2018000模板



10 网络 我们如何联系？


温顿·瑟夫和鲍勃·卡恩

联系一词有各种各样的含义。它可以指两个实体之间的物理或逻辑路径，可以指路径的流动，可以进一步指一个与路径的设置相关的动作，也可以指两个或多个实体之间的关联，无论它们之间有没有路径。

E.M.福斯特

只有连接。

一封长途电报以一句奇怪的话开头——1844年5月24日，塞缪尔·F.B.莫尔斯站在美国最高法院的庭院，给他在巴尔的摩的助手艾尔弗雷德·韦尔发了一封电报，里面引用了《圣经》旧约中的一段经文：“上帝创造了什么。”对于任何一个新建立的关联，我们首先要问的都是“它是如何开始的”，这个源头无法帮助我们预测未来。

1876年3月10日，亚历山大·格雷厄姆·贝尔给他的助手打了历史上第一个电话，说的话有点儿类似于悖论。“华生先生，来吧，我想看到你。”同时证明了它有的能力以及无法超越的物理距离。

手机始于一次炫耀——1973年4月3日，摩托罗拉的马丁库珀走在第六大道上，当时曼哈顿的行人都在看他，他正打电话给他的对手——来自美国电话电报公司的乔尔·恩格。他说道：“乔尔，我正用手机在给你打电话。一个真正的手机：一个手持的、便携的、真正的手机。”（“我不太记得他具体说了什么，”库珀回忆道，“但那一瞬间真的很安静。我想象他在咬牙切齿。”）

之后，短信出现了，在1992年12月3日：任职于电信公司的尼尔·帕普沃思提前祝沃达丰公司的理查德·贾维斯“圣诞快乐”。

互联网的开端，不知何故，比刚提到的这些都更卑微、更不吉利。1969年10月29日，加州大学洛杉矶分校的查理·克莱恩通过阿帕网络（ARPANET）给斯坦福大学研究中心的比尔·杜瓦尔发送了有史以来第一条从电脑到电脑的信息。消息内容是“登录”（login）一词（或者应该是这个词，如果接收机器在接收了“lo”两个字母后没有崩溃的话）。

Lo——克莱恩努力让其听起来很有预示性、像《圣经》旧约那样，尽管他自己也没能成功。

人际关系的基础是协议，它是对程序和期望的一种共同的约定，从握手和问候到礼仪、礼貌，以及所有的社会规范。机器连接也不例外。协议是我们如何在同一页上找到的内容，事实上，这个词的根源是希腊语中的protokollon一词，意思是“初次黏合”，它指的是书或手稿上的外页。

在人际关系方面，这些协议证明了一种微妙却又持久的焦虑来源。我在很多天前给某人发了一条消息，但我怀疑他们根本没有收到？现在是中午12点5分，我们的通话定在中午，我们都在期待对方打来电话吗？你的回答似乎很奇怪，是我听错了，还是你听错了？再说一遍好吗？

我们大多数的通信技术（从电报到文本）仅仅为我们提供了一种新的渠道，用以体验人与人之间那些熟悉的挑战。但是，随着互联网的发展，计算机不仅成为一种渠道，也成为终点：对那些说话的人来说。因此，他们需要为解决自己的沟通问题负责。这些机器对机器的问题，以及它们的解决方案，都是在模仿和照亮我们自己。





分组交换


我们现在所认为的“互联网”实际上是许多协议的集合，但其中的主要内容（如此之多，以至于它经常被理解为互联网的同义词）是所谓的传输控制协议，即TCP。这是温顿·瑟夫和鲍勃·卡恩在1973年的一次演讲和1974年的一篇论文中首先提出的，他们还提出了他们所设想的“互联网络”的语言。

传输控制协议最初使用的是电话线，但更恰当地说它是邮件的演变，而不是电话。电话使用所谓的“电路交换”：系统在发送方和接收方之间打开一个通道，只要通话持续，就可以在两个方向之间提供持续的带宽。电路交换对人类的相互作用有很大的意义，但早在20世纪60年代，就很明显地能看出，这种模式对机器通信是不适用的。

正如加州大学洛杉矶分校的莱昂纳多·克莱洛克所回忆的那样：

我知道，电脑在说话的时候不会像我现在这样——不停地说。否则它们就会爆炸！它们会安静一会儿。过了一会儿，他们突然又爆发了。而且，你不能把通信连接用于几乎从来不说话的东西，但是只要它想要说话的时候，它就要立即访问。所以我们不得不使用电话网络，它是为连续的通话而设计的（电路交换网络）但它有些不同。

对于电话公司来说，他们似乎不太愿意谈论他们协议的根本转变。网络研究人员范·雅各布森曾说，不采用电路开关被认为是疯狂的“绝对异端之举”。克兰罗克是这样回忆他与电信行业的故事的：

我去了美国电话电报公司，那里有当时最大的网络，我向他们解释，你们应该给我们提供良好的数据通信。他们的回答是，你在说什么？美国是一座铜矿，所以到处都是电话线，直接用吧。我说，不，不，你不明白。打电话只需要35秒，而你们最少按3分钟收费，而我想发送100毫秒的数据！他们的回答是：“小男孩，走开。”于是，这个小男孩就和其他人一起走开了，但他之后开发了这项技术，抢了那些人的饭碗。

抢电路交换饭碗的技术将被称为包交换。包交换的网络没有给每个链接设立专用渠道，发送方和接收方将它们的消息拆分放入一个个称为“数据包”的小碎片中，再将这些碎片合并到数据的公共流中（有点儿像以光速移动的明信片）。

在这样的网络中，“你可能会说连接的是两个端点之间共同的幻觉，”苹果网络专家斯图尔特·切希尔解释道。“互联网上没有联系。在互联网上谈论一个连接就像是在谈论美国邮件系统中的一个连接。你给人写信，每封信都是独立的，你可能会有信件往来，并且有一定的连续性，但美国邮政不需要知道这些……他们只是投递信件。”

高效利用带宽并不是在20世纪60年代推动对包交换研究的唯一动力，另一个原因是核战争。兰德公司的保罗·巴兰正试图解决网络鲁棒性问题，以便军方通信系统能够在核进攻中幸存下来，而核进攻可以毁坏大部分的网络。受20世纪50年代为迷宫导航而开发的算法的启发，巴兰提出了一种设计，在这个设计中，每一条信息都可以通过自己的方式抵达目的地，即使网络处于动态变化中，或者已成碎片。

这是电路交换及其专用、稳定连接的第二个缺点：非常稳定意味着通话中断就会一直中断。电路交换不够灵活或适应能力不够强，体现不出足够的鲁棒性。而且，在这里，包交换也可以提供这个时代所需要的东西。在电路交换网络中，如果其中的任何一个链接被中断，通话就会失败，这意味着当网络变得更大时，可靠性会呈指数级下降。另一方面，在包交换中，不断增长的网络的路径扩散成为它的一种优点：现在有更多的方法可以让数据流动起来，因此网络的可靠性随着它的变大成倍地增长。

尽管如此，正如范·雅各布森所言，即使发明了包交换技术，电话公司也不为所动。“所有的电信人员都很大声地说，那不是网络！”那只是利用我们网络的一种糟糕的方式！你用我们的电线，用我们创造的路径进行传输！但你又在上面放了很多胶水，因此你就无法有效地使用它。但是，从包交换的角度来看，电话线只是一种达到目的的方式，发送方和接收方实际上并不关心数据包是如何传递的。在不同数量的不同媒体上进行不确定操作的能力将是包交换的伟大美德。在20世纪60年代末和70年代早期的初期网络（如阿帕网络）之后，所有类型的网络都证明了这一概念的可行性，并开始在全美国范围内发展壮大，包交换不仅可以在铜线上进行，还可以通过卫星和无线电。2001年，挪威卑尔根市的一群计算机科学家甚至曾短暂地实施了一项名为“信鸽”的包交换网络，即写在纸上并包装起来，然后绑在鸽子的脚上。

当然，分组交换也不是没有一点儿问题。对于任何协议、人类或机器来说，首先要问的问题之一就是：你如何知道你的消息已经发送了？





信息确认


温顿·瑟夫和鲍勃·卡恩

任何传输都不是绝对可靠的。

“上帝创造了什么”并不只是在美国发出的第一条远程电报信息，它也是第二个：艾尔弗雷德·韦尔把这段引文又发回了在最高法院的莫尔斯，作为确认收到之前信息的一种方式。

现在，韦尔的回答可能会使莫尔斯和美国的立法者们都聚集在他周围，他相信莫尔斯的信息已经收到，当然，韦尔事先并不知道这会是什么样的信息。但是，怎样才能使韦尔知道他的确认已被接收了呢？

计算机科学家们知道这个概念是“拜占庭将军的问题”。想象一下有两个将军，站在一个山谷的两边，他们有共同的敌人，试图共同协调进攻。只有通过完美的同步，他们才能成功，因为单独攻击就意味着自取灭亡。更糟糕的是，两名将军之间如果要传送任何消息都必须通过敌人所在的阵地，这意味着任何信息都传送不出去。

第一个将军，例如他想建议发起攻击的时间，但他一人又不敢擅自进攻，除非他知道他的同伴也会一起出发。第二名将军收到命令并发回确认，但除非他知道第一个将军收到了确认，否则他也不敢发动攻击（因为第一个将军是不会独自去的）。第一个将军接受了确认，但仍不会进攻，因为他要等待第二位将军知道他收到了才行。遵循这一逻辑链需要一系列无穷无尽的信息，显然我们不需要这样做。沟通是一件只有在实践中才能奏效的令人愉快的事情，在理论上它是不可能的。

在大多数情况下，沟通失误的后果很少会如此可怕，对确定性的需求也很少会如此绝对。在传输控制协议中，失败通常只会导致重新传送，而不是死亡，因此对一个会话来说，这已经足够了，可以从所谓的“三重握手”开始。访问者说你好，服务器确认你好，并回复你好，访问者确认了这一点，如果服务器收到这第三条消息，则不需要进一步确认，他们就会开始正题。然而，即使在最初的连接完成之后，仍然存在风险，即一些后续包可能在传输过程中受损或丢失，或者出现故障。在邮件投递中，包裹的递送可以通过回执来确认。在网上，包裹递送可以通过所谓的确认包或确认字符来确认。这些对网络的运作至关重要。

确认字符工作的方式既简单又睿智。在三次握手的背后，每台机器都提供了一种序列号，而且每一个发送的数据包每次都会在发送的时候增加一个序列号，就像支票簿上的支票一样。例如，如果你的计算机启动与网络服务器的联系，它可能会向该服务器发送信号，例如数字100。服务器发送的确认字符还将指定服务器自己的数据包的序列号（例如5000），同时还会说“101号准备好了”。你机器的确认字符的序列号将是101号，并将“传送5001号”。（注意，这两个编号方案是完全独立的，每个序列的开头数通常是随机选择的。）

这种机制提供了一种精确的方法来确定数据包何时走错路。如果服务器期望得到101号，却得到了102号，那么它将发送一个确认字符到102号数据包，并仍然说“101号准备好了”。如果它下一次收到的是103号，它会再说一次，“101号准备好了”。重复三次这样冗余的操作后，它将会向你的机器发出信号：101号不仅被延迟了，而已经无望地消失了，所以它会重新发送那个数据包。在这一点上，服务器（保留了102号数据包和103号数据包）将发送一个确认字符“104号准备好了”用以表示已经恢复了序列。

实际上，所有这些确认都可以增加相当数量的流量。我们认为，大文件传输是单向的操作，但实际上接收方会向发送方发送数百条“控制消息”。2014年下半年的一份报告显示，在高峰时段，近10%的上游互联网流量来自网飞公司（我们倾向于认为这几乎完全只向下游、向用户发送数据）。但是这样的视频产生了大量的确认字符。

在人类领域，对信息是否真正已被接受的焦虑，在对话中也同样普遍存在。演讲者可能会下意识地附加“你知道吗”在每句话的末尾，对听众来说，这是起不到什么帮助作用的，只能源源不断地附和着点头，或说出一些无用的回复。我们甚至在面对面交流时也会这样做，但在打电话时，这却是唯一知道通话是否还在继续的方法。难怪在21世纪无线运营商的一次最成功的营销活动中，主打网络工程师关于质量控制的口号，这句话一次又一次地重复：“你现在能听到我说的吗？”

当问题反复出现时，我们往往会留下一个问号。正如软件博客作者泰勒·特里特所说：

在分布式的计算机系统中，我们试图通过等待接收确认来保证消息的传递，但是所有的事情都可能出错。消息被丢失了吗？那个确认字符丢失了吗？接收器崩溃了，还是它们只是太慢了？是网络太慢，还是我太慢了？

他提醒我们，拜占庭将军所面临的问题“不是设计的复杂性，而是不可能的结果”。温顿·瑟夫注意到，早期网络研究的发现都是基于你可以建立一个可靠的网络的假设。另一方面，“互联网基于这样一个假设，即没有任何网络是绝对可靠的，你必须进行端到端的重新传输来恢复错误”。

具有讽刺意味的是，对此很少有例外，其中有一种例外就是对人类声音的传递。实时语音通信，如网络电话（Skype），它通常不使用传输控制协议，而传输控制协议是互联网其余部分的基础。正如研究人员在早期网络中发现的那样，使用可靠的、鲁棒性强的协议（带着所有的确认字符，以及对丢失的数据包进行重新传输）来传输人类的声音是有些多余的。人类自己可以提供鲁棒性。正如瑟夫解释的那样，“在传输声音的情况下，如果你丢失了一个数据包，你只会说‘再说一次，我刚刚有些没听到’。”

出于这个原因，自动将背景噪声降低到无声状态的这项电话服务对用户造成了极大的伤害。背景静态是一种持续的保证，可以保证呼叫仍然是连接的，但很明显，通话中出现的任何沉默，都是通话的另一方刻意的选择。如果没有这项服务，人们就必须不断地面对电话已经掉线的可能性，并不断地确认它到底有没有掉线。这也是所有包交换协议的存在焦虑，事实上，任何一种根植于异步转变的媒介，无论是写信、发短信，还是尝试性的反复的在线约会，都是如此。每条信息都可能是最后一条，有人花时间去回应，而有人早就结束了对话，通常也没有什么区别。

那么我们该如何处理一个不可靠的人或电脑呢？

第一个问题是，我们应该认为多长时间的不响应可以构成故障。这在一定程度上要取决于网络的性质：我们会在电话打出后的几秒，电子邮件发出后的几天，以及信件发出后的几周就开始担心。发送方和接收方之间的往返时间越长，保持沉默的时间就越长，而且在发送者意识到存在问题之前，可能会有更多的信息“在飞行中”。在计算机网络设计中，让各方正确地调整他们对确认时间的期望，对系统正常运转至关重要。

当然，一旦我们意识到故障已出现，第二个问题就是我们应该怎么做。





指数退避算法：宽恕的算法


英国广播公司

世界上最难翻译的词已经被确认为是“ilunga”一词，源自刚果民主共和国东南部的希鲁巴语。Ilunga一词的意思是“一个人第一次愿意原谅任何虐待，第二次还容忍，但绝没有第三次”。

T.H.帕尔默

如果一开始你不成功，那就尝试，再尝试一次。

今天，我们希望我们的设备能够进行无线通信，例如，我们的键盘和鼠标可以与电脑相隔几米，通过无线的方式相互连接。但是无线网络的出现是出于必要，尤其是在一个没有电线用来这样做的地方——夏威夷。20世纪60年代末和70年代初，诺曼·艾布拉姆森试图将位于檀香山的夏威夷大学的7个校区和分布在4个岛屿和数百英里外的许多研究机构联系在一起。他的想法是通过无线电实现包交换（而不是通过电话系统）将这些岛屿与一个个的发射器和接收器连接起来。这个系统后来被称为阿罗哈网络（ALOHAnet）。

阿罗哈网络必须克服的最大障碍是干扰。有时两个站点会在同一时间发出信号，这就无意中干扰了彼此的信号。（当然，这也是人类对话中的一个常见特征。）如果两个站点都只是立即重新传输，以送达它们的信息，它们就会冒着永远被困在干扰之中的危险。显然，阿罗哈网络协议需要告诉竞争信号如何给彼此空间，如何为彼此让路。

发送者需要做的第一件事就是所谓的“打破对称”。就像人行道上的行人所知道的那样，当迎面而来的人偏向左边时，自己就躲向右边，两人都向同一边，就什么也解决不了。类似地，当两个说话的人都停下来，做出让另一个人说的手势以示尊重，然后又在同一时间开始说话；或者当两辆车在十字路口相遇，两车都停下来让对方，然后又试着同时加速。这是一个普遍使用随机性的领域，事实上，如果没有它，网络设计是不可能实现的。

一个简单的解决办法就是让每个站点都抛硬币。正面，就再发送一次，反面，就等待一个回合，然后再发送。毫无疑问，其中肯定有一个很快就能轻松送达。当只有两个发送者时，这就能很顺利地运行了。但是如果有三个信号同时发送呢？或是4个？在这一点上，网络只有1/4的机会能获得一个单独的数据包（在此之后，你仍然会有三个相互冲突的站点，甚至可能会有更多的相互竞争的信号等待到达）。随着冲突数量的进一步增加，网络的吞吐量可能会如悬崖掉落般骤降。1970年的一份关于阿罗哈网络的报告显示，在电波的平均利用率仅为18.6%的情况下，“这个频道变得不稳定……再传输的平均数量变得不可控了”。这样并不好。

那么，应该怎么做呢？有没有一种方法可以避免陷入这种命运？这一突破在每次连续失败最后都提高了平均延迟时间，具体来说，就是在试图再次传输之前将潜在的延迟加倍。因此，在最初的失败之后，发送者会在一个或两个回合之后随机地重新传输，在第二次失败之后，它会在1~4个回合之后再次尝试，第三次失败将意味着要再等待1~8个回合，以此类推。这种简练的方法使网络能够容纳各种潜在的竞争信号。因为最大延迟长度（2，4，8，16……）呈现一种指数级的递增，因此它被称为指数退避算法。

从1971年开始，指数退避算法就成为阿罗哈网络成功运作的一个重要组成部分，20世纪80年代，它被应用于传输控制协议，并成为互联网的一个重要组成部分。几十年后的现在，它仍然是如此重要。正如一篇有影响力的论文所言，“对于一个嵌入在未知拓扑网络中的传输端点，以及一个未知的、不可知的并不断变化的相互竞争的会话的群体，只有一个有可能有用的方案——指数退避算法”。

但该算法的其他用途表明了一些更规范、更深奥的内容。除了避免冲突，指数退避已经成为处理几乎所有网络故障或不可靠性的默认方式。例如，当你的电脑试图到达一个看起来马上就要瘫痪的网站时，它会使用指数退避算法，一秒后再试一次，几秒后再试一次，直到成功。这对每一个人都有好处：它可以防止瘫痪的主机服务器在恢复之后不会因为过多访问而又被再次攻击，同时防止你自己的机器浪费大量的精力做无用功。但有趣的是，它也不会强迫（或允许）你的机器完全放弃。

指数退避算法也是网络安全的一个重要组成部分，当你登录一个账户时，密码连续错误，就会受到指数倍增长的锁定周期的惩罚。这可以防止黑客对账户进行“字典攻击”，你可以用可能的密码一个个尝试登陆，直到最终密码正确，登陆成功。与此同时，它也解决了另一个问题：无论电脑账户的真正所有者是多么健忘，在一些任意的中断之后，他不会被永远锁定。

在人类社会中，我们倾向于采取一种政策，给人们一些有限的机会，然后完全放弃。三振出局，你出局了。这种模式在几乎任何需要宽恕、宽容或坚持的情况下都是默认的。简单地说，也许我们做错了。

我们的一个朋友最近在思考关于一个童伴的故事，她常因结束一段关系而陷入窘迫。要怎么做呢？决定一次又一次之后，她最后已经受够了，完全放弃了这段感情，这种行为似乎很武断且后果严重，不停地重新决定似乎过于天真，因为有可能会导致无穷无尽的失望和浪费时间。解决方案是：在邀请率上的指数退避。试着在一周内重新安排时间，然后是两周，然后是四周，然后是八周。“重发”率趋向于零，但你永远不需要完全放弃。

我们的另一个朋友在思考是否该为一个有毒瘾史的家庭成员提供住所和财政援助，她为此感到很痛苦。她不忍心放弃希望，希望他能幡然悔悟，又无法忍受自己再回头犹豫。但她也不能倾其所有满足他的一切要求——给他买衣服，为他做饭，为他重新开设银行账户，并每天早晨开车送他上班，在某个神秘和突然的时刻，他也许会拿着所有的钱消失，然后在几周后再打来一个电话，请求原谅及再次收留。这似乎是一个悖论，一个残酷而不可能的选择。

在这样的情况下，指数退避算法并不是灵丹妙药，但它确实能提供一种可能的方法。例如，需要一个指数增长的清醒时期，可以抑制再次违反家庭内的规则。这将使这位家庭成员要更加努力地证明自己是认真的回归，并且会保护主人免受循环往复的持续压力。也许最重要的是，主人永远不会告诉那位亲戚她已经放弃了他，要不他就无法挽救了。这提供了一种能够拥有有限的耐心和无限仁慈的方法。也许我们就不需要做选择了。

事实上，在美国，过去的十年见证了一场悄无声息的革命的开始，这场革命让司法系统本身就能处理好对毒品犯罪者的社会监控。这场革命是由一个名为“希望”的试点项目发起的，该项目采用了阿罗哈网络的指数避退原则。而这也是一个惊人的巧合，它也始于阿罗哈网络的诞生地——檀香山。

在向夏威夷第一巡回法院宣誓就职后不久，法官史蒂文·阿尔姆注意到了一个显著的模式。缓刑犯会多次违反他们的缓刑条款，巡回法官通常会使用他们的自由裁量权警告他们。但在某种程度上，也许在十几次或更多的违规之后，法官将决定严格执行，并将违反者判为有期徒刑。阿尔姆说：“我想，尝试改变别人的行为是一种疯狂的方式。”所以阿尔姆提出了一种几乎完全相反的想法。他提出，取消在未来的很长一段时间里进行的违规听证会，而是希望项目进行不确定的裁判，有时还会判决巨大的惩罚，这都是建立在即时的、预先设定好的惩罚基础上的，这种惩罚开始只会让违反者入狱一天，然后在每次犯规后都逐渐增加入狱时间。美国司法部的一项为期5年的研究报告称，希望项目中的缓刑犯被逮捕或直接撤销缓刑的可能性是普通缓刑犯的一半，他们吸毒的可能性降低72%。之后，有17个州效仿夏威夷的做法，推出了自己版本的希望项目。





流量控制和拥塞避免


计算机网络设计首先集中于研究如何在不可靠的链接上建立可靠的传输。这些努力被证明是非常成功的，紧接着便出现了第二个问题：要确保已经过载的网络如何能够避免灾难性的崩溃。传输控制协议刚一解决数据从A点传到B点的问题，之后就遇到了阻塞问题。

最重要的早期预警发生在1986年，连接劳伦斯伯克利实验室和加州大学伯克利分校的一条线路被一个足球场长度的地段隔开。（在伯克利，这个地段恰好是一个足球场。）有一天，这条线上的带宽突然从每秒32000位下降到每秒40位。其中的受害者就包括劳伦斯伯克利实验室的范·雅各布森和加州大学伯克利分校的迈克尔·卡雷尔，“他们对这突如其来的带宽速度的剧烈下降现象很感兴趣，并着手调查它为什么会变得如此糟糕”。

与此同时，他们听到美国其他网络设计团队的抱怨，他们都遇到了同样的事。雅各布森开始研究其深层的代码。“协议中有什么错误吗？”他想，“这是在小规模的测试中进行的，然后突然之间它就崩溃了。”

电路交换和包交换之间最大的差异在于它们是如何处理拥塞的。在电路交换中，系统要么批准通道请求，要么如果请求不能被满足，就直接否定。这就是为什么，如果你在某个高峰时期尝试使用电话系统，可能会收到“特殊信息音”和“所有电路都很繁忙”的信息。

包交换是完全不同的。电话系统会变得忙碌，邮件系统会变慢。网络拥塞可以清楚地告诉发送者，还有多少其他的发送者，或者在某一时刻网络的拥挤程度，以及拥塞的量是如何不断变化的。因此，发送方和接收方不仅必须保持沟通，还必须进行元沟通：他们需要弄清楚数据发送的有多快。不知何故，组合的数据包流（没有明确的管理或协调）必须停止相互挡路，并迅速利用任何可用的新空间。

雅各布森和卡雷尔的调查结果是修订了一组流量控制和拥塞避免算法，这是40年来对传输控制协议最大的修改之一。

传输控制协议拥塞控制的核心是一个被称为“和式增加积式减少”的算法，简称AIMD。在AIMD启动之前，一个新的连接将会积极地提高传输速率：如果第一个包被成功地接收，它会再发送两个包，如果这两个包都通过了，那它就发送4个包，以此类推。但是一旦数据包的确认字符没有发回到发送方处，AIMD算法就开始接管这个问题了。在AIMD算法下，任何完全接收到的数据包会让飞行中的包数不是增加一倍，而是仅仅增加一个，而丢失的数据包会导致传输速率减少一半（由此得名和式增加积式减少算法）。本质上，该算法的形式就像是某人在说，“多一点儿，多一点儿，多一点儿，噢，太多了，去掉一些，再多点儿，再多点儿……”我们发现，它会形成一种典型的带宽形状，即所谓的“传输控制协议的锯齿形”——稳定向上爬升，突然猛烈下降。

为何会如此猛烈不均匀的下降呢？正如雅各布森和卡雷尔所解释的，AIMD的第一次启动是当一个连接在其最初的侵略性的启动阶段中，第一次出现了丢失数据包的问题时。因为在初始阶段，每次成功齐发之后传输速率都会加倍，一旦出现问题，速度就降低一半，这是完全合适的。一旦数据开始传输，如果它又开始降速，那很可能是因为一些新的连接在竞争网络。对此最保守的评估就是，假设你是唯一一个使用这个网络的人，现在有一个人占用了你一半的资源，也会导致速度减少一半。在这里，保守主义是必不可少的：只有当网络的用户速度减少到至少是超载时的速度，才能保证网络稳定。出于同样的原因，仅仅进行和式增加有助于稳定所有人正在做的事情，可以防止快速超载和恢复的周期循环。

虽然加法和乘法之间的严格区分是不太可能在自然界中发现的，但传输控制协议的锯齿确实在各种领域中找到了共鸣，在这些领域都是为了尽可能多地获取安全的信息。

例如，在2012年的一次偶然的合作中，斯坦福大学的生态学家黛博拉·戈登和计算机科学家巴拉吉·普拉布哈卡发现蚂蚁似乎比人类早几百万年就已经开发出了流量控制算法。就像计算机网络一样，蚁群在试图管理自己的“流量”时面临着分配问题，在这种情况下，蚂蚁的流动是为了在多变的条件下觅食，这可能会大大影响蚂蚁成功往返的速度。就像互联网上的计算机一样，蚂蚁必须在没有中央决策者的帮助下解决这个共同的问题，而不是去发展戈登所说的那种“没有层级的控制”。结果表明，蚂蚁的解决方案也很相似：这是一个反馈周期，成功的觅食者会促使更多觅食者离开巢穴，而没觅食成功的返回者则会导致觅食行为的减少。

其他动物也会引起传输控制协议的流控制，凭借其特有的锯齿。松鼠和鸽子在追逐人类的食物残渣时，每次都会向前一步，偶尔也会跳回来，然后又稳步向前。可能是人类通信本身反映了传输的协议：每一条短信或电子邮件的回复都鼓励再发一条，而每一条未返回的消息都能阻止这种过程。

更广泛地说，和式增加积式减少算法为生活中的许多方面提出了一种想法，在生活中的这些方面，我们努力在不确定和波动的条件下分配有限的资源。

讽刺性的“彼得原理”是由教育学教授劳伦斯·J.彼得在20世纪60年代提出。彼得说：“每个员工都倾向于提升自己的能力。”该想法是，在一个分等级的组织中，每个能熟练完成工作的人就有机会晋升到新的岗位，这个岗位可能要完成更复杂或更不同的挑战。”当员工最终进入一个他们表现不佳的角色时，他们的队伍就会停滞不前，他们会在职业生涯剩余的时间里继续担任这个角色。因此，这是有道理的，按照彼得原理的预测性推理，最终一个组织中的每一个职位都会被一个做得不好的人填补。在彼得原理被提出的50年之前，西班牙哲学家何塞·奥尔特加·伊·加塞特于1910年也发表了同样的观点。他写道：“每一个公务员都应该被降职到更低的级别，因为他们会一直被提升，直到他们能力不足时。”

一些组织试图通过解雇停滞不前的员工来弥补彼得原理。所谓的凯威制是由著名的凯威斯恩和摩尔法律事务所设计的，该制度几乎只聘用应届毕业生，把他们安排在最底层，然后在接下来的几年里要么提拔他们，要么解雇他们。1980年，美国武装部队与国防部官员人事管理法案也实施了类似的“晋升或出局”政策。英国也同样追求他们所谓的“曼宁控制”，这曾引起很大争议。

在彼得原理的制度停滞和严格的“晋升或出局”系统之间，有没有其他的选择，有没有中间地带？和式增加积式减少算法就可以提供一种选择，因为它是明确用来处理不稳定环境的。计算机网络必须要管理好自己最大的传输能力和客户的传输速率，所有这些都可能是不可预测的波动。同样，在商业环境中，公司用有限的资金来支付其运营费用，而每个工人或供应商所能做的工作量以及所能承担的责任数量都是有限的。每个人的需求、能力和伙伴关系都是不断变化的。

传输控制协议的锯齿形的教训是，在一个不可预测和不断变化的环境中，把事情放到失败的角度去考虑有时确实是最好的（或者唯一的）充分利用所有资源的方法。重要的是要确保对失败的反应是尖锐和有弹性的。在和式增加积式减少算法下，每个没有崩溃的连接都应该是不断加速的，然后降速一半，之后又立即开始加速。尽管这几乎违背了当今企业文化的规范，但你可以想象一家公司，每年每一个员工要么在组织结构图上提升一步，要么直接离开。

正如劳伦斯·J.彼得自己所认为的，可怕的彼得原理出现在公司里，因为“等级生活的第一条戒律是等级制度必须被保留”。相反，传输控制协议则教授灵活性的好处。公司讲究的是“扁平平面”的层次结构和“垂直”层次结构，但他们可能会考虑使用动态的层次结构。在和式增加积式减少算法体系下，没有人会长期担心工作难以完成，也不会长期怨恨没有得到晋升。两者都是暂时且频繁的调节剂，而且系统尽管每时每刻都在发生变化，但都会在平衡状态附近徘徊。也许有一天，我们说的不是职业生涯的弧线，而是它的锯齿形。





反馈语：语言学的流量控制


通过研究网络的流量控制，我们可以清楚地发现，上游的确认字符数据包不仅能够认定和确认传输，还能影响整个相互作用的轮廓、速率和节奏。这为我们发出了一个提醒，也让我们了解到反馈对沟通的重要性。在传输控制协议中，正如我们所看到的，没有单向传输：缺少一致的反馈，发送方几乎会立即减速。

奇怪的是，人们逐渐意识到网络领域中反馈的关键作用的趋势，也同时出现在语言学领域。20世纪中叶，语言学被诺姆·乔姆斯基的理论所主导，该理论在研究语言时，将其置于最完美和最理想的状态进行考虑——完美流畅的、符合文法的、不间断的句子，仿佛所有的交流都是书面文字。但从20世纪六七十年代开始，大量对口语的实用角度的兴趣揭示了语言过程的复杂和微妙，包括话题转换、中断、根据听众的反应遣词造句等。这里出现的是一种表面上的单向沟通的愿景，实则是一种合作行为。正如语言学家维克托·英格维在1970年所写的那样，“事实上，拥有话语权的说话者和他的朋友同时都在说和听”。这是因为我所称的“反馈语”的存在，在这个过程中，拥有话语权的人会收到一些短的信息，比如“是”和“嗯”，而不会放弃话语权。

对人类“反馈语”的审视为语言学领域开辟了全新的视角，促使人们对交流的动力进行全面的重新评估，特别是听者的角色。在一项例证研究中，由维多利亚大学的珍妮特·巴维拉斯领导的一个小组调查了一件事，当一个人听另一个人的故事时如果注意力分散了会发生什么（不是指对听者理解的影响，而是说的故事会发生什么变化）。他们发现，在反馈不佳的情况下，这个故事就支离破碎了。

叙述者勉强将这个故事讲完……总体说得不太好，而且本应很有戏剧性的结尾说得尤为糟糕。他们说的故事结束得很突然，或者是不断改变的，或者他们绕着圈子反复地讲故事的结局，他们常常通过解释自己的表现不佳来为自己故事的不佳辩护。

我们都有过与别人交谈的经历，别人的眼睛有时会飘向他们的手机，也许这会让我们开始怀疑，我们平淡无奇的故事是否该受责备。事实上，现在很清楚，这里因果关系往往是相反的：一个糟糕的听众往往会毁掉一个故事。

对人类反馈语的确切功能和意义的了解仍是一个具有积极意义的研究领域。例如，2014年，加州大学圣克鲁兹分校的杰克逊·托林斯和让·福克斯·乔斯向我们展示了那些不起眼的语气词，如“嗯”“是的”“呃”和“噢”，这些语气词促使我们说的话表现出独特、精确的角色，来规范信息从说话者到听者间的流动，包括详细的速度和水平。实际上，它们都与传输控制协议中的确认字符一样重要。托尔斯说：“实际上，有些人可能比其他人更糟，‘不善于说故事的人’至少可以将责任部分推到他们的听众身上。”这一认识产生了意想不到的副作用，即在他讲课时可以减轻一些压力，当然包括关于这个研究结果的讲座。他开玩笑说：“每当我谈论这些反馈语的时候，我总是告诉听众，他们对我演讲的反馈可以改变我说的内容，所以他们要对我的表现负责。”





缓存膨胀：这就是延时，傻瓜


凯瑟琳·尼科尔斯

由于对排队的原因和意义的误解，开发有效的、活动的排队管理一直受阻。

2010年的夏天，和许多家长一样，吉姆·格蒂斯经常接到孩子们的抱怨，说家庭无线网络运行缓慢。不过，与大多数家长不同的是，盖茨已经在惠普、阿尔卡特朗讯、万维网联盟和互联网工程专责小组工作。他在1999年是现在仍在使用的超文本传输协议规定的编辑。因此，就像大多数善于钻研的父亲可能都会研究这个问题，格蒂斯也对此进行了调查。

格蒂斯用网络术语向一屋子的谷歌工程师表达了一种迫切而明确的信念：

我碰巧正在这条从我家到麻省理工学院10毫秒长的小路上，复制或加密异地备份旧的X财团的档案。在复制文件的同时，网络性能监视报告延时平均超过1秒，以及有坏包丢失。我选了网络封包分析，还有一些非常奇怪的行为出现……这看起来不像我期望的传输控制协议（锯齿形）。它不应该那样发生。

用简单的英语来说，他看到了一些东西……非常奇怪的东西。俗话说：“在科学中听到的最激动人心的一句话，就是预示着新发现的那句话，不是‘有了！’而是‘很有趣’。”刚开始，格蒂斯认为他的电缆调制解调器有问题。他的家人在互联网上所称的问题，就像他们自己的墙上插座里出现的交通堵塞。本该去往波士顿的数据包没有被卡在途中，他们被困在了家里。

但是当格蒂斯研究得越深，他就越为之担心。这个问题影响的并不仅仅是他家的路由器和调制解调器，而是所有家庭的路由器和调制解调器。问题不只是在网络上，而是在电脑本身、台式机、笔记本电脑、平板电脑和智能手机上，交织在Linux、Windows和OSX等操作系统上。它也不只是出现在终端用户的硬件上，它还触及了互联网本身的基础设施。格蒂斯与康卡斯特、威瑞森、思科和谷歌的核心人物一起共进午餐，其中还包括范·雅各布森和温顿·瑟夫，并开始慢慢将拼图拼出。

问题无处不在。问题就是缓冲膨胀。

缓冲区实际上是一个队列，它的作用是消除突发事件。如果你和另一个顾客差不多同时走进一家甜甜圈店，暂时过于忙碌的收银员并不会让你先离开这家商店，下次再来。当然，客户不会这样做，但管理者也不会：这样的政策肯定是没有充分利用收银员的作用。将客户放在队列中，可以确保存储的平均吞吐量接近其最大吞吐量。这是一件好事。

然而，这种良好的资源利用率带来了一种非常实际的代价——延迟。当汤姆带他的女儿去伯克利时，她的心全在一个巧克力香蕉可丽饼上，于是他们就排队等着去买。最终（20分钟后）汤姆走到队伍的最前面，点了单。但在付完钱之后，他们还要再等40分钟才能真正得到可丽饼。（就像吉姆·格蒂斯一样，汤姆很快发现自己有大量家庭投诉。）接受订单的时间比做可丽饼的时间要少，因此排队订购仅仅是问题的第一部分。但至少这个队伍是可见的，客户知道他们等的目的是什么。第二部分的等待，这里更长的队伍是看不见的。所以在这种情况下，如果可丽饼柜台在某一时刻切断了等待的队伍，并竖起了一个告示说，他们不再接受订单，那么这将是一个更愉快的结果。把顾客赶走可以让每个人都过得更好——无论是让可丽饼队伍更短，还是在别的地方。这样一来，可丽饼柜台本不会有一分钱的销售损失，因为不管他们的顾客等待多久，他们一天只能卖出一定数量的可丽饼。

这正是吉姆·格蒂斯在他的家庭电缆调制解调器中观察到的现象。因为他上传了一个文件，电脑就向调制解调器发送可以处理的尽可能多的上游数据包。而调制解调器假装可以处理的量比实际能处理的量要多得多，在建立一个庞大的等待队列时，它没有拒绝任何一个数据包。因此，当格蒂斯试图在访问网页或查看电子邮件的同时下载某样东西时，他的确认字符数据包就会被卡在上传后，不得不在调制解调器上排队等待离开。因为他的确认字符会永远返回到网络和电子邮件服务器上，服务器会将它们自己的下游连接速度限制为类似爬行的速度。

这就像每次你说“啊哈”的时候，它就会被延迟10~20秒。说话者就会慢下来，以为你不理解他们，对此你无能为力。

当一个网络缓冲区被填满时，通常会发生“尾部丢弃”：这是一种不礼貌的说法，即每一个在某一点之后到达的数据包都被简单地拒绝了，并且被有效地删除了。（一旦排队时间过长，新客户就会离开可丽饼柜台，这是人类环境下的一个“尾巴”的版本。）考虑到包交换的邮政隐喻，想象一个邮递公司每天早上会把所有运送卡车装不下的包裹都扔掉，这看起来有点儿奇怪。然而，正是这种“信息包的丢弃”让计算机注意到它的一个数据包没有被确认，这促使和式增加积式减少算法开始将带宽速度减半。数据包丢弃是互联网的主要反馈机制。巨大的缓冲区（不管你的厨房多么缺少人手你都接受所有订单，不管需要多长的等待时间，调制解调器都接收每一个到来的数据包）这可以防止这种调控的发生。

从根本上说，缓冲区使用延迟，在网络中称为“延时”（latency），以最大限度提高吞吐量。也就是说，它们会导致数据包（或客户）的等待，以利用之后事情进展较缓慢的时期。但是一个永久运行的缓冲区会让你的两个世界都遇到最糟糕的遭遇：所有的延迟，以及没有一个给予。如果平均来说，你的清除速度可以跟得上数据爆炸出现的速度，那么清除数据爆炸是件好事，但是，如果你的平均工作量超过了你的平均工作效率，那么没有任何缓冲区可以创造奇迹。缓冲区越大，在你发出求救信号前，你就会落得越远。缓冲区的基本原理之一就是，对于数据包或用户来说，它们只在障碍都常规地被清除时才能正确工作。

几十年来，计算机内存都非常昂贵，根本没有理由用不必要的内存容量来构建调制解调器。因此，对于调制解调器来说，没有任何方法可以组建一个比它所能处理的能力更大的等待队列。但在某种程度上，由于计算机行业的规模经济极大地降低了内存的成本，现代制造商开始给他们的机器提供千兆字节的内存，因为这实际上是他们所能得到的最小的内存。结果，在调制解调器、路由器、笔记本电脑、智能手机以及互联网的主干网中，无处不在的设备缓冲区都变成几千倍大，在像吉姆·格蒂斯这样的人发出警报来做一些事情之前，他们已经变得太大了。





迟到不如永远不到


阿齐兹·安萨里

把你最基本的问题当作一个人来处理。有人喜欢你，但你不喜欢他们。这一度是一种尴尬的局面。你必须要进行一次谈话，这很奇怪。现在你该怎么办？有人喜欢你，你不喜欢他们怎么办？你只是假装很忙……直到永远。

《蛇宗三字经》

永远不到比迟到好。尽管永远得不到经常比现在的状况好。

歌手凯蒂·佩里在推特上的粉丝比她的家乡加州的人多了107%。她作为推特上最受关注的人，自2016年年初起，她的粉丝数量有8120万。这意味着即使有99%的粉丝从来不给她发信息，或者即使那1%的人每年只给她发一次信息，她也会每天收到2225条信息。注意，是每一天。

想象一下，如果佩里会按照收到的时间先后顺序来回复粉丝的每一条信息。如果她每天能回复100条信息，那么粉丝可能的等待时间很快就会用几十年来计算。可以想象，大多数粉丝会更喜欢立即得到一个简短的回复，而不是在10年或20年后确定能收到的回复。

请注意，当佩里在离开会场时遇到等她签名，说想听她说些话的歌迷时，她并不会遇到这个问题。佩里做了她能做的，继续前进，失去的机会就消失了。身体是自己的流量控制。我们不能同时存在于两个地方。在一个拥挤的聚会上，我们不可避免地只能参与不到5%的谈话，也不能后期阅读或补上错过的内容。失去视网膜的光子不会排队等待日后重见光明。在现实生活中，数据包的损失几乎是失去所有。

我们用的“丢球”这个词，几乎完全是贬义的，意味着这个人懒惰、自满或者健忘。但是，战术性的丢球是在超负荷的情况下完成任务的关键部分。

对现代通信最普遍的批评是，我们“总是处于连接状态”。但问题并不是我们总是连接着的：我们并没有。问题是我们总是在缓冲中。这两者的区别是巨大的。

缓冲膨胀的感觉就像是需要在互联网上查看每一件东西，要阅读所有可能的书籍，或要看所有可能的节目。你错过了你最喜欢的连续剧的一集，然后看了一小时，一天，十年。你去度假，回到家看到一大堆信件。之前若有人敲你家的门，没人应答，他就走了。现在，当你回家时，他们已经在门外排队等待。

真是见鬼，电子邮件就是设计用来克服尾部丢弃的。正如其发明者雷·汤姆林森所说：

当时，没有什么好办法可以给人们留下信息。打电话应该可以，但必须有人来接电话。如果接电话的不是你想要的那个人，那就是行政助理或电话答录员之类的。这就是你要传递信息的机制，所以每一个人都在想，你可以在电脑上留言。

换句话说，我们要的是一个永远不会把发送者赶走的系统，无论好坏，我们都有一个这样的系统。事实上，在过去的15年里，从电路转换到包交换的转变已经在整个社会中发挥了作用。我们过去常常向别人请求专用电路，现在，我们给他们发送数据包，并期待收到确认字符。我们过去常常拒绝，现在我们会推迟。

令人遗憾的是，与常理不同，我们读到的“缺乏懒惰”是缓冲区的主要特征：将平均吞吐量提高到峰值吞吐量。他们所做的就是防止懒惰。你可以在路上查看电子邮件，从度假途中，到卫生间，再到半夜。你永远不会感到无聊。这是缓冲区的喜忧参半的好处，正如广告所言。

休假电子邮件自动回复器明确告诉发送者等待他们的是延时，更好的选择可能是告诉发送者需要尾部丢弃。它不会警告用户的排队时间可能超过平均水平，而只是拒绝接收所有传入的消息。而且，这并不需要局限于度假：你可以想象一个电子邮件程序，一旦收件箱达到100个条目，就会自动拒绝所有将接收到的信息。如果发来的是账单或其他类似的东西就是不明智的了，但对社交邀请却不失是一种较合理的做法。

现在，收件箱或语音信箱“已满”已经是过去的事了，这是20世纪晚期和21世纪初的一个明显的历史倒退。但是如果连接我们新奇的手机和电脑的网络拥有有效的无限存储空间，当事情发展太快或太激烈时还故意丢包，那么有理由认为尾部丢弃并不是有限内存空间的可悲后果，而是靠自身力量成为的一种有目的的策略。

对于网络缓冲膨胀，选择正在进行的这个复杂而愉快的故事涉及硬件和操作系统制造商付出的大量努力，以对网络队列进行根本性的改变。此外，还有一个针对传输控制协议的新反向通道的建议，这是多年来首次出现的此类修改：显式拥塞通知（简称ECN）。让互联网从缓冲膨胀中完全解脱出来将可能会带来所有这些变化，这也需要多年的耐心。“这是一个长期的困境。”格蒂斯说。

但是对于膨胀缓冲后的未来，还是有很多东西值得期待的。由于缓冲固有的延时，因此它对大多数交互过程都是有害的。例如，当我们通过网络电话进行通话时，我们通常更倾向于偶尔发出一些静态信号，以清晰地记录我们的来电者在3秒前说过的话。对于游戏玩家来说，即使是50毫秒的延迟也可能是杀别人和被杀的区别。事实上，游戏对延时非常敏感，所有重要的游戏比赛都是人与人之间线上进行的，玩家们坐飞机聚集到一个地方，之后每人通过网络进行比赛，他们进入一个单独的游戏房间。对于任何其他的同步问题，情况也是如此。“如果你想和你的朋友们一起演奏音乐，即使是在你的大城市地区，你也要关心几十毫秒的时间，”格蒂斯说，想象着一大堆新的应用程序和业务，这些都可能会利用那些潜在的低延时的势能，“我从这整个经历中总结出的一个结论是，工程师应该把时间当作重点项来对待。”

苹果公司的斯图尔特·切希尔表示，对于网络工程师来说，现在是时候要将延时看成是头等重要的大事了。让他感到震惊的是，那些宣称拥有“快速”互联网连接的公司只涉及高带宽，而不是低延时。通过类比，他注意到波音737和波音747都以每小时500英里的速度飞行，前者能容纳120名乘客，而后者则是前者的三倍。那么“你会说波音747比波音737‘快’三倍吗？当然不会，”切希尔说。容量有时确实很重要：对于传输大文件，带宽是关键。（如果你有大量的货物要搬的话，一艘集装箱船可能会超过一架747飞机的数千次的飞行。）然而，对于人际间的应用来说，一个快速的周转时间往往更重要，我们真正需要的是更多的协和式飞机。事实上，将延时降低是目前网络研究的前沿领域之一，看看它以后会给我们带来什么，这将会是一件很有趣的事。

与此同时，还有其他的战役要进行。格蒂斯把他的注意力移开了一秒，从框架中往外看。“这对你不起作用吗？我现在正在和别人说话，等我完成后再处理。我们这里结束了，呃，不，5千兆赫频道正在工作，2.4千兆赫频道已经崩溃。这是臭名昭著的错误代码。我将重新启动路由器。”这似乎是一个道别的恰当时机，并将我们的带宽释放到公共空间，让无数的流量增加。




