# 第一章 卓有成效的匹配

## 03. 如果每人只需要一个腎脏

罗斯、森梅兹和云韦尔在 2004 年的《经济学季刊》（The Quarterly Journal of Economics）上共同发表了题为《肾脏交換》（Kidney Exchange）的论文。当时「市场设计」这个词尚未为学术界所熟知，谁都没有想到，经济学的智慧可以运用到腎脏移植上

从理论上说，他们的肾脏移植匹配模型源于罗伊德・沙普利和赫伯特・斯卡夫（Herbert Scarf 所创的「住宅市场模型」。也许有人会想，肾脏移植为什么会和住宅扯上关系，这是因为肾脏和住宅在「每人只需一个」这一点上是一致的

沙普利生于 1923 年，是加利福尼亚大学洛杉矶分校名誉教授。我在前言中提过，2012 年他和罗

斯共同获得了诺贝尔经济学奖

斯卡夫生于 1930 年，是耶鲁大学名誉教授，开发了使用计算机找出市场均衡的算法，证明了以合作行为为特征的市场均衡极限定理

他们以住宅市场模型为对象的论文《核与不可分割性》（On Cores and Indivisibility）发表在

1974 年的《数理经济学》（Journa/ of Mathematica/ Economic）上。

所谓佳宅市场模型是这样的：现在有学生宿舍，入住了很多学生。每个学生有一个房间，各房间的位置、日照及房租等各项条件有所不同。

有的学生觉得「比起我现在的房间，还是那个房间更好」。比如有人会想：「现在的房间日照是好，但是反正白天也不在房间里，暗一点也可以，我想换到房租便宜的房间。」还有人觉得：「房租稍贵点也没关系，想换一个大点的房间。

于是，对现有房间不满意的学生为了交换房间聚在一起。但是并不强迫来了就必须换，也不保证

可以换到期望的房间

这里最基本的约定是保证每个人都不会换到比现在更不满意的房间这一最基本条件。该条件称为个体合理性（Individual Rationality)。

如果把这一情况与腎脏移植匹配相对照，学生就相当于患者，房间就相当于捐献者，现在所住的房间相当于不适合的捐献者，比现在的要好的房间相当于适合的捐献者。个体合理性条件意味着「不会和不适合的捐献者配对

接下来我们通过简单的例子来说明住宅市场模型。现在有四个学生 1、2、3、4, 各自在学生宿舍有自己的房间。为了使问题简化，每个学生现在所住的房间以该学生的名字命名。也就是说在学生 1 住房间 1, 学生 2 住房间 2, 学生 3 住房间 3, 学生 4 住房间 4。他们都对现在的房间不满意，并且按照自己的个人好恶，为 4 个房间（房间 1、2、3、4) 排了优先次序。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019856.png)

来看一下这个表格，对于学生 1 来说排序是这样的：最好的是房间 4, 其次是房间 3, 第三位是房间 2, 第四位是房间 1。这个排序称为偏好（Preference）。

在此例中，要满足「所有人都不会换到比现在更不满意的房间」这一个体合理性条件，十分容易因为原本学生 1、3、4 就住在自己最不喜欢的房间，所以也就不可能换到比现在更不满意的房

也就是说这里的个体合理性仅仅是要求学生 2 不会换到房间 1 去。满足这项条件的学生和房间的组合有很多，那么在这些组合中应该如何选择呢？

我们将后文对学生和房间的重新组合称为分配（mputation）。我们先考虑这样一组分配

分配 A：学生 1 住房间 3, 学生 2 住房间 4, 学生 3 住房间 1, 学生 4 住房间 2

配 A 满足了个体合理性，但是该分配仍然有改善的余地。因为如果学生 1 和学生 2 在此基础上交

换房间，他们都能换到最理想的房间

也就是说

配 B：学生 1 住房间 4, 学生 2 住房间 3, 学生 3 住房间 1, 学生 4 住房间 2

优于分配 A，这称为分配 B 对分配 A 进行了帕累托改进（Pareto Improvement）让我们在偏好表中，将分配 A 用口、分配 B 用圏起来确认ー下。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019857.png)

分配 A 被分配 B 帕累托改进。像这样，如果某个分配会被别的分配帕累托改进，就说明在不会使任何人处境变差的情况下，还有余地让某个人的情况变好，也就是说，资源没有处在最优分配的状况，尚未得到最好效率的利用。就拿分配 A 来说，它仍有通过交换来改善状况（既不给学生 3、4 带来不好的影响又可以让学生 1 和 2 更幸福）的余地

已经没有空间进行帕累托改进的分配，被称为达到帕累托最优（Pareto Effciency），分配 A 就没有达到帕累托最优

学生们都想换到更理想的房间，所以，寻找满足帕累托最优的分配十分合理。那么分配 B 同时满足了个体合理性和帕累托最优，我们就应该选择它吗？事情并非如此简单，因为还存在同时满足个体合理性和帕累托最优的其他分配

例如

分配 C：学生 1 住房间 4, 学生 2 住房间 3, 学生 3 住房间 2, 学生 4 住房间

很容易确定它同时满足个体合理性和帕累托最优

而且分配 B 和分配 C 之间相互不存在帕累托改进关系。因为对于学生 1 和 2 来说，分配 B 和 C 一样对于学生 3 来说分配 C 更好，而对于学生 4 来说分配 B 更好。@让我们在和上面同样的表格中将分配 B 用 O、分配 C 用△圏起来确认一下。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019858.png)

那么分配 B 和分配 C 应该选择哪一个呢？我们来考虑一个新的判断标准。

如果采用分配 B，学生 2 得到了房间 3, 学生 3 得到了房间 1。但是当大家決定「那就选分配 B 吧」的时候，学生 2 和 3 两人说「我们还是不参加了」，抢在大家前头只在他们两人之间交换房间，这样学生 2 就可以得到房间 3, 学生 3 得到房间 2

和分配 B 相比，这样做学生 2 仍然分得房间 3, 这一点没有变化，但是学生 3 可以得到（比房间 1)

更令其满意的房间 2。这次抢先交换，学生 2 无损无得，但是如果他和学生 3 关系好，或者偷偷从

他那里收了钱的话，这样的私下协议就可能会发生。像这样由小集团发起的私下协议，称为阻止 Block)

也许可以事先规定禁止「阻止」。但是如果这样的话，学生 2 和 3 可能从一开始就不会参加房间交换。参与者减少，交换的选择面就会变窄，效果就不理想

不会发生阻止的分配称为强核配置（Strong Core Allocation），它具备两个优点。

首先从定义上来说，一旦确定「用这个分配（强核配置）」，就不可能发生私下协议

不可能发生私下协议，也就意味着这个分配会给予全体成员通过任何协议都无法实现的高度满足，这也意味着学生参与交换不会失去什

也就是说强核配置可以有效地防止「阻止」，而且具有公平性。

在这个例子中，分配 C 是强核配置，不存在其他强核配置。

再进一步说，强核配置必然满足个体合理性和帕累托最优。因为个体合理性要求「不会有某个人

因退出分配而受益」，帕累托最优要求「所有参与者作为一个整体不会因私下协议而受益」。核配置要求「无论某个人还是所有人，都不存在通过退出分配或私下协议而受益的可能」，所以强核配置必然满足个体合理性，而且满足帕累托最优

下面强调两个关于强核配置的重要事实：

●事实 1 强核配置一定存在。也就是说，无论有多少学生，他们的偏好如何，以实现强核配置为目标都是有意义的

事实 2 强核配置一定唯一。这个结果让人意外，因为人们通常会觉得如果学生很多的话分配整体的数量也会变大，所以分配的数量应该也会增加。但是住宅市场模型中，强核配置在任何时候都是唯一的。也就是说要实现强核配置，不需要犹豫选择一个强核配置。

事实 1 由沙普利和斯卡夫在 1974 年发表的论文中证明，事实 2 由罗斯和安德鲁・波斯尔思韦特

 (Andrew Postlethwaite)1977 年刊登在《数理经済学》上的论文中揭示。

罗斯当时是刚刚取得博士学位的年轻研究人员。他在理论实践层面的研究获得了较多褒奖，其实他在基础理论研究方面也做出了很多重要贡献

通过上述两个事实我们可以知道，在住宅市场模型中强核配置永远是唯一的。但不能轻易说那就

选强核配置吧，因为存在一个很大的问题：要选择强核配置必须先找到它。

「某个事物存在」和「有找到它的方法」是两回事。知道有徳川宝藏@在，但是不知道在哪里，还是不能解决问题

在住宅市场模型中，分配表示学生和房间的组合。

假设现在有 n 个学生（和 n 个房间），分配的方式就有 n 的阶乘！=nx (n-1) x. ×2×1 种

这个数字会随着人数的增加而迅速增大。当只有 3 个学生时分配方式不过 6 种而已；但如果有 10 个学生的话，分配方式就会超过 360 万种。要逐一确认超过 360 万种的分配方式是否是强核配置，工作量很大。

有 10 个学生时，结盟成小集团的方式会超过 1000 个。所以哪怕仅仅针对一种分配方式，要确认其是否是强核配置也是非常困难的，花费时间做这样一一检视很不现实。

解决这个问题的方法是由戴维・盖尔发明的最适交易循环算法（Toptrading Cycles Algorithm 以下称为 TTC 算法）。

## 04. 什么样的算法能解決问题？

戴维・盖尔是一名数学家，生于 1922 年，长期任加利福尼亚大学伯克利分校教授，2008 年去

世，终年 86 岁。虽然盖尔是一个数学家，但是他的研究也涉及很多博弈论、经济学等社会科学

方面的内容。1980 年，他获得了运筹学方面的最高奖项一一冯・诺依曼奖。

盖尔发明的 TTC 算法 1974 年首次在沙普利和斯卡夫的论文中以「该内容由盖尔首创」的形式公开

因为不是登载在盖尔自己的论文中，所以在写与 TTC 算法有关的书或者论文时，总要先说明「由

盖尔编写的 TTC 算法」，然后引用沙普利和斯卡夫的论文（本书也是如此）

可能当时盖尔自己也没太意识到该算法的里程碑意义吧

TTC 算法是在极短的时间内找到强核配置的算法。我们通过下面这个 7 个学生交换房间的例子来

该算法是否有这样的威力。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019859.png)

大家能一眼望去就找到强核我在上课时经常提这个问题。要找到很难，一般来说找不到。之前最常听到的学生答案是「学生 1 住房间 6, 学生 2 住房间 3, 学生 3 佳房间 5, 学生 4 住房间 2, 学生 5 住房间 4, 学生 6 住房间 7, 学生 7 住房间 1」（下表中用口标出）。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019860.png)

这个分配中所有人都可以佳在对自己来说满意度排在前两位的房间，看起来确实不错。我每到这个答案时也都很佩服能找到这个分配的学生，觉得他很聪明。

但实际上这是一个圏套：该分配并非强核配置。因为如果像下表中画⊙的那样，学生 1、4、5 抢

在全体前面仅在他们 3 个人之间进行交換：学生 1 住房间 5, 学生 4 佳房间 1, 学生 5 住房间 4 这

样做对他们来说更有利（学生 5 没有变化）

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019861.png)

那怎样才是强核配置呢？

案是：「学生 1 住房间 5, 学生 2 住房间 3, 学生 3 住房间 2, 学生 4 住房间 1, 学生 5 住房间 4,

生 6 住房间 6, 学生 7 住房间（7 下表中的）」。强核配置是唯一的，再无其他。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019862.png)

现在有 7 个学生，分配方式总共有 7 的阶乘 5040 种。但在强核配置之外还有 5039 个组合，无论哪一个都必然会发生某个小集团结盟。考虑到这一点，它的唯一性仍然成立就让人很吃惊

刚才提到的那个经常被错认为是强核配置的解，看起来确实不错，就连我也这么觉得。一直盯着

偏好表看，的确会感觉这个分配很好。但问题是「哪一个是强核配置」？所以它并非正确答案。光用眼睛看很难得到正确答案，需要严谨的解法

面对这类问题，TC 算法就是解法。采用 TC 算法来寻找，比町着看还要多花费一些时间。但是这个算法结构简单，普通人也能理解

顺便说一句，我在美国留学时曾经用拙劣的英语向 50 来岁的主妇们解释这种算法，她们也能理

解。当时我的英语很差，甚至「but「的音都发不好（后来稍有进步）。那为什么还可以表述清楚

就是因为该算法的构成就像人的动作一样，很容易用感觉来理解

那么 TC 算法是如何寻找强核配置的？我们以上页的偏好表为例逐步讲解：

O 第一轮

每个学生用手指出对自己来说排在首位的房间，这里用箭头表示「用手指」，就是

15

456

例如 1-5, 就是学生指了房间 5。，把简头连起来就会发现一个闭合循环

所谓循环，顾名思义就是开头和结尾相同的一串箭头的连接。箭头指向想要的东西，按照这个循

环分配给学生 1 房间 5, 学生 5 房间 4, 学生 4 房间 1。这样学生 1、4、5 的房间确定，他们离开。

O 第二轮

现在剩下的学生是 2 他们也指出了剩下房间中自己最满意的房间：

32 6→7 7→7

用箭头连接起来就得到循环 2→32

7→7 很短，但也是一个完整的循环。和第一轮一样，分给学生 2 房间 3, 学生 3 房间 2, 学生 7 房间

这样学生 2、3、7 的房间确定，他们离开。

O 第三轮

在只剩下学生 6, 他也要指出剩下房间中自己最满但是现在只剩下房间 6, 所以他

能指 6, 也就是 6→6

学生 6 被分配了房间 6, 他也离开了，算法到此结束。将上述结果归纳如下，这就是强核配置。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019863.png)

这个例子经过三轮算法结束。在 TTC 算法中，无论偏好如何，每一轮必定会形成一个循环，所以

每次最少会有一个人离开。

也就是说，如果有 n 个学生，无论花费多少时间，最多经过呛，所有人就一定会离开，TC 算法

结束

前面说过，有 n 个学生参与时分配的方法共有的阶乘 n！种，随着 n 増大，分配方法也会迅速増

加。而在实际运用 TTC 算法时所需要的最多步骤，往往和学生数相等，也是 n

也就是说即使参与者的范围不断扩大，但计算所需的时间増加有限，可以说这个算法的运算速度很快。

我们再来看一个例子熱悉一下 TTC 算法，这个例子在下节的讨论中还会用到。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019864.png)

O 第一轮

每个学生指出对自己来说排在首位的房间

用箭头连接起来就找到循环 13つ2→1。于是学生 1 得到房间 3, 学生 3 得到房间 2, 学生 2 得到房

他们离开

O 第二轮

现在剩下的是学生 4、5、6, 这些学生在剩下的房间中指出自己最满意的房间：

用箭头连接起来会得到循环 4→6→4, 于是学生 4 得到房间 6, 学生 6 得到房间 4, 他们离开

O 第三轮

此时剩下的只有学生 5 了，他指了房间 5, 循环就是 5→5, 学生 5 得到了房间 5 离开。所有人都离开了，算法结東。将以上结果归纳如下，就是唯一的强核配置。

![](https://raw.githubusercontent.com/dalong0514/selfstudy/master/图片链接/复制书籍/2019865.png)

