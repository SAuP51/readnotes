# 
> 2018000模板



09 随机性 何时应用随机？


迈克尔·拉宾

我必须承认，在这一领域工作多年之后，许多算法问题的随机性对我来说是非常神秘的。它是有效的，是起作用的。但它为什么是绝对神秘的又是如何保持的？

随机性似乎与理性相反，它是放弃问题的形式，也是最后一招。实际却远非如此。在计算机科学中，随机性的作用是惊人的且日益重要，这一点告诉我们，利用机遇可以成为解决最困难问题的一个有效的方法。事实上，有时没有任何其他方法是有用的。

与标准“确定性”算法不同，我们通常想象的电脑使用，每次都以完全相同的方式一个步骤紧随另一个之后，而随机算法是使用随机生成的数字来解决问题。最近，在计算机科学上的研究表明，在某些情况下，随机算法能够比所有已知的确定性算法更快地生成较难问题的答案。虽然它们并不能保证每一次都有最优解决方案，但随机算法可以用很少的时间就得到接近最优化的惊人答案，这都仅仅通过战略性地扔几个硬币就能确定。

这里有一个深刻的信息是，在某些问题上，随机的方法甚至比最好的确定性的方法都要优秀。有时候，解决问题的最好办法是依靠运气，而不是试图完全地分析出答案。

但仅知道随机性有用还不够，你需要知道什么时候该依靠运气，以什么方式，以及在什么程度上。最近的计算机科学提供了一些答案，尽管故事在几个世纪前就开始了。





抽样


1777年，乔治-路易斯·雷克勒，布冯伯爵，发表一个有趣的概率分析结果。如果我们把一根针扔到一张画了线的纸上，这根针有多大可能性会和纸上的一条线相交呢？布冯的研究表明，如果针短于两条线之间的距离，答案是2/π乘以针的长度除以两线之间的距离。对于布冯来说，推导出这个公式就已经足够了。但在1812年，皮埃尔-西蒙·拉普拉斯（也就是我们在第6章提到的英雄）指出，这个结果还有另一层含义：一个人可以仅通过针掉在纸上来估计π的值。

拉普拉斯的提议指出了一个深刻的普遍真理：当我们想要了解一个复杂的量时，我们可以通过抽样来估计它的值。这正是他利用贝叶斯法则帮助我们完成工作的一种计算。事实上，有些人追随拉普拉斯的建议，进行了他所建议的实验，实验证实这是可能的（尽管不是特别有效）——用这个实践的方法去估计π的值。[1]

将针扔到画了线的纸上几千次是一种有趣的消遣（对一些人来说），但这需要计算机的发展，使取样成为一种实用的方法。之前，当数学家和物理学家们试着用随机性来解决问题时，他们必须辛苦地用手来计算，这就很难产生足够的样本以带来精确的结果。尤其是在第二次世界大战期间，洛斯阿拉莫斯美国国家实验室开发的计算机为计算带来了飞跃。

斯塔尼斯拉夫·乌拉姆是一位数学家，他曾助力于开发原子弹。他在波兰长大，1939年移居美国，并于1943年加入曼哈顿计划。在短暂回归学术界后，他于1946年回到了洛斯阿拉莫斯，从事热核武器设计。但他患了脑炎并做了脑部急救手术。当他从疾病中恢复过来时，他担心自己是否能恢复数学能力。

康复期间，乌拉姆玩了很多纸牌，尤其是单人纸牌（也称为克朗代克）。正如任何一个纸牌游戏玩家所知道的那样，某一些洗牌方式就是会让游戏无法获胜。乌拉姆也是这样玩的，他问自己一个自然的问题：洗出能获得胜利的好牌的概率是多少呢？

在像单人纸牌游戏这样的游戏中，你可以通过各种可能性的空间来推理，这几乎让你无法抗拒。翻第一张牌，还有52种可能的游戏来跟踪。翻第二张，对于第一张有51种可能性。这意味着在我们开始玩之前，已经有了成千上万种可能性。斯科特·菲茨杰拉德曾写道：“一流的智力，就是大脑中能够同时存在两种对立的想法，它们还能同时正常运转。”这或许是真的，但真正一流的智商、人类群者其他任何东西，并不能同时存在80×1067种可能的洗牌方式，且还依然有希望继续正常运转。

在尝试了一些复杂的组合计算并放弃之后，乌拉姆开始了一种不同的方法，它的优势就是其具有的简单性：去玩游戏就好了。

我注意到，可能更实用的（尝试）是放下牌，跟着过程发展进行实验，只是注意成功出现的比例，而不是试图计算出所有组合的可能性，这种可能性都是以指数倍递增的，最后的数量大得惊人，除了最基本的情况，没有其他办法估计。这在智力上即使不是完全的羞辱，结果也是惊人的，理性或传统思维的局限会给人一种没那么可怕的感觉。在一个非常复杂的问题中，实际的抽样要好于对所有的可能链都进行检验。

当他说“更好”时，请注意，他并不一定是指抽样分析比详尽的分析能为你提供更精确的答案：抽样过程中总会有一些错误存在，虽然可以通过确保样品真正的随机性以及提高样品的数量来减少这种错误出现的可能。他说“抽样会更好”的意思是，因为它最终会给你一个答案，而其他方法都无法做到。

乌拉姆的想法（抽样可以在其他分析方法失败时取得成功）在解决洛斯阿拉莫斯出现的一些困难的核物理问题时也至关重要。核反应是一种分支过程，可能也会像纸牌那样疯狂地增加：一个粒子分裂为两个，每一个都可能会撞击其他的，再导致它们分裂，一直这样发展下去。准确地计算出这一过程中某些特定结果的可能性，在许多粒子的相互作用下，都已经难到几乎不可能的程度。但如果进行模拟，每一次的交互作用就像打开一张新的纸牌，提供了一种选择。

乌拉姆与约翰·冯·诺伊曼进一步发展了这个想法，并与另一位来自曼哈顿计划的物理学家尼古拉斯·梅特罗波利斯合作，在洛斯阿拉莫斯的计算机上实现了这个方法。梅特罗波利斯将这一方法（将详尽的概率计算用抽样模拟进行代替）命名为蒙特卡罗法，这种方法因摩纳哥的蒙特卡罗赌场而得名，因为该场所同样依赖于变幻莫测的机会与运气。洛斯阿拉莫斯的团队便能够用它来解决核物理中的关键问题。今天，蒙特卡罗方法已经成为科学计算的基石之一。

许多如计算亚原子粒子的相互作用或在纸牌上的获胜机会这样的问题，是它们内在具有的概率，所以通过像蒙特卡罗法这样随机的方法来解决这些问题很有道理。但关于随机性的作用也许最让人惊讶的是，它可以被用在机会看似发挥不了作用的情况下。即使你想要回答一个只有“是”或“否”，“真”或“假”的答案的问题（其中没有任何其他可能性）掷几个骰子仍然是解决方案的一部分。

[1]有趣的是，偶然间，其中的一些实验对π值的估计似乎产生了比预期更好的效果，这表明他们可能是故意缩短了最佳停止点，或者干脆伪造。例如，1901年，意大利数学家马里奥·拉扎里尼据说做了3408次实验，并最终估计π≈355/113=3.1415929（π到小数点后7位的实际值是3.1415927）。但如果针与纸上的线相交的机会只有一次，那估计会没那么精准（3.1398或3.1433），这让拉扎里尼的报告显得可疑。拉普拉斯可能已经发现，我们可以使用贝叶斯法则来确认，这个结果不太可能来自一个有效的实验。





随机算法


第一个在计算机科学中展示随机算法广泛应用的人是迈克尔·拉宾，这一展示令人惊讶。他1931年出生于德国的布雷斯劳（“二战”后，该地变为波兰的弗罗茨瓦夫），拉宾的祖辈有很多都是犹太拉比。他的家人于1935年离开德国巴勒斯坦，他从那时起，开始从他父亲为他铺下的犹太教之路转到美丽的数学之路——他在希伯来大学本科生涯的早期就研究了阿兰·图灵的理论，后又移民到美国普林斯顿大学攻读博士学位。拉宾赢得相当于计算机科学界的诺贝尔奖的图灵计算机科学奖，因为其扩展了理论计算机科学，以适应在“不确定性”的情况下，一台机器不被要求去做出单一选择，而是可能有多个路径可以走。在1975年的休假中，拉宾来到麻省理工学院，寻找一个新的研究方向。

他发现其中存在一个最古老的问题：如何识别质数（素数）。利用算法寻找质数至少可以追溯到古希腊时期，当时的数学家使用一个简单的方法称为厄拉多塞筛算法。该算法的工作原理如下：要找到所有小于n的质数，首先要写下所有从1到n的序列中的数字。然后去掉所有是2的倍数的数字，除了2本身（就是去掉4、6、8、10、12等）。取下一个还没有划掉的最小的数（在本例中，就是3）并划掉所有这一数字的倍数（6、9、12、15）。继续这样下去，最后剩下的数就是质数。

几千年来，对质数的研究，如G.H.哈代所说，一直被认为是数学中“最明显无用的分支之一”。但在20世纪，它开始变得有用，它成为密码学和网络安全的关键。事实上，把质数相乘比把它们因数析出要容易得多。足够大的质数（例如一个千位数）的乘法可以在几分之一秒内完成，但析出因数就可能需要几百万年，这就产生了所谓的“单向函数”。在现代加密术中，例如，当只有发送方和接收方知道秘密质数相乘能得到巨大的合数时，便可以将这个数公开传播而不用担心了，因为对该产品的密码析出因数将耗费任何企图窃取者太长时间而不值得尝试。因此，几乎所有的安全通信网络，无论是商业、银行还是电子邮件，都是从寻找质数开始的。

对密码的这种应用突然使查找和检查质数的算法具有非常重要的作用。虽然厄拉多塞筛算法是可行的，但它的效率并不高。如果你想要检查一个特定的数是否是质数（或称测试其“素性”），筛算法需要试图除以所有质数直到其平方根。检查一个6位的数字是否为质数，需要将它除以168个所有少于1000的质数，这好像还不是太糟糕。但检查一个12位的数字是否为质数，就要将它除以78498个小于100万的质数，那么这就明显开始失控了。现代密码学中使用的质数有几百位长（还是忘了它吧）。

在麻省理工学院，拉宾遇到了加里·米勒，他是加州大学伯克利分校计算机科学系的毕业生。在米勒的博士论文中，他开发出了一种有趣的、有发展潜力的，也更快的算法，用于测试优先级，但有一个小问题：它并非永远有效。

米勒发现一组方程（用n和x两个数表示），如果n是质数，无论x代入什么值，它总能成立。如果该方程式不成立，即使只有一个x的值，n也不可能是质数。在这些情况下，x被称为对抗素性的“证人”。然而，问题是误报：即使n不是质数，这个方程仍然会在某些时候成立。这让米勒的想法无法确定。

拉宾意识到，这是一个超出通常确定的计算机科学世界中被认为有价值的领域。如果n实际上是非质数，那么多少个x的可能值会给出误报并认为它是一个质数？拉宾指出，答案不超过1/4。所以对于一个随机的x值，如果米勒的方程成立，只有1/4的概率n不是质数。关键是，每次我们采样一个新的随机x，并用米勒的方程检验这个n是质数的方法，但结果不是，就要再以4的倍数往下降。重复这个步骤10次，假阳性的概率是4-10——小于0.001‰。仍然没有足够的确定性？再检查5次，就会下降到0.000001‰。

沃恩·普拉特是另一位麻省理工学院的计算机科学家，他研究了拉宾的算法，并在冬天的一个深夜算出结果，而拉宾正在家里举办一个光明节聚会。拉宾记得是在午夜前后接到的电话：

“迈克尔，我是沃恩。我得出了这些实验的结果。快去拿铅笔和纸，把结果写下来。”他说，2400-593是质数。所有的素数的结果p中小于300的用k表示。K×338+821和k+823×338的两个结果是孪生素数。[1]这些构成了那时已知的最大孪生素数。我听后觉得头发都竖了起来。真是难以置信。真是难以置信。

米勒-拉宾素数测试，就现在所知的，给我们提供了一种用任意程度的确定性快速识别即使特别大的质数的方法。

这里，我们可能会问一个哲学问题——“是”的意思是什么。我们已经非常习惯于数学应该是一种确定的领域，如果我们听到一些数字“可能是质数”或“几乎肯定是质数”一定觉得非常奇怪。“肯定到底是有多肯定呢？”在实践中，加密互联网连接和数字交易的现代加密系统，被设置的误报率在1×1024以内。换句话说，这是一个有24个零的小数，比地球上一粒沙粒还小。这个标准是在将米勒-拉宾测试应用仅40次之后产生的。的确，你从来不会完全确定，但是你可以非常接近确定，或是非常快确定。

尽管你可能从来没有听说过米勒-拉宾测试，但你的笔记本电脑、平板电脑和手机都对其很熟悉。在其被发现后的几十年，它仍然在许多领域中被用作查找和检查素数的标准方法。当你在网上使用信用卡时，它也在幕后工作着，几乎任何时候安全通信都是在空中或通过电线发送的。

在米勒和拉宾的成果问世之后的几十年里，我们不知道是否会有一种有效的算法，允许以确定性的方式，用绝对的确定性对素性进行测试。2002年，印度理工学院的三位科学家的确发现了这样一个方法，但像米勒—拉宾这样的随机算法要快得多，因此今天仍在实践中使用。

对于其他一些问题，随机抽样仍然是唯一已知的有效解决途径。数学中有一个奇特的例子，就是所谓的“多项式身份测试”。“如果你有两个多项式表达式，如2x3+13x2+22x+8，以及（2x+1）×（x+2）×（x+4），找出这些表达式实际上是否为相同的函数（通过算出所有乘法，然后比较结果），这会非常耗时，尤其是随着变量数量的增加。

在这里，随机性提供了一种可以推进向前的方法：生成一些随机的x并将其代入。如果这两个表达式是不同的，那么如果它们对随机生成的输入给出相同的答案，这将是一个很大的巧合。如果它们对第二个随机输入又给出相同的答案，这将是更大的巧合。如果连续三次随机输入都相同又是更大的巧合。因为没有已知的确定性算法可有效地测试多项式身份，这种随机的方法（重复观测快速接近确定性）是我们可以使用的唯一实际的方法。

[1]孪生素数是连续奇数，并且都是质数，比如5和7。





抽样的优势


多项式身份测试表明，有时我们的工作是更好地检查随机的价值（从我们想知道的两个表达式中取样），而不是试图理清它们的内部工作。在某种程度上，这似乎相当直观。现在有两种难以区别的设备，要确定它们是两种不同的设备还是两种相同的设备，我们大多数人都会随意地按下按钮，而不是打开箱子来检查线路。而且我们也不会特别惊讶，例如，一个电视中的毒枭只要用刀随机划开货物中的几捆，便可以对整批货物的质量有一定的把握。

不过，也有一些案例中我们没有使用随机性，也许我们应该用。

可以说，20世纪最重要的政治哲学家是哈佛大学的约翰·罗尔斯，他为自己设定了一项雄心勃勃的任务：试图协调两个看似对立的关键理念：自由与平等。当一个社会更自由，或者更平等时，它会更“公正”吗？这两者真的必须互相排斥吗？罗尔斯提出了一种他称之为“无知之幕”的问题。他说，想象一下，你即将出生，却不知道自己出生后是怎样的：男人还是女人，富人还是穷人，城市还是农村，有病还是健康。在了解你的地位之前，你必须选择你所生活的社会。你想要什么？罗尔斯认为，拉开无知之幕，对各种社会安排进行评估，我们会更容易对理想中的安排达成共识。

然而，罗尔斯的思想实验没有考虑到的是，在这样的幕布后面理解一个社会的计算成本。在这种假设下，我们怎么可能希望掌握所有相关信息？暂且不提正义和公正的重大问题，并尝试运用罗尔斯的方法仅仅对例如健康保险条例等提出改变。也许，在美国，出生后成为中西部的一名镇书记的概率，乘以不同的卫生保健计划的分布，这可用在中西部直辖市上，再乘以保险精算数据提供的可能性，例如胫骨骨折的概率，再乘以在中西部医院可能的保险计划所给定的，胫骨骨折的一般处理的平均医疗费用。那么，拟议的保险修订对国家来说是“好”还是“坏”？我们几乎不能指望用这种方式评估一个受伤的心，更不用说数亿人的生命了。

罗尔斯的哲学批评家们详细地讨论了我们应该如何从无知的面纱中获得信息的问题。例如，我们是否应该尝试尽量扩大平均幸福、中位数幸福、总幸福或别的什么，其中的每一种方法都很著名，但其却将自己置身于有害的反乌托邦之中，如作家厄休拉·勒吉恩所设想的奥米勒斯城的文明——开放。在这个国家里，繁荣与和谐无处不在，一个孩子却被迫生活在悲惨的境地。这些都是应得的批判，而罗尔斯故意回避了这些问题，因为我们不知道如何处理从幕布后面得到的信息。然而，也许更大的问题首先是如何收集这些信息。

答案很可能来自计算机科学。麻省理工学院的斯科特·阿伦森说，他感到很惊讶，计算机科学家还没有对哲学产生更大的影响。他怀疑，部分原因在于他们“无法将他们所能补充的东西与哲学的概念集合联系起来”。他阐述道：

人们可能会认为，一旦我们知道某些东西是可计算的，无论计算起来需要10秒还是20秒，这显然是工程师应该关心的，而不是哲学家。但是如果问题是10秒：101010秒，那么这个结论就不太明显了！事实上，在复杂性理论中，我们所关心的数量差距通常是极为巨大的，以至人们也必须考虑到它们的质量差距。例如，这就是看一本400页的书和阅读所有400页的书之间的区别，或者是写下一个千位数字和从1数到那个数的区别。

计算机科学为我们提供了一种方法来明确评估所有可能的社会规定，例如胫骨受伤。但幸运的是，它还提供了处理这种复杂性的工具。基于抽样的蒙特卡罗算法是该工具箱中最有用的方法之一。

比如说，当我们需要理解国家医疗改革时，由于它是一个庞大的机构，太复杂而很难轻易理解，我们的政治领导人通常会给我们提供两件事：精心挑选的个人轶事和汇总的统计数据。当然，这些轶事丰富而生动，却不具有代表性。几乎任何一项法律，无论多么开明或具有误导性，都会让一个人过得更好，而另一个人过得更糟，因此精心挑选的故事不会提供更广泛模式的任何观点。另一方面，总的统计数据则恰恰相反：它全面却薄弱。例如，我们可能会了解到，在全美国，平均保费是否下降，但并不是要了解这种变化在一个更细微的层面上是如何产生的：对于大多数人可能会下降，但是奥米勒斯城风格使一些特殊群体（本科生、阿拉斯加人，或孕妇）陷入困境。一个统计数据只能告诉我们部分的故事，它掩盖了任何潜在的异质性。我们甚至不知道我们需要哪些统计数据。

由于统计数据和政客们最喜欢的故事都不能真正引导我们通过成千上万页的立法提案，因此，一位蒙特卡罗计算机科学家提出了一种不同的方法：抽样。对随机样本进行仔细的检查，可能是一种用以理解太复杂而不能直接理解的东西最有效的方法。当涉及处理质量不可控的问题时，它们棘手而复杂，不能被完全理解，比如单人纸牌或原子裂变、素性测试或公共政策，抽样提供了一种最简单，也是最好的方法来解决问题。

我们可以看到这种方式与直接给钱的慈善捐助项目类似，它将现金无条件的转移分配给生活在肯尼亚和乌干达的极度贫困的人。它吸引了人们的注意力，在许多层面上重新思考传统的慈善行为：不仅是其不寻常的使命，而且是在其过程中体现出的透明度和问责制。最新的现状显示很成功。

项目助理丽贝卡·兰格写道：“如果你经常查看我们的网站、博客或脸书主页，你可能已经注意到一些你并不常见的内容：我们收件人的故事和照片。”问题不在于其他慈善机构提供的那些热情洋溢的故事并不真实。准确地说，他们刻意选择展示成功的事例，使得人们不清楚能够获得多少信息。所以，直接给钱的慈善项目决定要对这个传统进行改变。

每周三，该慈善团队随机挑选一组现金接受者，派出一名工作人员现场采访他们，并逐字逐句地发布工作人员的现场采访记录，无论发生什么都按照此步骤执行。例如，这是他们第一次经历这样的采访，这个女人叫玛丽，她用这笔钱来买铁皮屋顶：[1]

她能做一间更好的房子，那是一个铁皮房子。她还可以为自己的房子买套沙发。她的生活已经发生了变化，因为以前每当下雨的时候，那个漏水的屋顶就会把房子里的东西都泡在水里。但由于有了资金支持，她才有能力把房子做得更好。

兰格写道：“我们希望这能让你对所分享的所有类型的信息都有信心，甚至能激发你把其他组织也带到更高的标准。”

[1]注意，我们故意选取了网站上的第一个故事，也就是说，我们没有通读过所有的故事并特意选出一个来分享，因为这将会破坏我们的初衷。





三部分的权衡


约翰·济慈

这让我非常惊讶，品质决定一个人的成就，尤其是在文学领域，这是莎士比亚所大量拥有的。负面能力也如此，也就是，当一个人陷入不确定、神秘、怀疑时，在事实和理性之外没有任何急躁的行为。

约翰·斯图亚特·密尔

没有绝对的确定性，但对于人类生活的目的来说，却有足够的保证。

计算机科学通常是一个权衡利弊的问题。例如，在我们讨论第3章的计序时，我们注意到在计序前花费的时间和在搜索时花费的时间之间的权衡。在第4章讨论缓存时，我们探讨了占用额外空间的权衡（缓存的缓存进行缓存）来节省时间。

时间和空间是计算机科学中最常见的权衡的根源，但是最近，关于随机算法的研究表明，还有另一种需要考虑的变量：确定性。正如哈佛大学的迈克尔·米特增马赫所说：“我们要做的是想出一个答案来节省你的时间和空间，并权衡第三个维度：错误概率。”他被要求用最喜欢的例子来权衡不确定性，他并没有犹豫。“一位同事刚才说，应该做一个饮酒游戏，每当幻灯片上出现一次这个词，你就该喝一杯，你听说过布隆过滤器吗？”

米特增马赫说，要理解布隆过滤器，想想像谷歌这样的搜索引擎，它要覆盖整个网络并索引每一个可能的全球资源定位器（URL）。网页包含了超过一万亿个不同的全球资源定位器，平均每个定位器的长度大约为77个字符。当搜索引擎查看某个全球资源定位器时，它如何检查页面是否已经被处理了？仅仅存储访问过的所有定位器列表将会花费巨大的空间，并且反复搜索这个列表（即使已经完全排好序）都可能会成为一场噩梦。事实上，治疗后很有可能比疾病本身更糟糕：换句话说，每次检查都确保我们不会重新索引页面，这可能比直接索引两次页面更耗时。

但是，如果我们只需要确保这个全球资源定位器对我们来说是新的，那会怎么样呢？这就是布隆过滤器的用武之地。以其发明者伯顿·H.布隆命名，布隆过滤器的工作原理与拉宾-米勒-素性测试非常相似：这个全球资源定位器被输入一系列的方程式，这些方程式会对“实现向量”（witness）的新奇性进行检查。（这些方程不会说“n不是质数，”而是说“我没有见过n”。）如果你可容忍的错误率仅为1%或2%，那么就将结果存储在概率数据结构中，例如像布隆过滤器，它将会为你节省大量的时间和空间。这种过滤器的用处并不仅限于搜索引擎：布隆过滤器已经附带了许多最近的网络浏览器，用来检查一些已知的恶意网站的网址，而且它们也是比特币等加密货币的重要组成部分。

米特增马赫说：“那些错误权衡空间的想法，我认为问题在于人们不会把它与计算联系在一起。他们认为计算机应该给你答案。所以当你在算法课上听到这个的时候，‘它应该给你一个答案，这可能不是正确答案’（我乐意认为当学生听到这个的时候，就会把注意力集中在此）。我认为，人们在自己的生活中没有意识到他们做了多少事情，并接受了这一点。”





山、谷和陷阱


理查德·肯尼

这条河蜿蜒曲折，因为它无法思考。

随机性也已被证明是解决离散优化问题的一种强大武器，比如为美国全国大学篮球联赛安排比赛日程，或者为一个旅行推销员设计最短路线。在前一章中，我们看到了松弛可以在很大程度上减少这些问题，但是随机性的策略性运用已经成为一种可论证的，甚至是更重要的技术。

想象一下，你正在为一次游览世界10个城市的度假做准备，你自己遇到了旅行推销员问题：你将从旧金山出发并最终回到旧金山，中途要经过西雅图、洛杉矶、纽约、布宜诺斯艾利斯、伦敦、阿姆斯特丹、哥本哈根、伊斯坦布尔、德里和京都。你可能不太担心这条路线的总长度，但你可能确实想把旅行的资金花费降到最低。首先要注意的是，尽管10个城市听起来好像不是很多，但在这里，可选择的旅游线路的数量是10的阶乘：超过350万。换句话说，并没有实际的方法可以简单地检查每一种排列方法，并最终选择价格最低的一种。但你必须做得更聪明才行。

这是你第一次尝试设计一个行程，你可能会想着买从旧金山出发的（假设是西雅图）最便宜的航班，然后再买从那里到其他城市（假设为洛杉矶）最便宜的机票，然后再买（到纽约）最便宜的机票，以此类推，直到你到达第十个城市，再从那里飞回旧金山。这是一个所谓的“贪婪算法”的例子，你也可以把它看作是一种“近视算法”：一种目光短浅的算法预期在每一步中获得最好的东西。在调度理论中，正如我们在第5章看到的，一个贪婪的算法（例如，总是做最简单的工作，而不考虑长远）有时这可能是一个问题所需要的。在这种情况下，对于旅行推销员问题，贪婪算法给出的解决方案可能并不可怕，但它可能与你能做的最好的选择差很远。

一旦你完成了基本路线设计，你可能会对一些备选方案进行测试，方法是对城市的顺序进行轻微的调整，然后看看是否能有改进。例如，如果我们先去西雅图，然后去洛杉矶，我们可以试着用相反的顺序到这些城市：先去洛杉矶，再去西雅图。在任何给定的行程中，这11段路程的顺序都是可以前后调换的。那么我们都试一试，然后用最省钱的那一种。从这里开始，我们有了一个新的行程计划，我们可以开始改变这个计划，再次寻找最好的地方改进。这是一种被称为“爬山”的算法，因为通过搜索解决方案，发现有些方案更好，有些更糟，这通常被认为像是山和谷的风景，而你的目标是到达最高的山峰。

最终，你会得到一个比所有排列顺序都更好的解答。不管哪两个相邻的点互换，都不会再有任何一个排序能更胜于它。就在这里，爬山停止了。这是否意味着你可能只发现了一个所谓的“局部最大值”，而不是所有可能性的全局最大值。山顶的风景有时是骗人的。你可以知道你正站在山顶上，因为四周的地都会更低。但可能会有一座更高的山，就在另一个山谷的后面，隐藏在云之后。




“错误风景”：描述了解决方案质量如何在不同的可能性之间变化


想想龙虾陷阱里的龙虾：可怜的动物，它并没有意识到离开笼子就意味着要回到笼子的中心，它需要到笼子中心才能出去。龙虾陷阱只不过是由线构成的局部最大值——一种致命的局部最大值。

在旅行计划一例中，幸运的是，局部最大值没有那么致命，但是它们具有相同的特点。即使我们找到了一个无法通过任何细小调整来改进的解决方案，我们仍然有可能遗漏了全局最大值。真正的最佳旅行路线可能需要对旅行方案进行彻底的修整：以不同的顺序来安排整个计划路线，例如，一路向西而不是向东。如果我们想继续寻求改进，我们可能需要暂时恶化我们的解决方案。随机性提供了一种策略（实际上有好几个策略）就是这么做的。





局部最大值之外


其中一种方法就是用所谓的“抖动”来增大爬山算法。如果你看起来像是被卡住了，那就把它混合起来。做一些随机的小调整（即使它们的情况更糟），然后再回到爬山算法，看看你最后是不是在一个更高的山顶上。

另一种方法是，当我们达到一个局部最大值时，要完全地打乱我们的解决方案，然后从这个随机的新起点重新开始。这种算法被称为“随机重复爬山法”，或者，更鲜明的叫法是“猎枪爬山法”。他说：“当一个问题中遇到很多局部最大值时，这一策略被证明非常有效。例如，计算机科学家在尝试破译密码时使用了这种方法，因为有很多方法可以解密一条看起来很有用的消息，但最终无疾而终。在解密过程中，有一段看起来接近于合理的文本并不意味着你肯定是在正确的轨道上。因此，有时最好不要过于依赖一个既定的初始方向，而只是从头开始。

但还有第三种方法：当你用于某个问题时，不要变成全量的随机性，每次你做决定时都要使用一点儿随机性。这是由洛斯阿拉莫斯的团队开发出来的一种技术，它采用了蒙特卡罗法，被称为“梅特罗波利斯算法”。梅特罗波利斯算法就像爬山算法一样，都尝试在解决方案上进行不同的小规模调整，但它们有一个重要的不同之处：在任何一个给定的点上，它都有可能接受坏的调整和好的调整。

我们可以想象把这个应用到我们的假期计划问题上。之后，我们再次试图通过对不同城市位置上的调整来改变提出的解决方案。如果一个随机生成的结果会给我们旅行路线的调整带来改进，那么我们可以一直接受它，并继续在此基础上进行调整。但是，如果这种改变会让事情变得更糟，我们还是有机会将事情继续下去（尽管，越糟糕继续的机会就越小）。这样，我们就不会在任何地方停滞太长时间了：最终我们会尝试另一种解决方案，尽管它花费更大，同时有可能在路上提出一个新的更好的计划。

无论是抖动、随机重启，还是偶然的恶化，随机性对于避免局部最大值都是非常有用的。随机不仅仅是处理棘手优化问题的可行方法，在许多情况下，它是必不可少的。然而，有一些问题挥之不去。你应该使用多少随机性？何时使用？考虑到像梅特罗波利斯算法这样的策略可以无限地改变我们的行程，你怎么知道你已经完成了？对于正在研究最优化的科研人员来说，这些问题有一个惊人的确定答案将来自另一个领域。





模拟退火算法


20世纪70年代末和80年代初，斯科特·柯克帕特里克认为自己是一名物理学家，而不是计算机科学家。柯克帕特里克对统计物理学尤其感兴趣，这门学科会用随机性来解释某些自然现象，例如与退火相关的物理学内容，以及材料在加热和冷却时改变状态的方式。退火过程中最有趣的特性或许是材料冷却的速度往往会对其内部结构产生巨大的影响。柯克帕特里克解释道：

从熔体中生长出一个晶体要经过细致的退火过程，首先要将物质熔化，然后缓慢地降低温度，并且要在冰点附近的温度上花费很长时间。如果这一步没有完成，该物质脱离平衡，那么产生的水晶将会有许多缺陷，或者该物质就可能成为一个玻璃，没有序结晶。

当时，柯克帕特里克在IBM公司工作，该公司当时最大、最棘手也是最神圣的问题之一就是如何在IBM制造的芯片上铺设电路。这个问题有许多可能的解决方案可供考虑，还有一些严格的约束。一般来说，最好是把组件放在一起，但不要太近，否则就没有空间了。当你移动任何东西时，你必须重新计算所有的线路在新的假设性布局中是如何运行的。

当时，这个过程是由IBM公司内部的一个神秘的专家型人物所引导的。正如柯克帕特里克回忆的那样：“在IBM公司，他是最优秀的人，他在芯片上挤进去更多电路……他用一种最神秘的方式来解释他在做什么。他不想把实际操作告诉你。”

柯克帕特里克的朋友和IBM的同事丹·盖拉特对这个问题很感兴趣，很快这个问题就吸引了具有敏锐洞察力的柯克帕特里克。“物理系统研究的方法是把它们加热，然后再冷却，让系统自行编组。”这样一来，似乎就把所有最优化问题都当成是一件很自然的事情，就像是你想要组织的自由度是小的原子，或者是自旋，或者是你有的任何东西。”

在物理学中，我们所说的“温度”实际上是一种速度——在分子尺度上的随机运动。柯克帕特里克的解释是，这是一种直接的类似于随机的抖动，可以添加到爬山算法中，有时可以使其从更好的解决方案回溯到较差的方案中。事实上，梅特罗波利斯算法最初在物理系统中是为了模拟随机行为而设计的（在这种情况下，是核爆炸）。那么，柯克帕特里克想知道的是，如果你像处理退火问题那样处理最优化问题，比如如果你“加热”，然后再慢慢地“冷却”会发生什么？

在上面的去10个城市度假的例子中，我们可以从“高温”开始，完全随机地选择我们出发的路线，从所有可能的解决办法中挑出一个，不管价格是多少。然后，当我们考虑对城市排列顺序进行调整时，我们可以用掷骰子的方法开始慢慢地“冷却”我们的搜索。一个高等级的变化总是有意义的，但是我们只会在骰子出现2点或者更多的时候，才会选择较低的变化。之后，如果骰子掷出3点或更多——然后是4点，之后是5点，我们只会通过提高价格来进一步降低这样的随机性。最终，我们主要都是在向上爬，只有当偶尔掷出6点在时才会做出低级别改变。最后，我们将只会向上爬坡，直到我们到达下一个局部最大值。

这种方法被称为模拟退火算法，这似乎是将物理学映射到问题解决上的一种有趣方法。但它有效吗？在更传统的最优化问题的研究人员中，对该算法最初的反应是，整个方法似乎有点儿太过隐晦了。柯克帕特里克说：“我无法让数学界人士相信，这些复杂的东西与温度，以及充满类比的东西都是真实的，因为数学家都被训练得不相信直觉。”

但是，对这种基于类比的方法的不信任很快便会消失：在IBM公司，柯克帕特里克和盖拉特使用模拟退火算法设计出比那些专家设计的更好的芯片布局。他们并没有对他们的秘密武器保持沉默，让自己成为神秘的权威人物。而是在《科学》杂志上发表了他们的方法，并将其公开给其他人，在接下来的几十里，这篇论文将被引用多达32000次。到目前为止，模拟退火算法仍然是最优化问题在该领域最具前景的处理方法之一。





随机性，进化和创造力


1943年，萨尔瓦多·卢里亚并不知道他的发现将会为他赢得诺贝尔奖，他以为只是去参加一个舞会。卢里亚是一名从墨索里尼统治下的意大利搬到美国的移民，他父亲之前生活在意大利，卢里亚是一名研究细菌如何从病毒中获得免疫的研究人员。当他在印第安纳大学附近的一个乡村俱乐部参加了一场教师聚会时，他的研究还远未达到他所想的程度。

他当时看着他的一个同事玩老虎机：

我不是一个赌徒，当我取笑一个赌徒不可避免会遭受损失时，他突然中了头奖（大约3美元）他给了我一个鄙视的眼神，然后走开了。就在那时，我开始思考老虎机真正的数字命理学：在这样做的时候，我突然意识到老虎机和细菌的突变有一些可以相互借鉴的地方。

20世纪40年代，人们还不知道细菌对病毒的耐药性（以及对抗生素的耐药性）是如何产生的。它们是在细菌中对病毒的反应，还是仅仅是正在发生的突变偶尔产生的耐药性？似乎没有办法设计出一种可以提供决定性答案的实验，直到卢里亚看到那台老虎机，并突然顿悟。卢里亚意识到，如果他培育了几代不同的细菌，然后把最后一代细菌暴露在病毒中，就会发生两种截然不同的事情。如果耐药性是对病毒的反应，他认为在所有细菌培养基中，无论它是第几代，几乎都有相同数量的耐药细菌出现。另一方面，如果耐药性来自偶然突变，他可能会看到一些更不平均的东西（就像老虎机的奖金一样）。即大多数代系的细菌都不会显示出耐药性，一些代系中可能会有一个“孙”代的培养基出现突变，产生耐药性。在极少数情况下，如果在“家族谱系图”上有几代细菌都发生了适当的突变，那将会有一个“大奖”出现——所有的“孙辈”细菌都将产生耐药性。卢里亚立刻离开了舞会，并开始实验。

在经历了几天的紧张、不安的等待后，卢里亚回到实验室检查他的菌落。大奖出现了。

卢里亚的发现是关于机会的作用：关于随机与偶然突变是如何产生病毒的耐药性的。但这至少在某种程度上，也是由于机会发挥的作用。在正确的时间，正确的地点，卢里亚看到的老虎机触发了一个新的想法。关于发现的故事往往也有类似的时刻：牛顿的苹果（可能是杜撰的），阿基米德在浴缸里说“我发现了”，以及被忽视的培养青霉素的培养皿。的确，这是一个普遍现象，因此有一个新词就被发明出来：1754年，霍勒斯·沃波尔基于《锡兰三位王子》（锡兰是斯里兰卡古时的名字）的童话冒险故事，编了一个新词“意外发现”（serendipity），故事中的王子们“总是能意外地、睿智地发现一些他们不想追求的东西”。

随机性的这种双重作用是生物学的一个重要组成部分，也是主要发现之一，反复吸引了那些想要解释人类创造力的心理学家的注意。威廉·詹姆斯提出了这个想法的早期实例。1880年，詹姆斯被任命为哈佛大学的心理学助理教授，并在10年后出版了他在心理学上的权威理论。他在《大西洋月刊》上发表了一篇文章《伟人，伟大的思想和环境》。这篇文章以他的论点开篇：

我的知识从未注意到，有一种非凡的平行，一方面存在于社会进化的事实和种族的精神发展之间，另一方面存在于如达尔文先生所阐述的，社会进化与动物的进化之间。

在詹姆斯写作的时候，“动物进化”这个概念仍然是十分新鲜的（在1859年《物种起源》出版和达尔文本人还活着的时候）。詹姆斯讨论了进化思想如何应用于人类社会的不同方面，并在文章的最后转向了思想的进化：

新的概念、情绪和积极倾向的发展最初都是以随机图像、幻想、意外萌发的自发变化在过度不稳定的人类大脑中的功能活动等形式产生的，外部环境只是用来证实或否定、采用或拒绝、保存或毁灭这种想法（就是选择），简言之，它会因为类似的分子事故，选择形态和社会变化。

詹姆斯因此将随机性视为创造力的核心。他相信，在最具创造力的人中，这种特质是被放大了的。在他们面前，他写道：“我们似乎突然被引入了一个思想沸腾的大锅中，一切都在一种令人困惑的状态中叫嚣和摆动，在这种状态下，伙伴关系可以立即加入或松开，单调的例行程序是未知的，而意料之外似乎是唯一的规律。”（注意，与这里的“退火”直觉相同，来源于温度的隐喻，混乱的排列就相当于热量。）

詹姆斯理论的现代实例出现在唐纳德·坎贝尔的著作中，他是一位生活在100年后的心理学家。1960年，坎贝尔发表了一篇论文，题为“在其他知识处理过程中的创造性思维的盲变与选择性保留”。就像詹姆斯一样，他以他的中心论点开篇：“一个盲目的变异和选择性的保留过程是所有归纳成果、所有知识的真正增加，以及所有的系统适应环境能力增长的基础。”和詹姆斯一样，他也受到了进化理论的启发，他认为创造性的创新行为是新思想产生的结果，是随机产生的，人类精明的头脑保留了这些思想的精华。坎贝尔完全支持他的论点，并引用了其他科学家和数学家关于他们的研究发现的背后故事。19世纪物理学家和哲学家恩斯特·马赫和亨利·庞加莱都似乎提供了一个和坎贝尔相似的解释，马赫走得很远，他宣称“因此这解释了牛顿、莫扎特、理查德·瓦格纳以及其他人所说的话，他们说，想法、旋律及和声会全部涌向他们，而他们只是留下那些正确的”。

关于激发创造力，一种常见的技术就是引入一个随机元素，比如人们必须与之建立联系的一个词。例如，音乐家布莱恩·伊诺和艺术家彼得·施密特创造了一种被称为“间接策略”的卡片，以解决创造性问题。先选择一张卡片，任何一张卡片，你将会得到一个关于你的随机的新视角。（如果这听起来工作量太大，你现在可以下载一个为你挑选卡片的应用程序。）伊诺认为，对他们开发这些卡片的原因与逃离局部最大值有很明显的相似之处：

当你处于某一事物的中心时，你就会忘记最明显的事物。你从工作室出来，你会想“我们为什么不记得做这个或那个”？这些（卡片）真的只是将你从框架中抽离出来，打破了一点儿上下文的限制，所以你不是一个在工作室专注于一首歌的乐队，但是你是活着的人，并生活在这个世界上，你还知道很多其他东西。

随机地抖动，从框架中跳出来，专注于一个更大的范围，这提供了一种可以离开可能的局部较好的方法，然后回到追求可能的全球最优的方法。

你不需要像布莱恩·伊诺那样给你的生活增加一点儿随机的刺激。例如，维基百科提供了一篇“随机文章”的链接，而汤姆多年来一直把它作为他的浏览器的默认主页，每当他打开一个新窗口时，都会看到一个随机选择的维基百科条目。虽然这还没带来什么惊人的发现，但他现在对一些鲜为人知的话题（例如智利武装部队使用的刀）有了很多了解，他觉得其中一些已经丰富了他的生活。（例如，他了解到葡萄牙语中有一个词表示一种“模糊却坚持的渴望，想得到某些不存在或不可能存在的东西”，这是一个我们仍然无法用搜索引擎解决的问题。）这带来的一个有趣的副作用就是，他现在对维基百科上的主题有了更清晰的认识，而且对随机性的真实情况也有了更清晰的认识。例如，那些他感觉与他有某种联系的页面（关于他所知道的人或地方的文章）出现的频率令人尤为惊讶。（在一次测试中，在两次重新载入之后，他成为“西澳大利亚州立法委员会的成员”，他在西澳大利亚长大。）知道这些实际上都是随机产生的，让他在余生中可以更准确地评价其他“巧合”。

在现实世界中，你可以通过加入一个社区支持的农场来随机选择你的蔬菜，这个农场每周都会给你送一盒农产品。正如我们之前看到的，加入社区支持农业项目的确可能会造成调度问题，但送来了你通常不会买的水果和蔬菜，这是让你在菜谱轮换中被击败的最好方法。同样地，每月的书、酒和巧克力俱乐部可以让你接触到那些你从来没接触过的各种书本知识、品酒技巧以及味觉体验。

你可能会担心，通过抛硬币做出的决定可能会带来麻烦，尤其是与你的老板、朋友和家人在一起的时候。确实，将随机性融入你的生活并不一定是成功的秘诀。1971年卢克·莱恩哈特（真实名字是乔治·科克罗夫特）写的一篇经典小说《骰子人生》，给我们讲述了一个警示故事。它的叙述者——一个用掷骰子来做决策的人，最后很快就终结在我们大多数人可能想避免的情况下。

但也许这只是一个小知识的例子，它是一件危险的事。如果《骰子人生》中的人物能对计算机科学有更深刻的理解，他做事就会有一些指导。首先，从爬山算法可以得知：即使你有执行坏主意的习惯，你也应该坚持执行那些好的想法。第二，从梅特罗波利斯算法可知：你有执行一个坏主意的可能性与该想法的糟糕程度成反比。第三，从模拟退火算法可知：你应该提前实现随机性，在完全随机的状态下迅速冷却，随着时间的推移，使用越来越少的随机性，当接近冰点时，持续的时间最长。再让自己回火（照字面意思理解）。

这最后一点也发生在小说作者自己身上。很明显，科克罗夫特自己与他的主人公没有什么不同，他在自己的生活中“切”出一段时间，与他的家人在地中海的帆船上生活，像是一种缓慢的布朗运动。然而，在某一点上，他的退火计划冷却了下来：他在纽约州北部的一个湖上舒适地定居下来。他现在已经80多岁了，他仍然在那儿心满意足地生活着。“一旦你到了某个地方，你就会很高兴，”他在《卫报》上这样表示，“如果你再到处折腾，那就太傻了。”




