## 01. 读《修改代码的艺术》

dreamhead

2007-10-22 12:48:02

[读《修改代码的艺术》](https://book.douban.com/review/1226942/)

作为一个程序员，获取知识是让我不断前进的动力，而读书是我获取知识的一条重要途径。在这个「经典」、「必读」过剩的年代里，大多数的书都仅仅扮演着传播知识的角色，真正改变自己对某些问题看法的书其实少之有少。限于读书时的眼界和能力，在我列表中，让我拍案惊奇的书只有几本。Martin Fowler 的《重构》，严格说来，我并没有完整的读完这本书，不过，正如作者自己所说，这样的书原本就不指望能够读完，因为有一大部分其实是参考手册。正是我读过的部分让我知道了重构，让我知道这么做可以把代码写得更好。Robert Martin 的《敏捷软件开发》，这是一本名字赶潮流，内容很丰富的书，这本书让我开始理解软件设计，从此不再刻意追求设计模式。Kent Beck 的《测试驱动开发》，我读的是英文版，因为当时中文版还没有出版，所以，我不敢说，我通过这本书很好的理解了测试驱动开发，但它却为我打开了一扇门，让我知道了一种更好的工作方式。

有好长一段时间，这个列表没再更新过，中间虽然我也读了很多书，也学到了很多东西，但却没有哪本书如这几本书一样给我带来巨大触动。新近加入我这个列表的书是《修改代码的艺术》，英文名是《Working Effectively with Legacy Code》。

对于很多软件开发人员来说，加入一个公司，通常意味要面对一大堆之前留下的代码。而面对沉重的负担，大多数人的感觉都是无可奈何。让无奈成为往事，也就是这本书的价值所在。在我看来，这是一本讲解如何编写测试的书。之所以遗留代码让人头痛，除了复杂的逻辑，改动会带来怎样的后果是一件让人心里没底的事，而测试的存在可以大幅度降低这种恐惧。但是，许多代码在开发时并不考虑测试，这样做的结果就是让测试几乎成为一件不可能完成的任务，一个常见的例子就是代码中访问数据库。即便写出测试代码，漫长的测试过程也会让它失去一部分应有的作用，我们希望得到的是快速的反馈。所以，对于无测试而言，知道编写测试是一种境界的提升，写好单元测试则是一种更高的境界。如果能够让测试驱动开发，从开发之初便考虑测试，并懂得如何写好测试，开发者应该不会陷自己于一种难为的境地，这也应该成为专业程序员应该具备的基本技能。

至于这本书的具体内容，我的评价是实用。具体的手法，很难在这里一一列举，但是，以我的开发经验来看，许多似曾相识的代码不断的出现在书中，而作者举重若轻的处理手法，正是让我有拍案惊奇的地方。实际上，回味起来，每个手法都不是什么很高超的技法，但正是因为见识过类似的代码，才能体会到这种手法的价值所在。所以，相对于程序新人，它更适合有经验的人。

之所以说这本书更适合有经验的人还因为，这本书中谈及的内容涵盖设计、测试、重构等诸多方面：通过重构，解开代码内的耦合，让其可测。这恰恰是前面提到的那三本书所讲的内容。也只有懂得了这些基本内容才能体会到那些具体手法的价值所在。依然记得当年读《重构》时，在提取和内联之间迷茫了好久，直到后来经过了许多开发实践才体会到这些做法的真正含义。

如果说不足，那么，这本书缺乏一个列表，就像 Martin Fowler 为《重构》所做的那样，出什么样的问题，应该采用怎样的手法进行处理。

关于中译本，总的来说，翻译得很流畅，读起来比较舒服。不过，制作上还是有一些不太让人满意的地方。

* 译注太多，而且有些是低估读者智商的译注。

* 页边标有页码，似乎是为了与英文版对照，但文中的参考页码又是以中文版为准，显得有些乱。

* 书的装订不是特别令人满意，我一直担心从中间断开。

## 02. 围绕重构来阐述如何修改遗留代码的不错的书

疯狂的菠菜

2009-09-14 22:33:46

[围绕重构来阐述如何修改遗留代码的不错的书](https://book.douban.com/review/2333124/)

这本书看的时间非常长，断断续续有 3 个星期了吧，不错的书，至少对我来说是这样，因为我现在就碰到了书中列出的种种问题：对已有的没有完善的单元测试的核心系统进行重构。为了保证少出乱子，不出乱子，我必须小心的对超大类，巨型方法采用各种重构手段进行修改，没有单元测试作保证的系统进行重构是非常危险的事儿，那怎么办呢，这本书让我知道了不少好的方法。

与「重构到模式」一样，这也是一本围绕重构来阐述如何修改代码，只不过它面对的场景是遗留系统。对遗留系统进行重构首先要做的就是要让我们的修改能够被单元测试工具夹住，就像对一栋居民楼进行改造一样，必须先安装脚手架，拉上防护网，做好安全措施，然后再开工。从而减少因为修改带来的风险。

如何在修改代码前搞定对应的单元测试呢？这是一个非常有技巧的活儿，因为遗留系统可能因为设计不佳而无法或者很难非常容易的为其修改部分添加单元测试。之所以造成这样的局面一个重要的方面是无法对要测试的部分进行解除依赖。因此解除相关依赖也就成了修改代码首先面对的一个难题，本书在解除依赖方面总结了非常多的方法（或模式），这些方法总有一款会适合你。本人觉得这应该算是这本书的所要告诉我们的主要内容吧。

本书的例子大部分都是以 java 为主，少量的穿插了 c++ 的实例，而且有些手法跟语言的关系比较大，可能适用 c++ 的做法，对 java 并不适用。另外本书给我的另一个启发就是，我们在写代码的时候，应该尽量做好单元测试，单元测试可能在最初实现的时候，作用相对来说比较小，但是在后期维护修改重构以及添加新功能的时候，其威力将逐渐显现出来。此外一些系统之所以不好修改，后期维护困难，与我们编码时候没有遵循一定的规则有关，比如依赖管理，代码复杂度控制，这些规则其实都非常简单，人人都会知道，但是在具体场景能不能想到，并加以灵活运用却是另外一回事儿，我觉得这个必须经过大量的编码实践才能找到这种感觉，就像学习英语，只有多读，多听，多说，才能具有一定的语感，从而最终掌握。

## 03. 翻译的很一般，机械工业出版社

YigWoo

2014-07-20 00:51:25

[翻译的很一般，机械工业出版社](https://book.douban.com/review/6747567/)

买这本书的原因一是这本书确实是一本关于修改老代码的经典，二来翻译者是中国地区 InfoQ 的主编。但是入手看了大概到 100 多页之后实在是忍不住要上来吐槽一下。

首先是翻译的通畅性，应该说是比较烂的水准，只能说是将将达到合格的水准，这个可能是个人的偏见。但是我就举几个例子：

一、关于 Test Harness 这个词组的翻译，文中使用的是测试用具，原谅我看不懂这个 Harness 为什么要翻译成「用具」，这个地方我觉得可以有更好的翻译吧，但是这个词组确实是挺难翻译的；

二、第 105 页中间，「不要误导我」，英文原文，「Don't get me wrong」。「误解」和「误导」的意思相差还是很大的，虽然我看到这句的话的时候能够猜个八九不离十，但是还是觉得不够用心。

三、第 48 页倒数第二段，中文翻译「这看起来是很简单的修改，但是它很具有侵略性」，英文原文是「This seems like a simple change, but it was pretty invasive」。「invasive」，在我有限的知识理解范围内，觉得在程序员的领域，可能「侵入性」会比「侵略性」用的更频繁一点。Correct me if I'm wrong。

「Edit」四、第 111 页最后一段第三句。「我们需要 HttpPostedFiles 在测试中运行 getKSRStreams」，原文「We need HttpPostedFiles to run getKSRStreams in test」。难道真的是谷歌翻译机器翻译的东西？连基本的断句都不管了？代码中明明是 HttpPostedFiles 放在 getKSRStreams () 这个方法当中，意思很明显是「为了运行 getKSRStreams () 这个方法，我们需要 HttpPostedFiles 这个类的实例」。附上谷歌翻译对原文的翻译：「我们需要 HttpPostedFiles 在测试运行 getKSRStreams」，满眼都是谷歌翻译的感觉。

还有对于格式的吐槽：

一、在正文中的代码都是用的 Times New Roman 字体，简直没法看，代码无论在那个地方都应该是用等宽字体，这我觉得如果你去下一本这本书的英文原版的电子书来看，一定会有感觉。该是代码的地方，原版的书肯定是等宽字体。

二、81 页，小结当中，英文的书名用的是中文的书名号《》括起来的，而且推荐的两本书，用的书名号的格式还不一样，第一本在左书名号后面加了空格然后写书名，第二本书在左书名号后面没有加空格。

关于格式，可能是我太挑剔了，但是我觉得一本好书，不光内容要好，排版的格式，常用的格式的规定，也很重要。看看 O'Reilly 出版社的书，然后再看看国内一些出版社的书（没错，我说的就是机工的书），个人能够感觉到用心和不用心的差距在哪儿。

2016-8-5 update

虽然翻译不好，但回过头来看，这本书中所提到的各种修改遗留代码的技巧，真的是非常地有用。所以从内容上还是推荐这本书，必要的时候配合英文版一起阅读。

## 04. 修改代码艺术的叨唠

CloudFeng

2018-12-06 22:04:57

[修改代码艺术的叨唠](https://book.douban.com/review/9805199/)

### 读书缘由与标题评论

读书的时候就想读这本书了，后面一直没有读。想读的时候，发现各个买书平台都不卖或者卖都是忒贵。有一次在群里面问群友们：有没有刘未鹏先生翻译版本？他们说看的都是新版。由于新版的作者不是很了解，加上对刘未鹏先生写的博客一直有看，他翻译的应该也不会差到哪里去。后来在二手书店买了一本。

工作了，面对的一大堆遗留代码，而各种需求都是如何优化，如何添加新功能。如何面对遗留代码的问题自然而然就冒出来了。《修改代码的艺术》看书名感觉有点搭不是边。看着英文标题才有确定。猜想刘未鹏先生给出此书名受到不小的影响，不然也不会冒然改动这么大。最近看了通读了一遍，例子翔实，有的代码存在小错误，但不影响阅读。

### 修改（重构）代码步骤与阅读

本书一上来就说明为啥需要修改代码，把原因分类，如何测试。关于如何安置测试是本书的主题，只有安置好测试之后才能安心工作，而不是祈祷式的修改上线。安置测试的时候，必然就会面对一大堆代码，甚至不知道如何写测试，特别是面对大量依赖性代码的时候。本书就为此而写的。

此书章节有点乱，而且书的交叉引用超多。不知道是作者有意为之：希望读者看看体会这些解依赖技术如何产生的。若要体会好此书，个人建议按照步骤来读。步骤如下：

- 确定改动点：画草图、影响结构图。

- 找到测试点 ：在影响结构图根部。

- 解依赖：重头戏，在第 25 章详细介绍了各种解依赖技术。

- 编写测试：TDD。

- 修改、重构：特征图。

看完这些看完之后，胸中有了蓝图，心里面存在疑问了，咋解决大类，巨型方法啥的。如何动手处理呢。作者也专门弄了一章来如何在优化需求的情况下，如何一步一步的修改代码。

### 总结

看此书可以体会到两点：

1. 面对遗留代码，重构的道路是不会停止的，需要持续进行。

2. 单元测试，可以反推你设计是否合理。

另外，就是看国外的书籍，经常会发现很多作者将自己的经验进行总结，比如《代码大全》、《程序设计实践》等优秀图书都是他们遇到的坑。这些书值得我们阅读，谢谢 Michael C.Feathers 和刘未鹏先生。希望国内能够出一些类似脚踏实地的书。

## 05. 写代码不是一件简单的事情

jerry

2009-09-11 14:07:25

[写代码不是一件简单的事情](https://book.douban.com/review/2321101/)

《修改代码的艺术》看完了。

这本书很薄，但是看起来还是很吃力，里面介绍了很多重构的知识，而且有很多 c++ 的内容，有的地方也是似懂非懂的，如果了解设计模式和重构，就会轻松很多，可能艺术这东西，本身就不容易懂吧。里面对单元测试的依赖性很强，其实还是一本不错的书，你完全可以领略到作者真的把代码的修改看成是一种艺术，软件工程师要做到匠人的地步也着实不容易。

看得出写代码不是一件简单的事情，是需要经验的，不像国内这样，写代码是年轻人的事情，其实没有时间的锤炼是写不出好的代码来的，即使写出来也不能谈得上是艺术了。

希望将来再次翻起这本书时会有更多的领悟。

## 06. 我们该怎么写代码

2010-06-19 18:39:32

[我们该怎么写代码](https://book.douban.com/review/3342930/)

当软件系统的规模随着时间不断增长时，我们怎么构建和维护它？面对别人写好的大量的代码基，如何进行后续的可持续开发？TDD，单元测试，重构，设计模式这些看上去很美的技术，是如何应用的？

毫无疑问，这本书里不可能提供上诉问题的所有答案，但是它至少提供给我们了一种思路或者说是一个演示。让我们知道这么多优秀的可以让我们的设计、我们的代码变得更美、更有弹性、更易于维护技术是如何应用的。

更多的时候，我们都是在一个既有的代码基上工作的，修改它、扩展它、重构它。然而它肯定不是尽善尽美的，如果我们想修改它的架构、或是调整某些东西的实现、抑或加入些新功能？这时怎么能在既有的约束下，实现我们的需求呢？一个旧有框架，如何能不断的进化，而且扩展性，弹性也越来越好呢。基本上这本书就是谈论这些内容的。

实际平时基本不怎么写单元测试，对单元测试和 TDD 了解的也不多，我基本是拿这个当入门书看了。而且这本书对重构和解依赖等一些技术的讲解也是什么到位的，值得一看。

## 07. 重构与测试的纠结

eBen

2008-12-17 18:15:44

[重构与测试的纠结](https://book.douban.com/review/1587795/)

如果你想重构，重要的前提就是有强力的测试。哪怕你有自动化重构工具在手。

如果你想对既有代码进行测试，你就必须先重构，因为代码根本就没有办法在测试工具中实例化。

新写的代码大多是可以先进行测试，然后再挂接到原有代码中。而对付遗留的代码，我们则需要一点点地把代码抠出来测试。修改遗留代码时，我们需要将代码解依赖出来，建立其测试，然后才对它进行修改。

并不是所有的重构手法都需要测试，特别是我们已经有了自动化的重构工具。书中说的一些解依赖技术就是一些特殊的重构技术。只要我们小步地前进，细心地操作，并借且自动化重构工具，无须测试就能进行重构。而这些重构技术的目标就是为重构出来的代码建立测试。一旦测试建立，则可对代码进行更为自信的修改，则可对代码进行更自信的进一步重构。

## 08. 书很细，无经验读着有压力

银光

2012-10-03 17:44:53

[书很细，无经验读着有压力](https://book.douban.com/review/5604832/)

一两个月前看到了这本书，那时候正对编写高质量的代码很感兴趣，于是借来读。这一个月断断续续的读完，实际上读书的时间仅有 10 天左右的业余时间。读的很浅，但也有小小的收获。

这本书讲解如何在不漂亮的旧代码下写漂亮的新代码，依照先有测试后有功能的思想，作者全书都围绕如何让代码可测试展开。如果旧代码特差，而又时间紧迫，不足以把旧代码纳入测试，通常是让新代码跟旧代码独立开。这可能需要用上继承，会让代码有不必要的层次，这没关系，重构一直在进行，只要代码纳入了测试，以后就可以把它们去掉。让代码纳入测试，很多时候是说能够用伪造的东西替换真实的东西，这个伪造的东西是测试用的。可以有很多种修改方法让代码能有单元测试，主要有几类方法：预处理期、链接期、修改代码（对象、方法的替换）。

本书看完之后，能回忆起来的东西很少，可能是因为没细看，也可能是写的太细了，实际工作中从来没有试过像书中所说的那样去写代码，步骤那么细，有必要吗？修改代码时，步伐要小是正确的，但小的书中所讲解的那种地步就有点受不了。本书可以总结为三个字「解依赖」，细节上就是各种各样的案例。

看这本书需要有大工程代码的修改经历，不然会觉得很无趣，我现在就有点无趣，跟第一次看设计模式一样的感觉。测试驱动开发，这是我初次接触到的概念，虽然工作中挂着敏捷的羊头，但我们的代码不存在单元测试，连影子也没有。看书的时候想，实际工作不一定要有真实的测试先行，只要头脑里有单元测试的思想，写代码的时候就会尽可能的往那一个方向去，在设计的时候就会想，假如需要测试代码能这样写吗？自然的就会让代码有更少的依赖，更多的分层，这也就有了单元测试的影子，依赖少了，可扩展也强了。这也就是读这本书的潜移默化的影响。

书里讲解看旧代码时，也讲解了些外围的东西，画图看代码就是很不错的方法。还有编译依赖导致一个工程的构建花费很多时间，这点书里谈到的不多，但工作中深感触，不必要的头文件包含、模板的滥用都会导致依赖增多，编译时间变长。这书跟《重构改善既有代码的设计》是同种类型。不过这本书怎么是这个书名呢？英文版是「Working Effectively with legacy Code」，也就是「在遗留代码上有效的工作」，强调的重点就不一样了。

看这本书有些名词不熟悉的压力，看到了很多新名词，譬如「函数签名」（其实就是形参），「朴素化参数」（可能是说让被切入测试的函数的参数是一般类型），「自由函数」（术语表有解释，C++ 中是非成员函数），「领域类」（就是 MVC 中的逻辑 M，这个词在《重构》上出现过）…… 这些新名词也不知道是不是通用的，如果不是通用的，搞出一个离本意遥远的新词来，又不在章节的开头给概述性解释，就真是让看者莫名其妙了（我又想到了那个「名字粉碎」的翻译，这本书里也用了它，很文艺很奇怪）。译者有些地方太小心了，加了不必要的译注，有些地方又感觉翻译得不容易快看，如果能意译会好些。

## 09. 满满的是实战经验

杰良

2013-02-03 20:51:11

[满满的是实战经验](https://book.douban.com/review/5766487/)

很好的实战经验，快来取道。在最近的开发项目中经常想起本书讲解的一些技术，受益匪浅。虽然我并不是 working on legacy code ，但是项目代码从无到有到完善也是经历几个阶段的，在不断演化，不断修正。另一方面，一边写单元测试，也参考了本书。

以前以为测试只是为了保证程序的正确性，现在才知道，原来测试尤其是单元测试，在代码重构、优化设计上的作用那么的大。本书，译为「修改代码的艺术」，讲的却不全是「修改」，目标总是「安置测试」。这里的「修改」就不是重构了，而是为了重构的高效、安全而修改代码来安置测试。

书中的讲解很好，但这却不同于自然科学原理，需要在亲身实践中不断体会，从而将其掌握。

2013-02-03

杰良

## 10. Java 重构必读书

leechau

2013-12-15 13:37:09

[Java 重构必读书](https://book.douban.com/review/6462085/)

Java 重构的必读书，非常实用，但有的时候我想，Java 代码的重构如此复杂，是否说明面向对象的设计思路在很多场合并不适用呢？比如很多服务端的逻辑本身是典型的函数转换，如果使用 FP 范型开发会简单的多。

推而广之，如果一种技术在大多数程序员手里都越用越复杂，以至于需要专家级的程序员来重构，是否说明这种技术本身就有比较明显的缺陷呢？至少易用性不好。

## 11. 重构三部曲让我对代码的理解有重生之感

lanjing

2016-04-08 12:57:33

[重构三部曲让我对代码的理解有重生之感](https://book.douban.com/review/7844720/)

我的「重构三部曲」之三，（另外两本是《重构》，《从重构到模式》，这三本书让我对代码的理解有重生之感。大部分书都是教你怎么从 0 开始写好代码，但是现实是经常从接手已有的项目开始，所以这三本就很有价值。这本书压箱底 8，9 年了，前些年有次囫囵吞枣看到 100 多页就放弃了，因为看不懂。有了前两本垫底，这次阅读就轻松多了。书给我最大的震撼是在开头，「遗留代码」legacy code 的定义！一般我们会把别人写的代码定义为遗留代码，或者自己的代码写着写着就变成了遗留代码。书中对遗留代码的定义非常明确：「遗留代码就是那些没有编写相应测试的代码。」由此凸显测试驱动开发的重要性，简单说我觉得有 3 点，1）测试是一种即时反馈的技术，能帮助尽早快速定位到 bug。2）从可测试的角度能够写出更好的代码，因为会关注依赖，测试的过程本身也是对代码理解的过程。3）「通过单元测试」是代码质量一个可测量的指标。是设计不足与过度设计的分界点。（好吧，这点我说的有点虚，希望一年内，我能整理出在 iOS 上测试的流程、工作和经验。）

这本书分为三部分：1）修改机理，讲作者修改代码的方法论。2）修改代码的技术，将代码中遇到的坑一个个罗列出来，而且给出非常实用的对付手段，绝不理论和太极。3）借依赖技术。不合理的依赖是万恶之源，这章有 24 小结专门介绍怎么对付他们。话说，看完之后，我忘了大半，等我 TDD 做起来之后再来验证性的看一遍。

最后吐槽一下翻译的书名。原书名是《Working Effectively with Legacy Code》，很清晰的一个名字，非要翻译成《XXX 的艺术》，估计是因为当时受到高纳德《计算机程序设计的艺术》的影响，写代码更多是个体力活，尤其考验程序猿的眼镜、颈椎、腰椎、还腚。。（像柳比歇夫说自己拍照不是拍正面，而是拍屁股，他是个坐功很好的人。）恕我慧根不够，不敢称呼自己是「艺术家」，却是个面朝屏幕背朝椅的地道「码农」。