## 译者序

C# 是一门出色的语言，设计时兼顾了面向对象和函数式编程的特点。若你接触过 C++ 或者 Java，那么一定可以快速上手 C#。

C# 富有表现力且吸收了其他语言的经验。它的定义清晰，少有历史包袱。其进化速度之快也是有目共睹的。从 2002 年诞生到如今一共发布了 14 个版本（不包含技术预览版）。如果说这门语言在 21 世纪之初的十六年间都在慢跑的话，那么近几年的发展则是突飞猛进的。这种蓬勃发展主要体现在三个方面：

第一，从语言版本上讲，2017-2020 年这四年间从 6.0 升级到了 9.0 preview，包含六次正式的版本发布，每一次发布均包含明显的语言能力提升。

第二，C# 和 .NET 有着紧密的关系。从平台上讲，微软对 .NET 平台的开放态度前所未有，.NET Core 的发布真正让它的跨平台能力不再停留在理论层面，而其中的持续改进（不论是底层虚拟机层面的改进还是上层 Framework 的改进）让它在各个技术雷达上逐步被主流的技术团队锁定。

第三，国内外云平台对 .NET Core 的支持不断完善。

因此，不论在语言、平台还是云服务方面，C# 和 .NET Core 都展现了强劲的发展势头。实际上除了 .NET Core 之外，用于移动设备开发的 Xamarin 和跨平台的游戏开发工具 Unity 也使用了 C# 作为主要的开发语言。我非常愿意将这样一门用途广泛、富有创造力的语言推荐给各位读者。而本书可谓是学习 C# 语言理想的一站式读物。

本书全方位地介绍了 C# 的语言特性。在内容上，它兼顾了不同层次的读者。对于初学者，本书不论是介绍基本的语法时，还是介绍高级的语言特性时，都采用了讲解和示例结合的方法。从原理到实践，双管齐下，因此阅读门槛并不高。尤其值得一提的是这些范例都可以直接在 LINQPad 工具中运行。充分练习这些范例有助于读者快速掌握 C# 语言的各种实践。而对于编程经验丰富的读者，本书的每一章都详尽而系统，非常适合案头参考。本书对.NET Core 这一目前主流的跨平台.NET 实现进行了详细的介绍。除了充分涵盖常用基础类库外，还对垃圾回收等运行时相关的主题进行了讨论。得益于作者开发 LINQPad 的丰富经验，本书最后一章对 Roslyn 编译服务的讲解系统而完整，是非常难得的参考资料。

本书在上一版《C# 7.0 核心技术指南》的基础上进行了大量的修订。不但将既有的内容和范例全部迁移到了 .NET Core 上，对 C# 8.0 与 .NET Core 3.x 提供的新特性进行了详细的介绍，还在部分示例中专门对编写跨平台运行程序的技巧或陷阱进行了说明。可以说，本书在内容上涵盖了目前 C# 与 .NET Core 最新正式发行版的内容。

最后，感谢本书的作者 Joseph Albahari。他在我翻译本书时给予了热情的帮助。我们就书中的一些技术细节进行了讨论，我将这些内容放在了译注中。感谢机械工业出版社华章公司的编辑们，他们给予了我很多专业的宝贵建议。他们高标准的把关保证了本书的质量。感谢我的家人，她们的支持给予了我不断前行的动力。希望这本书能给大家带来愉快的阅读体验。请进入 C# 的精彩世界吧！

## 前言

C# 8.0 是 Microsoft 对其旗舰编程语言的第七次重大升级，这次升级极大地提高了 C# 语言的功能和灵活性。一方面，它提供了一些高级的抽象，例如查询表达式和异步延续；另一方面，它允许通过自定义值类型和可选的指针结构进行底层的效率优化。

C# 语言特性的增长也极大地加重了我们的学习负担。虽然一些工具如 Microsoft IntelliSense 和在线参考文档可以提供诸多便利，但若要使用它们，仍需要一些现有的概念和知识体系作为支撑。本书以简明统一的方式（而非烦琐冗长的介绍）准确阐释了这些知识。

与之前的五个版本一样，本书也是围绕概念和用例来组织的，因此无论是顺序阅读还是随意浏览都会大有裨益。虽然本书只要求读者具备基本的背景知识，但是它仍然具有一定的深度，因此本书也适合中高级读者阅读。

本书内容涵盖 C# 语言、公共语言运行时（Common Language Runtime，CLR）和.NET Core 核心程序集。我们之所以做出这样的选择是希望为一些难以理解的主题，例如并发、安全性以及访问操作系统功能留出足够的篇幅，而同时又不对内容的深度和可读性造成显著的影响。本书详细标记了 C# 8 的新特性，因此亦可同时作为 C# 7 的参考资料。

### 01. 目标读者

本书主要针对中高级开发人员。本书不要求读者具备 C# 知识，但需要读者具备一定的通用编程经验。对于初学者，本书适合作为教材以外的补充书籍，而非替代编程教材。

本书非常适合与那些着眼于介绍具体应用技术的书籍配合阅读，例如介绍 ASP.NET Core、Windows Presentation Foundation（WPF）和 Universal Windows Platform（UWP）等技术的书籍。因为那些书籍往往会省略语言和.NET Core 方面的内容，而这些内容正是本书的重点。

本书不适合想匆匆浏览每一种.NET 技术的读者阅读，亦不适合关心特定领域（例如移动端设备开发）API 使用方式的读者阅读。

### 02. 本书的结构

本书第 2～4 章将详细介绍 C# 语言。首先介绍最基本的语法、类型和变量。而后会介绍一些高级的特性，如不安全代码以及预处理指令。如果你是 C# 语言的初学者，请循序渐进地阅读这些章节。

其余各章则涵盖了.NET Core 的核心功能，包括语言集成查询（Language-Integrated Query，LINQ）、XML、集合、并发、I/O 和网络、内存管理、反射、动态编程、特性、安全以及原生互操作性等主题。第 5～6 章是后续章节主题的基础，除这两章之外，其余各章可以按照需要以任何顺序阅读。LINQ 相关的三章最好按顺序阅读，其中的部分章节需要一些并发相关的知识，这些知识将在第 14 章中介绍。

### 03. 使用本书所需的其他材料

运行本书中的示例需要.NET Core 3。此外，还可以使用 Microsoft 的.NET 在线文档查找每一个具体类型及成员的信息。

虽然可以在记事本中书写源代码并从命令行中执行编译过程，但是为了提高效率，最好使用一个代码编辑执行工具随时测试各个代码片段并使用集成开发环境（Integrated Development Environment，IDE）来生成可执行文件或程序库。

对于 Windows 操作系统的用户，推荐从 www.linqpad.net

下载免费的 LINQPad 6 作为代码编辑执行工具。LINQPad 完全支持 C# 8.0，且该软件就是由本书的作者之一维护的。

至于 Windows 操作系统下的集成开发环境，建议下载并使用 Microsoft Visual Studio 2019。该工具的任何版本都能够运行本书中的所有示例。如果需要使用跨平台的集成开发环境，则请下载 Visual Studio Code。

LINQPad 中包含了本书中的所有示例代码。这些示例代码均可以再次编辑并交互式运行。如需下载所有的示例代码，请在 LINQPad 底部左侧的「Samples」选项卡中单击「Download more samples」按钮，并选择「C# 8.0 in a Nutshell」。

.NET Core 支持 Windows、Linux 和 macOS。我们在 Ubuntu Linux 18.04 中对部分跨平台特性进行了测试。详细代码请参见 GitHub（https://github.com/ericjohannsen/Nutshell8）。

### 04. 排版约定

本书使用基本的 UML 符号来说明类型之间的关系，如图 P-1 所示。其中斜矩形代表抽象类，圆形代表接口。带有空心箭头的线段代表继承，其中箭头指向的类型是基类型。带有实心箭头的线段代表单向关联，不带箭头的线段代表双向关联。

图 P-1：UML 符号应用示例

本书还遵循以下排版约定：

斜体（Italic）：

表示 URI。

等宽字体（Constant width）：

表示 C# 代码、关键字和标识符，以及应用程序的输出。

等宽粗体（Constant width bold）：

代表代码中的重点部分。

等宽斜体（Constant width italic）：

代表可由用户输入替换的文本。

该图标代表一般性注解。

### 05. 示例代码

这里的代码是为了帮助你更好地理解本书的内容。通常，可以在程序或文档中使用本书中的代码，而不需要联系 O'Reilly 获得许可，除非需要大段地复制代码。例如，使用本书中所提供的几个代码片段来编写一个程序不需要得到我们的许可，但销售或发布 O'Reilly 的配套 CD-ROM 则需要 O'Reilly 出版社的许可。引用本书的示例代码来回答一个问题也不需要许可，将本书中的示例代码的很大一部分放到自己的产品文档中则需要获得许可。

非常欢迎读者使用本书中的代码，希望（但不强制）注明出处。注明出处的形式包含书名、作者、出版社和 ISBN，例如：

C# 8.0 in a Nutshell，作者 Joseph Albahari 和 Eric Johannsen，由 O'Reilly 出版，书号 978-1-492-05113-8

如果读者觉得对示例代码的使用超出了上面所给出的许可范围，欢迎通过 permissions@oreilly.com 联系我们。

O'Reilly 在线学习平台（O'Reilly Online Learning）

近 40 年来，O'Reilly Media 致力于提供技术和商业培训、知识和卓越见解，来帮助众多公司取得成功。

我们拥有独一无二的专家和创新者组成的庞大网络，他们通过图书、文章、会议和我们的在线学习平台分享他们的知识和经验。O'Reilly 的在线学习平台允许你按需访问现场培训课程、深入的学习路径、交互式编程环境，以及 O'Reilly 和 200 多家其他出版商提供的大量教材和视频资源。有关的更多信息，请访问 http://oreilly.com。





## 如何联系我们

对于本书，如果有任何意见或疑问，请按照以下地址联系本书出版商。

美国：

O'Reilly Media，Inc.

1005 Gravenstein Highway North

Sebastopol，CA 95472

中国：

北京市西城区西直门南大街 2 号成铭大厦 C 座 807 室（100035）

奥莱利技术咨询（北京）有限公司

要询问技术问题或对本书提出建议，请发送电子邮件至 bookquestions@oreilly.com。

本书配套网站 https://oreil.ly/c-sharp-8 上列出了勘误表、示例以及其他信息。

如需获得示例代码以及其他相关资源，请访问 http://www.albahari.com/nutshell。

若对本书有任何建议或技术问题，请发送电子邮件至 bookquestions@oreilly.com。

如需获取更多有关 O'Reilly 的书籍、会议、资源中心及 O'Reilly 网络的信息，请访问 http://www.oreilly.com。

## 致谢

Joseph Albahari

首先，感谢 Eric Johannsen 对本版的大力支持 — 他出色的工作让 UNIX 用户也能有相当好的阅读体验。同时也感谢我的兄弟 Ben Albahari 对本书前几版的杰出贡献。

很荣幸有这么优秀的技术审阅团队对本书进行审阅。尤其要感谢来自 Microsoft 的 Vitek Karas 和 Stephen Toub。他们在百忙之中为本书提供了非常有价值的反馈。感谢 Paulo Morgado、Aaron Robinson、Jan Vorlicek 和 Sam Gentile 为本书做出的贡献。

本书是基于前几版编写的。请允许我一并对前几版的技术审阅者致以诚挚的谢意：感谢 Rod Stephens、Jared Parsons、Stephen Toub、Matthew Groves、Dixin Yan、Lee Coward、Bonnie DeWitt、Wonseok Chae、Lori Lalonde 和 James Montemagno 在前两版中的细致工作；感谢 Eric Lippert、Jon Skeet、Stephen Toub、Nicholas Paldino、Chris Burrows、ShawnFarkas、Brian Grunkemeyer、Maoni Stephens、David DeWinter、Mike Barnett、Melitta Andersen、Mitch Wheat、Brian Peek、Krzysztof Cwalina、Matt Warren、Joel Pobar、Glyn Griffiths、Ion Vasilian、Brad Abrams 和 Adam Nathan 对前几版的审阅。

上述审阅者中，有一大部分是来自 Microsoft 的资深专家。在他们的努力下，本书才能达到如今的高度。

感谢 O'Reilly 团队 — 尤其要感谢 Corbin Collins 高效而极具响应速度的编辑工作。最后深深地感谢我的妻子，Li Albahari。在整个项目期间，她的陪伴令我感到幸福而快乐。

Eric Johannsen

互联网让我足不出户就能和世界上那些最具天赋的人合作，真是令人惊叹。

首先，感谢 Joseph Albahari 邀请我参与这个卓越的项目。

在 GitHub 的.NET Core 项目共同协作的 Microsoft 员工和社区成员都非常积极且乐于助人。当我无法找到某个棘手问题的解决方案时，都会得到他们非常迅速的回答。在此向他们的支持表示感谢。

感谢我的家人。正是他们的爱与支持令我能够坦然接受 Joseph 的邀请。感谢我的妻子 Rose，是她在这段忙碌的时间里打理着大大小小的事务。最后感谢我的三个孩子 — Sydney、Alexis 和 Ryan — 对我的理解。